import{G as D,g as C}from"./pdfjs-lFNHpD8d.js";import{E}from"./jspdf-2GeXGIBk.js";import z from"./html2canvas-DcoBDRbt.js";function R(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function S(h,e){let t;return function(...s){const a=()=>{clearTimeout(t),h(...s)};clearTimeout(t),t=setTimeout(a,e)}}function F(h){return typeof h=="number"&&!isNaN(h)&&isFinite(h)}function w(h){if(!F(h)||h===0)return"0 B";const e=["B","KB","MB","GB"];let t=h,i=0;for(;t>=1024&&i<e.length-1;)t/=1024,i++;return"".concat(t.toFixed(1)," ").concat(e[i])}const k=""+new URL("pdf.worker.min-wgc6bjNh.mjs",import.meta.url).href;class A{constructor(){this.pdf=null,this.isProcessing=!1}async initialize(){D.workerSrc=k}validateFile(e){const t=[];if(!e)return t.push("No file selected"),{valid:!1,errors:t};e.type!=="application/pdf"&&t.push("Please select a PDF file");const i=250*1024*1024;return e.size>i&&t.push("File too large (".concat(w(e.size),"). Maximum size is ").concat(w(i))),e.size===0&&t.push("File appears to be empty"),{valid:t.length===0,errors:t}}async loadPDF(e,t=null){if(this.isProcessing)throw new Error("PDF processing already in progress");this.isProcessing=!0;try{const i=this.validateFile(e);if(!i.valid)throw new Error(i.errors.join(". "));if(t==null||t("Reading PDF file..."),!await this.validateFileSignature(e))throw new Error("Invalid file signature. Please select a valid PDF file.");this.fileUrl=URL.createObjectURL(e),t==null||t("Processing PDF...");const a=C({url:this.fileUrl,verbosity:0}).promise,n=new Promise((o,d)=>setTimeout(()=>d(new Error("PDF loading timed out")),6e4));this.pdf=await Promise.race([a,n]);const r=this.pdf.numPages;if(r===0)throw new Error("PDF appears to be empty or corrupted");return{pdf:this.pdf,numPages:r,fileName:e.name,fileSize:e.size}}catch(i){throw console.error("PDF loading error:",i),this.handlePDFError(i)}finally{this.isProcessing=!1}}async validateFileSignature(e){const s=await e.slice(0,1024).arrayBuffer(),a=new Uint8Array(s);return new TextDecoder().decode(a).includes("%PDF-")}async renderPage(e,t=null){if(!this.pdf)throw new Error("No PDF loaded");try{t==null||t("Rendering page ".concat(e,"..."));const i=await this.pdf.getPage(e),a=i.getViewport({scale:1.5}),n=Math.floor(a.width),r=Math.floor(a.height),o=document.createElement("canvas"),d=o.getContext("2d",{alpha:!1});o.width=n,o.height=r,d.fillStyle="#ffffff",d.fillRect(0,0,o.width,o.height);const c={canvasContext:d,viewport:a,background:"white"};return await i.render(c).promise,o}catch(i){throw console.error("Failed to render page ".concat(e,":"),i),new Error("Failed to render page ".concat(e),{cause:i})}}async canvasToBlob(e){return new Promise(t=>{e.toBlob(i=>{const s=URL.createObjectURL(i);t(s)},"image/jpeg",.8)})}revokeBlobUrl(e){e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}canvasToDataURL(e,t="image/jpeg",i=.85){try{return e.toDataURL(t,i)}catch(s){return console.warn("Failed to generate ".concat(t,", falling back to PNG:"),s),e.toDataURL("image/png",1)}}handlePDFError(e){const t=e.message||"Unknown error";return t.includes("timed out")?new Error("PDF loading timed out. The file may be corrupted or too large."):t.includes("corrupted")||t.includes("InvalidPDFException")?new Error("The PDF file appears to be corrupted or invalid."):t.includes("password")||t.includes("protected")?new Error("The PDF file is password-protected."):t.includes("not loaded")||t.includes("MissingPDFException")?new Error("PDF.js library failed to load. Please refresh the page."):new Error("PDF processing failed: ".concat(t))}cleanup(){this.pdf&&(this.pdf.destroy(),this.pdf=null),this.fileUrl&&(URL.revokeObjectURL(this.fileUrl),this.fileUrl=null),this.isProcessing=!1}}function $(h){return{all:h=h||new Map,on:function(e,t){var i=h.get(e);i?i.push(t):h.set(e,[t])},off:function(e,t){var i=h.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):h.set(e,[]))},emit:function(e,t){var i=h.get(e);i&&i.slice().map(function(s){s(t)}),(i=h.get("*"))&&i.slice().map(function(s){s(e,t)})}}}const b={a4:{label:"A4 (210 × 297 mm)",width:210,height:297},a3:{label:"A3 (297 × 420 mm)",width:297,height:420},letter:{label:"Letter (8.5 × 11 in)",width:215.9,height:279.4},legal:{label:"Legal (8.5 × 14 in)",width:215.9,height:355.6},a5:{label:"A5 (148 × 210 mm)",width:148,height:210}},T={"mini-8":{label:"8-Page Mini-Zine",pages:8,grid:{rows:2,cols:4},layout:[{page:5,upsideDown:!1},{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:1,upsideDown:!1}],gridAreas:'\n            "page5 page4 page3 page2"\n            "page6 page7 page8 page1"\n        ',upsideDownPages:[2,3,4,5],cutLines:{horizontal:{afterRow:1}}},"accordion-16":{label:"16-Page Accordion",pages:16,grid:{rows:4,cols:4},layout:[{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:1,upsideDown:!0},{page:5,upsideDown:!1},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:12,upsideDown:!0},{page:11,upsideDown:!0},{page:10,upsideDown:!0},{page:9,upsideDown:!0},{page:13,upsideDown:!1},{page:14,upsideDown:!1},{page:15,upsideDown:!1},{page:16,upsideDown:!1}],gridAreas:'\n            "page4 page3 page2 page1"\n            "page5 page6 page7 page8"\n            "page12 page11 page10 page9"\n            "page13 page14 page15 page16"\n        ',upsideDownPages:[1,2,3,4,9,10,11,12],cutLines:{leftEdge:{rows:[0,1,2]},rightEdge:{rows:[0,1,2]}},description:"1 sheet, 4×4 grid. Cut along edges then fold accordion-style."},"dual-16":{label:"16-Page Dual Sheets",pages:16,sheets:2,grid:{rows:2,cols:4},description:"2 sheets, each folded like an 8-page zine."}};class U{constructor(){this.container=null,this.init()}init(){this.container=document.getElementById("toast-container"),this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container fixed bottom-6 right-6 z-[300] flex flex-col gap-4 font-typewriter pointer-events-none",document.body.appendChild(this.container)),this.container.setAttribute("aria-live","polite"),this.container.setAttribute("aria-atomic","true"),this.container.setAttribute("role","region"),this.container.setAttribute("aria-label","Notifications")}show(e,t,i="",s=5e3){const a=document.createElement("div");a.className="toast toast-".concat(e);const n=e==="error"?"alert":"status";a.setAttribute("role",n);const r=this.getIcon(e),o=document.createElement("div");o.className="toast-icon",o.innerHTML=r;const d=document.createElement("div");d.className="toast-content";const c=document.createElement("div");if(c.className="toast-title",c.textContent=t,d.appendChild(c),i){const g=document.createElement("div");g.className="toast-message",g.textContent=i,d.appendChild(g)}const l=document.createElement("button");return l.className="toast-close",l.setAttribute("aria-label","Close notification"),l.innerHTML="&times;",l.addEventListener("click",()=>this.remove(a)),a.appendChild(o),a.appendChild(d),a.appendChild(l),this.container.appendChild(a),s>0&&setTimeout(()=>{a.parentNode&&this.remove(a)},s),requestAnimationFrame(()=>{a.classList.add("toast-visible");const g=Math.random()*4-2;a.style.transform="translateX(0) rotate(".concat(g,"deg)")}),a}remove(e){e.classList.remove("toast-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getIcon(e){const t={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>\n        <polyline points="22,4 12,14.01 9,11.01"/>\n      </svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <line x1="15" y1="9" x2="9" y2="15"/>\n        <line x1="9" y1="9" x2="15" y2="15"/>\n      </svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>\n        <line x1="12" y1="9" x2="12" y2="13"/>\n        <line x1="12" y1="17" x2="12.01" y2="17"/>\n      </svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <path d="M12 16v-4"/>\n        <path d="M12 8h.01"/>\n      </svg>'};return t[e]||t.info}success(e,t,i){return this.show("success",e,t,i)}error(e,t,i){return this.show("error",e,t,i)}warning(e,t,i){return this.show("warning",e,t,i)}info(e,t,i){return this.show("info",e,t,i)}}const u=new U;class I{constructor(){this.emitter=$(),this.elements={},this.paperSize="a4",this.orientation="landscape",this.init()}init(){this.cacheElements(),this.renderPaperSizeOptions(),this.loadSettings(),this.updatePreviewLayout(),this.setupEventListeners(),this.elements.previewArea&&this.elements.previewArea.classList.remove("opacity-50","pointer-events-none")}cacheElements(){const e=t=>document.querySelector(t);this.elements={uploadZone:e("#upload-zone"),previewArea:e("#preview-area"),actionButtons:e("#action-buttons"),previewDescription:e("#preview-description"),zineSheetsContainer:e("#zine-sheets-container"),printBtn:e("#printBtn"),exportPdfBtn:e("#exportPdfBtn"),pdfUpload:e("#pdf-upload"),uploadStatus:e("#upload-status"),progressContainer:e("#progress-container"),progressFill:e("#progress-fill"),progressText:e("#progress-text"),progressSubtext:e("#progress-subtext"),paperSizeSelect:e("#paper-size-select"),orientationSelect:e("#orientation-select"),pageNumbersCheckbox:e("#show-page-numbers"),toastContainer:e("#toast-container"),zineTabs:e("#zine-tabs"),zineTab1:e("#zine-tab-1"),zineTab2:e("#zine-tab-2"),gridRows:e("#grid-rows"),gridCols:e("#grid-cols"),gridTotal:e("#grid-total"),unusedSection:e("#unused-pages-section"),unusedGrid:e("#unused-grid")}}renderPaperSizeOptions(){this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.innerHTML=Object.entries(b).map(([e,t])=>'<option value="'.concat(e,'">').concat(t.label,"</option>")).join(""))}setupEventListeners(){var s,a,n,r,o,d,c,l,g,m,v,y,P;(s=this.elements.paperSizeSelect)==null||s.addEventListener("change",p=>this.updatePaperSize(p.target.value)),(a=this.elements.orientationSelect)==null||a.addEventListener("change",p=>this.updateOrientation(p.target.value)),(n=this.elements.pageNumbersCheckbox)==null||n.addEventListener("change",p=>this.togglePageNumbers(p.target.checked)),(r=this.elements.printBtn)==null||r.addEventListener("click",()=>this.emitter.emit("print")),(o=this.elements.exportPdfBtn)==null||o.addEventListener("click",()=>this.emitter.emit("export")),(d=this.elements.uploadZone)==null||d.addEventListener("click",()=>this.triggerFileUpload()),(c=this.elements.uploadZone)==null||c.addEventListener("keydown",p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),this.triggerFileUpload())}),(l=this.elements.uploadZone)==null||l.addEventListener("dragover",p=>this.handleDragOver(p)),(g=this.elements.uploadZone)==null||g.addEventListener("dragleave",p=>this.handleDragLeave(p)),(m=this.elements.uploadZone)==null||m.addEventListener("drop",p=>this.handleFileDrop(p)),(v=this.elements.pdfUpload)==null||v.addEventListener("change",p=>{const f=p.target.files[0];f&&this.emitter.emit("fileSelected",f)});const e=S((p,f)=>{this.emitter.emit("gridSizeChanged",{rows:p,cols:f})},300),i=S(()=>{var x,L;const p=parseInt((x=this.elements.gridRows)==null?void 0:x.value)||2,f=parseInt((L=this.elements.gridCols)==null?void 0:L.value)||4;this.elements.gridTotal&&(this.elements.gridTotal.textContent="(".concat(p*f," pages)")),e(p,f)},300);(y=this.elements.gridRows)==null||y.addEventListener("input",i),(P=this.elements.gridCols)==null||P.addEventListener("input",i),document.addEventListener("keydown",p=>this.handleKeyboard(p))}setReady(e,t=null){var i,s,a,n;e?((i=this.elements.previewArea)==null||i.classList.remove("opacity-30","pointer-events-none"),(s=this.elements.actionButtons)==null||s.classList.remove("hidden")):((a=this.elements.previewArea)==null||a.classList.add("opacity-30","pointer-events-none"),(n=this.elements.actionButtons)==null||n.classList.add("hidden")),t&&this.elements.previewDescription&&(this.elements.previewDescription.textContent=t)}updateProgress(e){this.elements.progressFill&&(this.elements.progressFill.style.width="".concat(e,"%"))}setStatus(e,t="info"){this.elements.uploadStatus&&(this.elements.uploadStatus.textContent=e,this.elements.uploadStatus.className="text-[11px] uppercase font-bold tracking-wider ".concat(t==="error"?"text-red-500":t==="success"?"text-green-500":"text-gray-400"))}generateLayout(e=8,t=null){if(!this.elements.zineSheetsContainer)return;this.elements.zineSheetsContainer.innerHTML="",t||(e>8?t="accordion-16":t="mini-8"),this.currentTemplate=t;const i=T[t];if(!i){console.error("Unknown template: ".concat(t));return}t==="accordion-16"?this.generateAccordionLayout(i):this.generateMiniZineLayout(e,i),this.updatePreviewLayout(),this.elements.previewArea&&this.elements.previewArea.classList.remove("opacity-50","pointer-events-none")}generateCustomGrid(e,t,i=0){this.elements.zineSheetsContainer.innerHTML="";const s=e*t,a=Math.max(s,i),n=document.createElement("div");n.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",n.setAttribute("data-sheet",1),n.setAttribute("data-template","custom-".concat(e,"x").concat(t));const r=document.createElement("div");r.className="zine-grid",r.id="zine-grid-sheet-1",r.style.display="grid",r.style.gridTemplateColumns="repeat(".concat(t,", 1fr)"),r.style.gridTemplateRows="repeat(".concat(e,", 1fr)"),r.style.gridTemplateAreas="none";for(let o=0;o<s;o++){const d=o+1,c=document.createElement("div");c.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden transition-all duration-200",c.setAttribute("data-page-index",o),c.setAttribute("data-page",d),c.setAttribute("draggable","true");const l=d===1?"Cover":d===s?"Back":"Page ".concat(d);c.innerHTML='\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(l,'</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all focus-visible:ring-2 focus-visible:ring-black focus-visible:outline-none" title="Flip page" aria-label="Rotate page 180 degrees">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ').concat(d,'" class="page-content-img w-full h-full object-contain hidden transition-transform duration-300 ease-in-out" draggable="false" />\n      '),this.setupDragAndDrop(c),this.setupFlipButton(c),r.appendChild(c)}n.appendChild(r),this.elements.zineSheetsContainer.appendChild(n),this.generateUnusedBucket(s,a),this.updatePreviewLayout()}generateUnusedBucket(e,t){const{unusedSection:i,unusedGrid:s}=this.elements;if(!(!i||!s)){if(s.innerHTML="",e>=t){i.classList.add("hidden");return}i.classList.remove("hidden");for(let a=e;a<t;a++){const n=document.createElement("div");n.className="page-cell bg-white aspect-[1/1.414] relative rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing hover:border-blue-500 transition-colors duration-200",n.setAttribute("data-page-index",a),n.draggable=!0;const r=document.createElement("img");r.className="page-content-img w-full h-full object-contain hidden pointer-events-none",r.draggable=!1;const o=document.createElement("div");o.className="absolute top-1 left-1 bg-gray-500 text-white text-[8px] px-1.5 py-0.5 rounded-sm font-bold z-10",o.textContent="#".concat(a+1);const d=document.createElement("div");d.className="text-[10px] uppercase font-bold text-gray-300 select-none",d.textContent="Unused",n.appendChild(o),n.appendChild(d),n.appendChild(r),this.setupDragAndDrop(n),s.appendChild(n)}}}generateAccordionLayout(e){const t=document.createElement("div");t.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",t.setAttribute("data-sheet",1),t.setAttribute("data-template","accordion-16");const i=document.createElement("div");i.className="zine-grid accordion-16",i.id="zine-grid-sheet-1",i.style.display="grid",i.style.gridTemplateColumns="repeat(4, 1fr)",i.style.gridTemplateRows="repeat(4, 1fr)",e.layout.forEach(a=>{const n=document.createElement("div");n.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",n.setAttribute("data-page-index",a.page-1),n.setAttribute("data-page",a.page),n.setAttribute("draggable","true");const r=a.page===1?"Cover":a.page===16?"Back":"Page ".concat(a.page);n.innerHTML='\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(r,'</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all focus-visible:ring-2 focus-visible:ring-black focus-visible:outline-none" title="Flip page" aria-label="Rotate page 180 degrees">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ').concat(a.page,'" class="page-content-img w-full h-full object-contain hidden transition-transform duration-300 ease-in-out" draggable="false" />\n      '),this.setupDragAndDrop(n),this.setupFlipButton(n),i.appendChild(n)}),t.appendChild(i),t.insertAdjacentHTML("beforeend",'\n      <div class="absolute top-1/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-3/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n    '),this.elements.zineSheetsContainer.appendChild(t)}generateMiniZineLayout(e,t){const i=e>8?2:1;for(let s=1;s<=i;s++){const a=document.createElement("div");a.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",a.setAttribute("data-sheet",s);const n=document.createElement("div");n.className="zine-grid",n.id="zine-grid-sheet-".concat(s),n.style.display="grid",n.style.gridTemplateColumns="repeat(4, 1fr)",n.style.gridTemplateRows="repeat(2, 1fr)";for(let o=1;o<=8;o++){const d=(s-1)*8+o,c=document.createElement("div");c.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",c.setAttribute("data-page-index",d-1),c.setAttribute("data-page",o),c.setAttribute("draggable","true");const l=o===1?"Cover":o===8?"Back":"Page ".concat(o),g=i>1?' <span class="opacity-50 text-[8px] ml-1">(Sheet '.concat(s,")</span>"):"";c.innerHTML='\n          <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(l).concat(g,'</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all focus-visible:ring-2 focus-visible:ring-black focus-visible:outline-none" title="Flip page" aria-label="Rotate page 180 degrees">\n              <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n          </button>\n          <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ').concat(d,'" class="page-content-img w-full h-full object-contain hidden transition-transform duration-300 ease-in-out" draggable="false" />\n        '),this.setupDragAndDrop(c),this.setupFlipButton(c),n.appendChild(c)}const r='\n        <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n      ';a.appendChild(n),a.insertAdjacentHTML("beforeend",r),this.elements.zineSheetsContainer.appendChild(a)}}setupDragAndDrop(e){e.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",e.getAttribute("data-page-index")),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),document.querySelectorAll(".page-cell").forEach(t=>t.classList.remove("drag-over"))}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("drag-over");const i=parseInt(t.dataTransfer.getData("text/plain")),s=parseInt(e.getAttribute("data-page-index"));i!==s&&this.emitter.emit("pagesSwapped",{fromIndex:i,toIndex:s})})}updatePagePreview(e,t){[...Array.from(this.elements.zineSheetsContainer.querySelectorAll('.page-cell[data-page-index="'.concat(e,'"]'))),...this.elements.unusedGrid?Array.from(this.elements.unusedGrid.querySelectorAll('.page-cell[data-page-index="'.concat(e,'"]'))):[]].forEach(s=>{const a=s.querySelector(".page-content-img"),n=s.querySelector(".page-placeholder"),r=s.querySelector(".text-gray-300");t?(a&&(a.src=t,a.classList.remove("hidden")),n&&n.classList.add("hidden"),r&&r.textContent==="Unused"&&r.classList.add("hidden")):(a&&(a.src="",a.classList.add("hidden")),n&&n.classList.remove("hidden"),r&&r.textContent==="Unused"&&r.classList.remove("hidden"))}),this.elements.unusedGrid&&this.elements.unusedGrid.children.length>0&&this.elements.unusedSection.classList.remove("hidden")}setupFlipButton(e){const t=e.querySelector(".flip-btn");t&&t.addEventListener("click",i=>{i.stopPropagation();const s=parseInt(e.getAttribute("data-page-index"));this.emitter.emit("pageFlipped",s)})}setPageFlip(e,t){const i=this.elements.zineSheetsContainer.querySelector('[data-page-index="'.concat(e,'"]'));if(i){const s=i.querySelector(".page-content-img");s&&(t?(s.style.transform="".concat(s.style.transform||""," rotate(180deg)").trim(),s.classList.add("flipped")):(s.style.transform=s.style.transform.replace("rotate(180deg)","").trim(),s.classList.remove("flipped")))}}triggerFileUpload(){var e;(e=this.elements.pdfUpload)==null||e.click()}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.add("dragover")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&!this.elements.uploadZone.contains(e.relatedTarget)&&this.elements.uploadZone.classList.remove("dragover")}handleFileDrop(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&t[0].type==="application/pdf"?this.emitter.emit("fileSelected",t[0]):u.error("Invalid File","Please drop a valid PDF file")}handleKeyboard(e){if(e.metaKey||e.ctrlKey){const t=e.key.toLowerCase();t==="p"?(e.preventDefault(),this.emitter.emit("print")):t==="o"?(e.preventDefault(),this.triggerFileUpload()):t==="s"&&(e.preventDefault(),this.emitter.emit("export"))}}showProgress(e,t="Processing PDF...",i=""){e?this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressContainer.classList.add("flex")):this.elements.progressContainer&&(this.elements.progressContainer.classList.add("hidden"),this.elements.progressContainer.classList.remove("flex")),this.elements.progressText&&(this.elements.progressText.textContent=t),this.elements.progressSubtext&&(this.elements.progressSubtext.textContent=i)}loadSettings(){const e=localStorage.getItem("paperSize"),t=localStorage.getItem("orientation");e&&(this.paperSize=e,this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.value=e)),t&&(this.orientation=t,this.elements.orientationSelect&&(this.elements.orientationSelect.value=t))}updatePaperSize(e){this.paperSize=e,localStorage.setItem("paperSize",e),this.updatePreviewLayout(),this.emitter.emit("paperSizeChanged",{paperSize:e,orientation:this.orientation})}updateOrientation(e){this.orientation=e,localStorage.setItem("orientation",e),this.updatePreviewLayout(),this.emitter.emit("orientationChanged",{paperSize:this.paperSize,orientation:e})}togglePageNumbers(e){document.querySelectorAll(".page-label").forEach(i=>{e?(i.classList.remove("hidden"),i.classList.add("centered")):(i.classList.add("hidden"),i.classList.remove("centered"))})}updatePreviewLayout(){const e=document.querySelectorAll(".print-sheet");if(!e.length)return;const t=this.getPaperDimensions(this.paperSize,this.orientation),i=t.width/t.height;e.forEach(s=>{s.style.aspectRatio="".concat(i),s.style.maxHeight="75vh",s.style.maxWidth="100%",s.style.margin="0 auto"})}getPaperDimensions(e,t){const i=b[e]||b.a4;return t==="landscape"?{width:i.height,height:i.width}:{width:i.width,height:i.height}}getPaperSizeLabel(e){var t;return((t=b[e])==null?void 0:t.label)||"A4"}hasContent(){return this.elements.zineSheetsContainer&&this.elements.zineSheetsContainer.querySelector(".page-content-img:not(.hidden)")!==null}on(e,t){this.emitter.on(e,t)}}const B=""+new URL("reference-back-side-MWF-VJIo.jpg",import.meta.url).href;class M{constructor(){this.pdfProcessor=new A,this.ui=new I,this.referenceImageUrl=B,this.allPageImages=new Array(16).fill(null),this.pageFlips={},this.gridSize={rows:2,cols:4},this.init()}async init(){try{await this.pdfProcessor.initialize(),this.setupEventListeners(),this.ui.generateLayout(8),this.ui.setStatus("Upload a PDF file to get started","info")}catch(e){console.error("Initialization error:",e),this.ui.setStatus("Failed to initialize. Please refresh the page.","error"),u.error("Initialization Error","Failed to load required libraries.")}}setupEventListeners(){this.ui.on("fileSelected",e=>this.handleFileSelected(e)),this.ui.on("print",()=>this.handlePrint()),this.ui.on("export",()=>this.handleExport()),this.ui.on("paperSizeChanged",e=>this.updatePaperSettings(e)),this.ui.on("orientationChanged",e=>this.updatePaperSettings(e)),this.ui.on("pagesSwapped",e=>this.handlePagesSwapped(e)),this.ui.on("pageFlipped",e=>this.handlePageFlipped(e)),this.ui.on("gridSizeChanged",e=>this.handleGridSizeChanged(e))}handlePageFlipped(e){this.pageFlips[e]=!this.pageFlips[e],this.ui.setPageFlip(e,this.pageFlips[e])}handleGridSizeChanged({rows:e,cols:t}){this.gridSize={rows:e,cols:t};const i=e*t;this.ui.generateCustomGrid(e,t,this.allPageImages.length);for(let s=0;s<Math.min(i,this.allPageImages.length);s++)this.allPageImages[s]&&this.ui.updatePagePreview(s,this.allPageImages[s])}handleFileSelected(e){this.selectedFile=e,this.ui.setStatus("File selected: ".concat(e.name," (").concat(w(e.size),")"),"success"),this.processPDF(e)}async processPDF(e){try{u.info("Reading PDF...","Please wait"),this.ui.showProgress(!0,"Reading PDF...","0%");const t=await this.pdfProcessor.loadPDF(e,l=>{this.ui.updateProgress(l)}),{numPages:i}=t;this.selectedLayout=i;const s=i;let a,n;if(i===16)a=4,n=4,this.gridSize={rows:a,cols:n},this.ui.generateLayout(16,"accordion-16");else{const l=Math.ceil(Math.sqrt(i));a=i<=8?2:l>2?l:2,n=i<=8?4:Math.ceil(i/a),a=Math.min(a,10),n=Math.min(n,10),this.gridSize={rows:a,cols:n},this.allPageImages=new Array(Math.max(a*n,i)).fill(null),this.ui.generateCustomGrid(a,n,this.allPageImages.length)}this.ui.elements.gridRows&&(this.ui.elements.gridRows.value=a),this.ui.elements.gridCols&&(this.ui.elements.gridCols.value=n),this.ui.elements.gridTotal&&(this.ui.elements.gridTotal.textContent="(".concat(a*n," pages)"));const r="PDF arranged into a ".concat(a,"×").concat(n," grid (").concat(a*n," pages)");this.ui.setReady(!0,r);const o=2;let d=0;const c=async l=>{const g=await this.pdfProcessor.renderPage(l),m=await this.pdfProcessor.canvasToBlob(g);this.allPageImages[l-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[l-1]),this.allPageImages[l-1]=m,this.ui.updatePagePreview(l-1,m),d++;const v=Math.round(d/s*100);this.ui.showProgress(!0,"Processing Pages...","".concat(v,"%")),this.ui.updateProgress(v)};for(let l=1;l<=s;l+=o){const g=[];for(let m=0;m<o&&l+m<=s;m++)g.push(c(l+m));await Promise.all(g)}for(let l=s+1;l<=this.selectedLayout;l++)await this.createBlankPage(l);this.ui.showProgress(!1),this.ui.setStatus("Successfully processed ".concat(i," pages"),"success"),u.success("Done!","Your zine is ready to print.")}catch(t){console.error("PDF Error:",t),this.ui.showProgress(!1),u.error("Error",t.message||"Failed to process PDF.")}}async createBlankPage(e){const t=document.createElement("canvas");t.width=1e3,t.height=1400;const i=t.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1e3,1400),i.fillStyle="#f3f4f6",i.font="bold 80px sans-serif",i.textAlign="center",i.fillText("BLANK",500,700);const s=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=s,this.ui.updatePagePreview(e-1,s)}handlePagesSwapped({fromIndex:e,toIndex:t}){const i=this.allPageImages[e];this.allPageImages[e]=this.allPageImages[t],this.allPageImages[t]=i;const s=this.pageFlips[e];this.pageFlips[e]=this.pageFlips[t],this.pageFlips[t]=s,this.ui.updatePagePreview(e,this.allPageImages[e]),this.ui.updatePagePreview(t,this.allPageImages[t]),this.ui.setPageFlip(e,!!this.pageFlips[e]),this.ui.setPageFlip(t,!!this.pageFlips[t]),u.info("Pages swapped")}updateZineView(e){const t=(e-1)*8;for(let i=0;i<8;i++){const s=t+i,a=this.allPageImages[s];this.ui.updatePagePreview(i,a)}}updatePaperSettings(e){this.paperSize=e.paperSize,this.orientation=e.orientation}handlePrint(){if(!this.ui.hasContent()){u.warning("No Content","Upload a PDF to print!");return}this.createPrintLayout()}createPrintLayout(){const e=window.open("","_blank");if(!e){u.error("Blocked","Please allow popups.");return}const t=[];document.querySelectorAll(".zine-grid").forEach(l=>{t.push(l.innerHTML)});const i=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),{rows:s,cols:a}=this.gridSize,n="\n      grid-template-columns: repeat(".concat(a,", 1fr);\n      grid-template-rows: repeat(").concat(s,", 1fr);\n      grid-template-areas: none !important;\n      /* Generate grid areas if needed, but simple flow usually works for generic grids */\n    "),r="",o="",d=t.map(l=>'\n      <div class="sheet">\n        <div class="zine-grid">'.concat(l,"</div>\n        ").concat(o,'\n      </div>\n      <div class="sheet"><div class="back-side"></div></div>\n    ')).join(""),c="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Print Zine</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ".concat(i.width,"mm ").concat(i.height,"mm; margin: 0; }\n          body { background: white; width: ").concat(i.width,"mm; height: ").concat(i.height,"mm; overflow: hidden; }\n          .sheet { width: 100%; height: 100%; page-break-after: always; display: block; overflow: hidden; position: relative; }\n          .zine-grid {\n            display: grid;\n            ").concat(n,"\n            height: ").concat(i.height,"mm;\n            width: ").concat(i.width,"mm;\n            /* Ensure grid fills the page */\n            justify-content: stretch;\n            align-content: stretch;\n          }\n          .page-cell {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            overflow: hidden;\n            border: none;\n          }\n          /* Generic page areas fallback if needed */\n          \n          .page-content-img { \n            width: 100%; \n            height: 100%; \n            object-fit: contain; \n            /* Rely on DOM transform for rotation */\n          }\n          .page-label, .page-placeholder { display: none; }\n          \n          .back-side {\n            width: 100%; height: 100%;\n            background-image: url('").concat(this.referenceImageUrl,"');\n            background-size: contain;\n            background-position: center;\n            background-repeat: no-repeat;\n            transform: rotate(180deg);\n          }\n          \n          /* CRITICAL: Hide controls in print */\n          @media print {\n            .flip-btn, .page-label, .guidelines, .page-placeholder, .page-cell::before, .page-cell::after { \n                display: none !important; \n            }\n            .page-cell { border: none !important; }\n          }\n          \n          ").concat(r,"\n        </style>\n      </head>\n      <body>\n        ").concat(d,"\n      </body>\n      </html>\n    ");e.document.write(c),e.document.close(),e.setTimeout(()=>{e.print(),e.close()},500)}async handleExport(){if(this.ui.hasContent())try{this.ui.elements.exportPdfBtn.disabled=!0,document.body.classList.add("is-exporting"),u.info("Generating PDF...");const e=new E({orientation:this.orientation||"landscape",unit:"mm",format:this.paperSize||"a4"}),t=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),i=async s=>{const a=document.querySelector("#zine-grid-sheet-".concat(s));if(!a)return;await new Promise(c=>setTimeout(c,100));const n=await z(a,{scale:2,useCORS:!0,backgroundColor:"#ffffff",logging:!1});s>1&&e.addPage(),e.addImage(n.toDataURL("image/jpeg",.95),"JPEG",0,0,t.width,t.height),e.addPage();const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d"),d=new Image;d.src=this.referenceImageUrl,await new Promise(c=>{d.onload=c}),o.translate(r.width/2,r.height/2),o.rotate(Math.PI),o.drawImage(d,-r.width/2,-r.height/2,r.width,r.height),e.addImage(r.toDataURL("image/jpeg",.9),"JPEG",0,0,t.width,t.height)};await i(1),this.currentTemplate!=="accordion-16"&&this.selectedLayout>8&&await i(2),e.save("zine-".concat(Date.now(),".pdf")),u.success("Downloaded!","Your PDF is ready.")}catch(e){console.error(e),u.error("Export Failed","Something went wrong.")}finally{this.ui.elements.exportPdfBtn.disabled=!1,document.body.classList.remove("is-exporting")}}}document.addEventListener("DOMContentLoaded",()=>{new M});export{R as __vite_legacy_guard};
//# sourceMappingURL=index-CDAXlNxz.js.map
