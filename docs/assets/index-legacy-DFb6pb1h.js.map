{"version":3,"file":"index-legacy-DFb6pb1h.js","sources":["../../src/js/utils.js","../../node_modules/pdfjs-dist/build/pdf.worker.min.mjs?url","../../src/js/pdf-processor.js","../../src/js/config.js","../../src/js/toast.js","../../src/js/zine-ui.js","../../node_modules/mitt/dist/mitt.mjs","../../src/assets/reference-back-side.jpg","../../src/js/main.js"],"sourcesContent":["// Modern utility functions for the PDF Zine Maker\n\n/**\n * Debounce function to limit how often a function can be called\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} Debounced function\n */\nexport function debounce(func, wait) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Check if a value is a valid number\n * @param {*} value - Value to check\n * @returns {boolean} True if value is a number\n */\nexport function isNumber(value) {\n  return typeof value === 'number' && !isNaN(value) && isFinite(value);\n}\n\n/**\n * Format file size in human readable format\n * @param {number} bytes - File size in bytes\n * @returns {string} Formatted file size\n */\nexport function formatFileSize(bytes) {\n  if (!isNumber(bytes)) { return '0 B'; }\n\n  const units = ['B', 'KB', 'MB', 'GB'];\n  let size = bytes;\n  let unitIndex = 0;\n\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024;\n    unitIndex++;\n  }\n\n  return `${size.toFixed(1)} ${units[unitIndex]}`;\n}\n\n/**\n * Create a promise that resolves after a delay\n * @param {number} ms - Delay in milliseconds\n * @returns {Promise} Promise that resolves after the delay\n */\nexport function delay(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n","export default \"__VITE_ASSET__BzS7jifq__\"","// Modern PDF processing class\n\nimport * as pdfjsLib from 'pdfjs-dist';\nimport { formatFileSize } from './utils.js';\nimport pdfWorker from 'pdfjs-dist/build/pdf.worker.min.mjs?url';\n\nexport class PDFProcessor {\n  constructor() {\n    this.pdf = null;\n    this.isProcessing = false;\n  }\n\n  /**\n   * Initialize PDF.js worker\n   */\n  async initialize() {\n    pdfjsLib.GlobalWorkerOptions.workerSrc = pdfWorker;\n  }\n\n  /**\n   * Validate PDF file\n   * @param {File} file - PDF file to validate\n   * @returns {Object} Validation result\n   */\n  validateFile(file) {\n    const errors = [];\n\n    if (!file) {\n      errors.push('No file selected');\n      return { valid: false, errors };\n    }\n\n    if (file.type !== 'application/pdf') {\n      errors.push('Please select a PDF file');\n    }\n\n    const maxSize = 250 * 1024 * 1024; // 250MB\n    if (file.size > maxSize) {\n      errors.push(`File too large (${formatFileSize(file.size)}). Maximum size is ${formatFileSize(maxSize)}`);\n    }\n\n    if (file.size === 0) {\n      errors.push('File appears to be empty');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    };\n  }\n\n  /**\n   * Load PDF from file\n   * @param {File} file - PDF file to load\n   * @param {Function} onProgress - Progress callback\n   * @returns {Promise<Object>} PDF loading result\n   */\n  async loadPDF(file, onProgress = null) {\n    if (this.isProcessing) {\n      throw new Error('PDF processing already in progress');\n    }\n\n    this.isProcessing = true;\n\n    try {\n      const validation = this.validateFile(file);\n      if (!validation.valid) {\n        throw new Error(validation.errors.join('. '));\n      }\n\n      onProgress?.('Reading PDF file...');\n\n      const arrayBuffer = await this.readFileAsArrayBuffer(file);\n\n      onProgress?.('Processing PDF...');\n\n      // Add timeout to PDF loading\n      const loadingPromise = pdfjsLib.getDocument({\n        data: arrayBuffer,\n        verbosity: 0 // Reduce console output\n      }).promise;\n\n      const timeoutPromise = new Promise((_, reject) =>\n        setTimeout(() => reject(new Error('PDF loading timed out')), 60000)\n      );\n\n      this.pdf = await Promise.race([loadingPromise, timeoutPromise]);\n\n      const numPages = this.pdf.numPages;\n\n      if (numPages === 0) {\n        throw new Error('PDF appears to be empty or corrupted');\n      }\n\n      return {\n        pdf: this.pdf,\n        numPages,\n        fileName: file.name,\n        fileSize: file.size\n      };\n\n    } catch (error) {\n      console.error('PDF loading error:', error);\n      throw this.handlePDFError(error);\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * Read file as ArrayBuffer\n   * @param {File} file - File to read\n   * @returns {Promise<ArrayBuffer>} File contents\n   */\n  readFileAsArrayBuffer(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = () => reject(new Error('Failed to read file'));\n      reader.onabort = () => reject(new Error('File reading was cancelled'));\n\n      reader.readAsArrayBuffer(file);\n    });\n  }\n\n  /**\n   * Render PDF page to canvas\n   * @param {number} pageNum - Page number to render\n   * @param {Function} onProgress - Progress callback\n   * @returns {Promise<HTMLCanvasElement>} Rendered canvas\n   */\n  async renderPage(pageNum, onProgress = null) {\n    if (!this.pdf) {\n      throw new Error('No PDF loaded');\n    }\n\n    try {\n      onProgress?.(`Rendering page ${pageNum}...`);\n\n      const page = await this.pdf.getPage(pageNum);\n      // Reduced scale for better performance and smaller data URLs\n      const scale = 1.5; // Balanced quality vs performance\n      const viewport = page.getViewport({ scale });\n\n      // Create canvas with proper dimensions\n      const canvas = document.createElement('canvas');\n      const context = canvas.getContext('2d', { alpha: false });\n\n      // Use viewport dimensions directly for better compatibility\n      canvas.width = Math.floor(viewport.width);\n      canvas.height = Math.floor(viewport.height);\n\n      // Fill background white\n      context.fillStyle = '#ffffff';\n      context.fillRect(0, 0, canvas.width, canvas.height);\n\n      // Render page to canvas\n      const renderContext = {\n        canvasContext: context,\n        viewport,\n        background: 'white'\n      };\n\n      await page.render(renderContext).promise;\n\n      console.log(`Rendered page ${pageNum}, canvas size: ${canvas.width}x${canvas.height}`);\n      return canvas;\n\n    } catch (error) {\n      console.error(`Failed to render page ${pageNum}:`, error);\n      throw new Error(`Failed to render page ${pageNum}`);\n    }\n  }\n\n  /**\n   * Convert canvas to Blob URL for performance\n   * @param {HTMLCanvasElement} canvas - Canvas to convert\n   * @returns {Promise<string>} Blob URL\n   */\n  async canvasToBlob(canvas) {\n    return new Promise((resolve) => {\n      canvas.toBlob((blob) => {\n        const url = URL.createObjectURL(blob);\n        resolve(url);\n      }, 'image/jpeg', 0.9);\n    });\n  }\n\n  /**\n   * Revoke a Blob URL to free memory\n   * @param {string} url - Blob URL to revoke\n   */\n  revokeBlobUrl(url) {\n    if (url && url.startsWith('blob:')) {\n      URL.revokeObjectURL(url);\n    }\n  }\n\n  /**\n   * Convert canvas to data URL (legacy/fallback)\n   * @param {HTMLCanvasElement} canvas - Canvas to convert\n   * @param {string} format - Image format ('image/png' or 'image/jpeg')\n   * @param {number} quality - Image quality (0-1, only for JPEG)\n   * @returns {string} Data URL\n   */\n  canvasToDataURL(canvas, format = 'image/jpeg', quality = 0.85) {\n    try {\n      // Use JPEG for smaller file sizes, PNG as fallback\n      const dataUrl = canvas.toDataURL(format, quality);\n      console.log(`Generated data URL, format: ${format}, size: ${dataUrl.length} chars`);\n      return dataUrl;\n    } catch (error) {\n      console.warn(`Failed to generate ${format}, falling back to PNG:`, error);\n      // Fallback to PNG if JPEG fails\n      return canvas.toDataURL('image/png', 1.0);\n    }\n  }\n\n  /**\n   * Handle PDF-specific errors\n   * @param {Error} error - Original error\n   * @returns {Error} Processed error\n   */\n  handlePDFError(error) {\n    const message = error.message || 'Unknown error';\n\n    if (message.includes('timed out')) {\n      return new Error('PDF loading timed out. The file may be corrupted or too large.');\n    }\n\n    if (message.includes('corrupted') || message.includes('InvalidPDFException')) {\n      return new Error('The PDF file appears to be corrupted or invalid.');\n    }\n\n    if (message.includes('password') || message.includes('protected')) {\n      return new Error('The PDF file is password-protected.');\n    }\n\n    if (message.includes('not loaded') || message.includes('MissingPDFException')) {\n      return new Error('PDF.js library failed to load. Please refresh the page.');\n    }\n\n    return new Error(`PDF processing failed: ${message}`);\n  }\n\n  /**\n   * Clean up resources\n   */\n  cleanup() {\n    if (this.pdf) {\n      this.pdf.destroy();\n      this.pdf = null;\n    }\n    this.isProcessing = false;\n  }\n}","export const PAPER_SIZES = {\n    a4: { label: 'A4 (210 × 297 mm)', width: 210, height: 297 },\n    a3: { label: 'A3 (297 × 420 mm)', width: 297, height: 420 },\n    letter: { label: 'Letter (8.5 × 11 in)', width: 215.9, height: 279.4 },\n    legal: { label: 'Legal (8.5 × 14 in)', width: 215.9, height: 355.6 },\n    a5: { label: 'A5 (148 × 210 mm)', width: 148, height: 210 }\n};\n\nexport const ORIENTATIONS = {\n    LANDSCAPE: 'landscape',\n    PORTRAIT: 'portrait'\n};\n\n/**\n * Zine template definitions\n * layout: Array of [pageNumber, isUpsideDown] tuples in grid order (row by row)\n */\nexport const ZINE_TEMPLATES = {\n    'mini-8': {\n        label: '8-Page Mini-Zine',\n        pages: 8,\n        grid: { rows: 2, cols: 4 },\n        // Grid order: row by row, left to right\n        layout: [\n            { page: 5, upsideDown: false }, { page: 4, upsideDown: true },\n            { page: 3, upsideDown: true }, { page: 2, upsideDown: true },\n            { page: 6, upsideDown: false }, { page: 7, upsideDown: false },\n            { page: 8, upsideDown: false }, { page: 1, upsideDown: false }\n        ],\n        gridAreas: `\n            \"page5 page4 page3 page2\"\n            \"page6 page7 page8 page1\"\n        `,\n        upsideDownPages: [2, 3, 4, 5],\n        cutLines: {\n            horizontal: { afterRow: 1 } // Cut between row 1 and 2\n        }\n    },\n    'accordion-16': {\n        label: '16-Page Accordion',\n        pages: 16,\n        grid: { rows: 4, cols: 4 },\n        layout: [\n            { page: 4, upsideDown: true }, { page: 3, upsideDown: true },\n            { page: 2, upsideDown: true }, { page: 1, upsideDown: true },\n            { page: 5, upsideDown: false }, { page: 6, upsideDown: false },\n            { page: 7, upsideDown: false }, { page: 8, upsideDown: false },\n            { page: 12, upsideDown: true }, { page: 11, upsideDown: true },\n            { page: 10, upsideDown: true }, { page: 9, upsideDown: true },\n            { page: 13, upsideDown: false }, { page: 14, upsideDown: false },\n            { page: 15, upsideDown: false }, { page: 16, upsideDown: false }\n        ],\n        gridAreas: `\n            \"page4 page3 page2 page1\"\n            \"page5 page6 page7 page8\"\n            \"page12 page11 page10 page9\"\n            \"page13 page14 page15 page16\"\n        `,\n        upsideDownPages: [1, 2, 3, 4, 9, 10, 11, 12],\n        // Cut lines for accordion fold - vertical cuts on left and right edges\n        cutLines: {\n            leftEdge: { rows: [0, 1, 2] },   // Cut through rows 1-3, leave row 4 intact\n            rightEdge: { rows: [0, 1, 2] }  // Same on right side\n        },\n        description: '1 sheet, 4×4 grid. Cut along edges then fold accordion-style.'\n    },\n    'dual-16': {\n        label: '16-Page Dual Sheets',\n        pages: 16,\n        sheets: 2, // Uses 2 separate 8-page mini-zine sheets\n        grid: { rows: 2, cols: 4 },\n        description: '2 sheets, each folded like an 8-page zine.'\n    }\n};\n","// Modern toast notification system\n\nclass Toast {\n  constructor() {\n    this.container = null;\n    this.init();\n  }\n\n  init() {\n    // Check if container already exists\n    this.container = document.getElementById('toast-container');\n\n    // Create toast container if it doesn't exist\n    if (!this.container) {\n      this.container = document.createElement('div');\n      this.container.id = 'toast-container';\n      this.container.className = 'toast-container fixed bottom-6 right-6 z-[300] flex flex-col gap-4 font-typewriter pointer-events-none';\n      this.container.setAttribute('aria-live', 'polite');\n      document.body.appendChild(this.container);\n    }\n  }\n\n  /**\n   * Show a toast notification\n   * @param {string} type - Toast type: 'success', 'error', 'warning', 'info'\n   * @param {string} title - Toast title\n   * @param {string} message - Toast message (optional)\n   * @param {number} duration - Duration in milliseconds (default: 5000)\n   */\n  show(type, title, message = '', duration = 5000) {\n    const toast = document.createElement('div');\n    toast.className = `toast toast-${type}`;\n    toast.setAttribute('role', 'alert');\n\n    const icon = this.getIcon(type);\n    const content = `\n      <div class=\"toast-icon\">${icon}</div>\n      <div class=\"toast-content\">\n        <div class=\"toast-title\">${title}</div>\n        ${message ? `<div class=\"toast-message\">${message}</div>` : ''}\n      </div>\n      <button class=\"toast-close\" aria-label=\"Close notification\">&times;</button>\n    `;\n\n    toast.innerHTML = content;\n    this.container.appendChild(toast);\n\n    // Add close button functionality\n    const closeBtn = toast.querySelector('.toast-close');\n    closeBtn.addEventListener('click', () => this.remove(toast));\n\n    // Auto remove after duration\n    if (duration > 0) {\n      setTimeout(() => {\n        if (toast.parentNode) {\n          this.remove(toast);\n        }\n      }, duration);\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n      toast.classList.add('toast-visible');\n      // Add slight random rotation for chaos\n      const rotation = Math.random() * 4 - 2;\n      toast.style.transform = `translateX(0) rotate(${rotation}deg)`;\n    });\n\n    return toast;\n  }\n\n  /**\n   * Remove a toast notification\n   * @param {Element} toast - Toast element to remove\n   */\n  remove(toast) {\n    toast.classList.remove('toast-visible');\n    setTimeout(() => {\n      if (toast.parentNode) {\n        toast.parentNode.removeChild(toast);\n      }\n    }, 300); // Match CSS transition duration\n  }\n\n  /**\n   * Get icon SVG for toast type\n   * @param {string} type - Toast type\n   * @returns {string} SVG icon HTML\n   */\n  getIcon(type) {\n    const icons = {\n      success: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n        <polyline points=\"22,4 12,14.01 9,11.01\"/>\n      </svg>`,\n      error: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/>\n        <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/>\n      </svg>`,\n      warning: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/>\n        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/>\n        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\n      </svg>`,\n      info: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"M12 16v-4\"/>\n        <path d=\"M12 8h.01\"/>\n      </svg>`\n    };\n    return icons[type] || icons.info;\n  }\n\n  // Convenience methods\n  success(title, message, duration) {\n    return this.show('success', title, message, duration);\n  }\n\n  error(title, message, duration) {\n    return this.show('error', title, message, duration);\n  }\n\n  warning(title, message, duration) {\n    return this.show('warning', title, message, duration);\n  }\n\n  info(title, message, duration) {\n    return this.show('info', title, message, duration);\n  }\n}\n\n// Export singleton instance\nexport const toast = new Toast();","// Modern UI management class\nimport mitt from 'mitt';\nimport { PAPER_SIZES, ZINE_TEMPLATES } from './config.js';\nimport { toast } from './toast.js';\n\nexport class UIManager {\n  constructor() {\n    this.emitter = mitt();\n    this.elements = {};\n    this.paperSize = 'a4';\n    this.orientation = 'landscape';\n    this.init();\n  }\n\n  /**\n   * Initialize UI elements and event listeners\n   */\n  init() {\n    this.cacheElements();\n    this.renderPaperSizeOptions();\n    this.loadSettings();\n    this.updatePreviewLayout();\n    this.setupEventListeners();\n\n    // Ensure preview is visible and enabled on load\n    if (this.elements.previewArea) {\n      this.elements.previewArea.classList.remove('opacity-50', 'pointer-events-none');\n    }\n  }\n\n\n  /**\n   * Cache DOM elements for performance\n   */\n  cacheElements() {\n    const $ = (selector) => document.querySelector(selector);\n\n    this.elements = {\n      // Main Containers\n      uploadZone: $('#upload-zone'),\n      previewArea: $('#preview-area'),\n      actionButtons: $('#action-buttons'),\n      previewDescription: $('#preview-description'),\n      zineSheetsContainer: $('#zine-sheets-container'),\n\n      // Interactions\n      printBtn: $('#printBtn'),\n      exportPdfBtn: $('#exportPdfBtn'),\n      pdfUpload: $('#pdf-upload'),\n      uploadStatus: $('#upload-status'),\n\n      // Progress\n      progressContainer: $('#progress-container'),\n      progressFill: $('#progress-fill'),\n      progressText: $('#progress-text'),\n      progressSubtext: $('#progress-subtext'),\n\n      // Settings\n      paperSizeSelect: $('#paper-size-select'),\n      orientationSelect: $('#orientation-select'),\n      pageNumbersCheckbox: $('#show-page-numbers'),\n\n      // Toast\n      toastContainer: $('#toast-container'),\n\n      // Zine Tabs\n      zineTabs: $('#zine-tabs'),\n      zineTab1: $('#zine-tab-1'),\n      zineTab2: $('#zine-tab-2'),\n\n      gridRows: $('#grid-rows'),\n      gridCols: $('#grid-cols'),\n      gridTotal: $('#grid-total'),\n\n      // Unused Pages Bucket\n      unusedSection: $('#unused-pages-section'),\n      unusedGrid: $('#unused-grid')\n    };\n\n  }\n\n\n\n  /**\n   * Render paper size options from constants\n   */\n  renderPaperSizeOptions() {\n    if (!this.elements.paperSizeSelect) { return; }\n\n    this.elements.paperSizeSelect.innerHTML = Object.entries(PAPER_SIZES)\n      .map(([id, data]) => `<option value=\"${id}\">${data.label}</option>`)\n      .join('');\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    // Settings\n    this.elements.paperSizeSelect?.addEventListener('change', (e) => this.updatePaperSize(e.target.value));\n    this.elements.orientationSelect?.addEventListener('change', (e) => this.updateOrientation(e.target.value));\n    this.elements.pageNumbersCheckbox?.addEventListener('change', (e) => this.togglePageNumbers(e.target.checked));\n\n    // Upload interactions\n    this.elements.uploadZone?.addEventListener('click', () => this.triggerFileUpload());\n    this.elements.uploadZone?.addEventListener('dragover', (e) => this.handleDragOver(e));\n    this.elements.uploadZone?.addEventListener('dragleave', (e) => this.handleDragLeave(e));\n    this.elements.uploadZone?.addEventListener('drop', (e) => this.handleFileDrop(e));\n\n    this.elements.pdfUpload?.addEventListener('change', (e) => {\n      const file = e.target.files[0];\n      if (file) { this.emitter.emit('fileSelected', file); }\n    });\n\n\n    // Grid size inputs\n    const handleGridChange = () => {\n      const rows = parseInt(this.elements.gridRows?.value) || 2;\n      const cols = parseInt(this.elements.gridCols?.value) || 4;\n      if (this.elements.gridTotal) {\n        this.elements.gridTotal.textContent = `(${rows * cols} pages)`;\n      }\n      this.emitter.emit('gridSizeChanged', { rows, cols });\n    };\n    this.elements.gridRows?.addEventListener('input', handleGridChange);\n    this.elements.gridCols?.addEventListener('input', handleGridChange);\n\n    // Keyboard\n    document.addEventListener('keydown', (e) => this.handleKeyboard(e));\n  }\n\n\n\n\n\n  /**\n   * Set the UI to \"ready\" state (enable preview area and action buttons)\n   */\n  setReady(ready, description = null) {\n    if (ready) {\n      this.elements.previewArea?.classList.remove('opacity-30', 'pointer-events-none');\n      this.elements.actionButtons?.classList.remove('hidden');\n    } else {\n      this.elements.previewArea?.classList.add('opacity-30', 'pointer-events-none');\n      this.elements.actionButtons?.classList.add('hidden');\n    }\n\n    if (description && this.elements.previewDescription) {\n      this.elements.previewDescription.textContent = description;\n    }\n  }\n\n  /**\n   * Update progress bar\n   */\n  updateProgress(percent) {\n    if (this.elements.progressFill) {\n      this.elements.progressFill.style.width = `${percent}%`;\n    }\n  }\n\n  /**\n   * Update status message\n   */\n  setStatus(message, type = 'info') {\n    if (this.elements.uploadStatus) {\n      this.elements.uploadStatus.textContent = message;\n      this.elements.uploadStatus.className = `text-[11px] uppercase font-bold tracking-wider ${type === 'error' ? 'text-red-500' : type === 'success' ? 'text-green-500' : 'text-gray-400'\n        }`;\n    }\n  }\n\n  /**\n   * Generate sheets and page placeholders\n   * @param {number} numPages - Number of pages in the PDF\n   * @param {string} templateType - Template type: 'mini-8', 'dual-16', or 'accordion-16'\n   */\n  generateLayout(numPages = 8, templateType = null) {\n    if (!this.elements.zineSheetsContainer) { return; }\n    this.elements.zineSheetsContainer.innerHTML = '';\n\n    // Auto-detect template if not specified\n    if (!templateType) {\n      if (numPages > 8) {\n        templateType = 'accordion-16'; // Default to accordion for 9-16 pages\n      } else {\n        templateType = 'mini-8';\n      }\n    }\n\n    this.currentTemplate = templateType;\n    const template = ZINE_TEMPLATES[templateType];\n\n    if (!template) {\n      console.error(`Unknown template: ${templateType}`);\n      return;\n    }\n\n    // For accordion-16, we use a single sheet with 4x4 grid\n    if (templateType === 'accordion-16') {\n      this.generateAccordionLayout(template);\n    } else {\n      // Mini-8 or dual-16 (two 8-page sheets)\n      this.generateMiniZineLayout(numPages, template);\n    }\n\n    this.updatePreviewLayout();\n\n    // Ensure preview is visible and enabled\n    if (this.elements.previewArea) {\n      this.elements.previewArea.classList.remove('opacity-50', 'pointer-events-none');\n    }\n  }\n\n\n  /**\n   * Generate a custom grid layout with specified rows and columns\n   */\n  generateCustomGrid(rows, cols, totalPDFPages = 0) {\n    this.elements.zineSheetsContainer.innerHTML = '';\n    const totalSlots = rows * cols;\n    // Ensure we account for all pages if totalPDFPages is larger\n    const actualPages = Math.max(totalSlots, totalPDFPages);\n\n    const sheetWrapper = document.createElement('div');\n    sheetWrapper.className = 'print-sheet w-full p-0 relative overflow-hidden rounded-sm';\n    sheetWrapper.setAttribute('data-sheet', 1);\n    sheetWrapper.setAttribute('data-template', `custom-${rows}x${cols}`);\n\n    const grid = document.createElement('div');\n    grid.className = 'zine-grid';\n    grid.id = 'zine-grid-sheet-1';\n    grid.style.display = 'grid';\n    grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;\n    grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;\n    grid.style.gridTemplateAreas = 'none'; // Critical: override default CSS areas\n\n    for (let i = 0; i < totalSlots; i++) {\n      const pageNum = i + 1;\n      const cell = document.createElement('div');\n      cell.className = 'page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden transition-all duration-200';\n      cell.setAttribute('data-page-index', i);\n      cell.setAttribute('data-page', pageNum);\n      cell.setAttribute('draggable', 'true');\n\n      const labelText = pageNum === 1 ? 'Cover' : (pageNum === totalSlots ? 'Back' : `Page ${pageNum}`);\n\n      cell.innerHTML = `\n        <span class=\"page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]\">${labelText}</span>\n        <button class=\"flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all\" title=\"Flip page\">\n            <span class=\"material-symbols-outlined text-lg font-bold\">rotate_right</span>\n        </button>\n        <div class=\"page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest\">Empty</div>\n        <img alt=\"Page ${pageNum}\" class=\"page-content-img w-full h-full object-contain hidden\" draggable=\"false\" />\n      `;\n\n      this.setupDragAndDrop(cell);\n      this.setupFlipButton(cell);\n      grid.appendChild(cell);\n    }\n\n    sheetWrapper.appendChild(grid);\n    this.elements.zineSheetsContainer.appendChild(sheetWrapper);\n\n    // Generate bucket for extra pages\n    this.generateUnusedBucket(totalSlots, actualPages);\n\n    this.updatePreviewLayout();\n  }\n\n  generateUnusedBucket(startIndex, totalPages) {\n    const { unusedSection, unusedGrid } = this.elements;\n    if (!unusedSection || !unusedGrid) { return; }\n\n    unusedGrid.innerHTML = '';\n\n    // If no extra pages, hide the section\n    if (startIndex >= totalPages) {\n      unusedSection.classList.add('hidden');\n      return;\n    }\n\n    unusedSection.classList.remove('hidden');\n\n    // Create slots for remaining pages\n    for (let i = startIndex; i < totalPages; i++) {\n      const cell = document.createElement('div');\n      // Using similar but distinct styling for bucket items\n      cell.className = 'page-cell bg-white aspect-[1/1.414] relative rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing hover:border-blue-500 transition-colors duration-200';\n      cell.setAttribute('data-page-index', i);\n      cell.draggable = true;\n\n      const img = document.createElement('img');\n      img.className = 'page-content-img w-full h-full object-contain hidden pointer-events-none';\n      img.draggable = false;\n\n      const label = document.createElement('div');\n      label.className = 'absolute top-1 left-1 bg-gray-500 text-white text-[8px] px-1.5 py-0.5 rounded-sm font-bold z-10';\n      label.textContent = `#${i + 1}`;\n\n      const placeholder = document.createElement('div');\n      placeholder.className = 'text-[10px] uppercase font-bold text-gray-300 select-none';\n      placeholder.textContent = 'Unused';\n\n      cell.appendChild(label);\n      cell.appendChild(placeholder);\n      cell.appendChild(img);\n\n      this.setupDragAndDrop(cell);\n      unusedGrid.appendChild(cell);\n    }\n  }\n\n  /**\n   * Generate the accordion-16 layout (single sheet, 4x4 grid)\n   */\n  generateAccordionLayout(template) {\n    const sheetWrapper = document.createElement('div');\n    sheetWrapper.className = 'print-sheet w-full p-0 relative overflow-hidden rounded-sm';\n    sheetWrapper.setAttribute('data-sheet', 1);\n    sheetWrapper.setAttribute('data-template', 'accordion-16');\n\n    const grid = document.createElement('div');\n    grid.className = 'zine-grid accordion-16';\n    grid.id = 'zine-grid-sheet-1';\n    grid.style.display = 'grid';\n    grid.style.gridTemplateColumns = 'repeat(4, 1fr)';\n    grid.style.gridTemplateRows = 'repeat(4, 1fr)';\n\n    // Generate cells based on template layout\n    template.layout.forEach((item) => {\n      const cell = document.createElement('div');\n      cell.className = 'page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden';\n      cell.setAttribute('data-page-index', item.page - 1);\n      cell.setAttribute('data-page', item.page);\n      cell.setAttribute('draggable', 'true');\n\n      const labelText = item.page === 1 ? 'Cover' : (item.page === 16 ? 'Back' : `Page ${item.page}`);\n\n      cell.innerHTML = `\n        <span class=\"page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]\">${labelText}</span>\n        <button class=\"flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all\" title=\"Flip page\">\n            <span class=\"material-symbols-outlined text-lg font-bold\">rotate_right</span>\n        </button>\n        <div class=\"page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest\">Empty</div>\n        <img alt=\"Page ${item.page}\" class=\"page-content-img w-full h-full object-contain hidden\" draggable=\"false\" />\n      `;\n\n      this.setupDragAndDrop(cell);\n      this.setupFlipButton(cell);\n      grid.appendChild(cell);\n    });\n\n    sheetWrapper.appendChild(grid);\n\n    // Add fold guidelines for accordion\n    const guidelines = `\n      <div class=\"absolute top-1/4 left-0 w-full border-t border-blue-400/30 pointer-events-none\"></div>\n      <div class=\"absolute top-1/2 left-0 w-full border-t border-blue-400/30 pointer-events-none\"></div>\n      <div class=\"absolute top-3/4 left-0 w-full border-t border-blue-400/30 pointer-events-none\"></div>\n      <div class=\"absolute top-0 left-1/4 h-full border-l border-blue-400/30 pointer-events-none\"></div>\n      <div class=\"absolute top-0 left-1/2 h-full border-l border-blue-400/30 pointer-events-none\"></div>\n      <div class=\"absolute top-0 left-3/4 h-full border-l border-blue-400/30 pointer-events-none\"></div>\n    `;\n    sheetWrapper.insertAdjacentHTML('beforeend', guidelines);\n\n    // Cut lines removed per user request\n\n    this.elements.zineSheetsContainer.appendChild(sheetWrapper);\n  }\n\n  /**\n   * Generate mini-zine layout (8-page single or dual sheets)\n   */\n  generateMiniZineLayout(numPages, _template) {\n    const numSheets = numPages > 8 ? 2 : 1;\n\n    for (let s = 1; s <= numSheets; s++) {\n      const sheetWrapper = document.createElement('div');\n      sheetWrapper.className = 'print-sheet w-full p-0 relative overflow-hidden rounded-sm';\n      sheetWrapper.setAttribute('data-sheet', s);\n\n      const grid = document.createElement('div');\n      grid.className = 'zine-grid';\n      grid.id = `zine-grid-sheet-${s}`;\n      grid.style.display = 'grid';\n      grid.style.gridTemplateColumns = 'repeat(4, 1fr)';\n      grid.style.gridTemplateRows = 'repeat(2, 1fr)';\n\n      for (let i = 1; i <= 8; i++) {\n        const pageIdx = (s - 1) * 8 + i;\n        const cell = document.createElement('div');\n        cell.className = 'page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden';\n        cell.setAttribute('data-page-index', pageIdx - 1);\n        cell.setAttribute('data-page', i);\n        cell.setAttribute('draggable', 'true');\n\n        const labelText = i === 1 ? 'Cover' : (i === 8 ? 'Back' : `Page ${i}`);\n        const sheetLabel = numSheets > 1 ? ` <span class=\"opacity-50 text-[8px] ml-1\">(Sheet ${s})</span>` : '';\n\n        cell.innerHTML = `\n          <span class=\"page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]\">${labelText}${sheetLabel}</span>\n          <button class=\"flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all\" title=\"Flip page\">\n              <span class=\"material-symbols-outlined text-lg font-bold\">rotate_right</span>\n          </button>\n          <div class=\"page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest\">Empty</div>\n          <img alt=\"Page ${pageIdx}\" class=\"page-content-img w-full h-full object-contain hidden\" draggable=\"false\" />\n        `;\n\n        this.setupDragAndDrop(cell);\n        this.setupFlipButton(cell);\n        grid.appendChild(cell);\n      }\n\n      // Guidelines\n      const guidelines = `\n        <div class=\"absolute top-1/2 left-0 w-full border-t border-blue-400/20 pointer-events-none\"></div>\n        <div class=\"absolute top-0 left-1/4 h-full border-l border-blue-400/20 pointer-events-none\"></div>\n        <div class=\"absolute top-0 left-1/2 h-full border-l border-blue-400/20 pointer-events-none\"></div>\n        <div class=\"absolute top-0 left-3/4 h-full border-l border-blue-400/20 pointer-events-none\"></div>\n      `;\n\n      sheetWrapper.appendChild(grid);\n      sheetWrapper.insertAdjacentHTML('beforeend', guidelines);\n      this.elements.zineSheetsContainer.appendChild(sheetWrapper);\n    }\n  }\n\n  setupDragAndDrop(cell) {\n    cell.addEventListener('dragstart', (e) => {\n      e.dataTransfer.setData('text/plain', cell.getAttribute('data-page-index'));\n      cell.classList.add('dragging');\n    });\n\n    cell.addEventListener('dragend', () => {\n      cell.classList.remove('dragging');\n      document.querySelectorAll('.page-cell').forEach(c => c.classList.remove('drag-over'));\n    });\n\n    cell.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      cell.classList.add('drag-over');\n    });\n\n    cell.addEventListener('dragleave', () => {\n      cell.classList.remove('drag-over');\n    });\n\n    cell.addEventListener('drop', (e) => {\n      e.preventDefault();\n      cell.classList.remove('drag-over');\n      const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));\n      const toIndex = parseInt(cell.getAttribute('data-page-index'));\n\n      if (fromIndex !== toIndex) {\n        this.emitter.emit('pagesSwapped', { fromIndex, toIndex });\n      }\n    });\n  }\n\n  updatePagePreview(pageIndex, dataUrl) {\n    // Search in both main container (by data-page-index) and unused grid\n    // Note: Use querySelectorAll to catch duplicates if any, but usually unique by index\n    const cells = [\n      ...Array.from(this.elements.zineSheetsContainer.querySelectorAll(`.page-cell[data-page-index=\"${pageIndex}\"]`)),\n      ...(this.elements.unusedGrid ? Array.from(this.elements.unusedGrid.querySelectorAll(`.page-cell[data-page-index=\"${pageIndex}\"]`)) : [])\n    ];\n\n    cells.forEach(cell => {\n      const img = cell.querySelector('.page-content-img');\n      const placeholder = cell.querySelector('.page-placeholder');\n\n      // Handle \"Unused\" placeholder structure which is different\n      const unusedPlaceholder = cell.querySelector('.text-gray-300'); // The 'Unused' text div\n\n      if (dataUrl) {\n        if (img) {\n          img.src = dataUrl;\n          img.classList.remove('hidden');\n        }\n        if (placeholder) { placeholder.classList.add('hidden'); }\n        // Hide \"Unused\" text if present\n        if (unusedPlaceholder && unusedPlaceholder.textContent === 'Unused') {\n          unusedPlaceholder.classList.add('hidden');\n        }\n      } else {\n        if (img) {\n          img.src = '';\n          img.classList.add('hidden');\n        }\n        if (placeholder) { placeholder.classList.remove('hidden'); }\n        if (unusedPlaceholder && unusedPlaceholder.textContent === 'Unused') {\n          unusedPlaceholder.classList.remove('hidden');\n        }\n      }\n    });\n\n    // Also force show the bucket section if we are populating it\n    if (this.elements.unusedGrid && this.elements.unusedGrid.children.length > 0) {\n      this.elements.unusedSection.classList.remove('hidden');\n    }\n  }\n\n  /**\n   * Setup flip button click handler for a cell\n   */\n  setupFlipButton(cell) {\n    const flipBtn = cell.querySelector('.flip-btn');\n    if (flipBtn) {\n      flipBtn.addEventListener('click', (e) => {\n        e.stopPropagation(); // Prevent drag\n        const pageIndex = parseInt(cell.getAttribute('data-page-index'));\n        this.emitter.emit('pageFlipped', pageIndex);\n      });\n    }\n  }\n\n  /**\n   * Apply flip state to a page\n   */\n  setPageFlip(pageIndex, isFlipped) {\n    const cell = this.elements.zineSheetsContainer.querySelector(`[data-page-index=\"${pageIndex}\"]`);\n    if (cell) {\n      const img = cell.querySelector('.page-content-img');\n      if (img) {\n        if (isFlipped) {\n          img.style.transform = `${img.style.transform || ''} rotate(180deg)`.trim();\n          img.classList.add('flipped');\n        } else {\n          img.style.transform = img.style.transform.replace('rotate(180deg)', '').trim();\n          img.classList.remove('flipped');\n        }\n      }\n    }\n  }\n\n  setActiveTab() {\n    // Obsolete\n  }\n\n  triggerFileUpload() {\n    this.elements.pdfUpload?.click();\n  }\n\n  handleDragOver(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.elements.uploadZone) {\n      this.elements.uploadZone.classList.add('dragover');\n    }\n  }\n\n  handleDragLeave(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.elements.uploadZone && !this.elements.uploadZone.contains(e.relatedTarget)) {\n      this.elements.uploadZone.classList.remove('dragover');\n    }\n  }\n\n  handleFileDrop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.elements.uploadZone) {\n      this.elements.uploadZone.classList.remove('dragover');\n    }\n\n    const files = e.dataTransfer.files;\n    if (files.length > 0 && files[0].type === 'application/pdf') {\n      this.emitter.emit('fileSelected', files[0]);\n    } else {\n      toast.error('Invalid File', 'Please drop a valid PDF file');\n    }\n  }\n\n  handleKeyboard(e) {\n    // Global keyboard shortcuts\n    if (e.key === 'p' && (e.metaKey || e.ctrlKey)) {\n      e.preventDefault();\n      this.emitter.emit('print');\n    }\n  }\n\n  showProgress(show, text = 'Processing PDF...', subtext = '') {\n    if (show) {\n      if (this.elements.progressContainer) {\n        this.elements.progressContainer.classList.remove('hidden');\n        this.elements.progressContainer.classList.add('flex');\n      }\n    } else {\n      if (this.elements.progressContainer) {\n        this.elements.progressContainer.classList.add('hidden');\n        this.elements.progressContainer.classList.remove('flex');\n      }\n    }\n\n    if (this.elements.progressText) { this.elements.progressText.textContent = text; }\n    if (this.elements.progressSubtext) { this.elements.progressSubtext.textContent = subtext; }\n  }\n\n  /**\n   * Load settings from localStorage\n   */\n  loadSettings() {\n    const savedPaperSize = localStorage.getItem('paperSize');\n    const savedOrientation = localStorage.getItem('orientation');\n\n    if (savedPaperSize) {\n      this.paperSize = savedPaperSize;\n      if (this.elements.paperSizeSelect) { this.elements.paperSizeSelect.value = savedPaperSize; }\n    }\n\n    if (savedOrientation) {\n      this.orientation = savedOrientation;\n      if (this.elements.orientationSelect) { this.elements.orientationSelect.value = savedOrientation; }\n    }\n  }\n\n  updatePaperSize(paperSize) {\n    this.paperSize = paperSize;\n    localStorage.setItem('paperSize', paperSize);\n    this.updatePreviewLayout();\n    this.emitter.emit('paperSizeChanged', { paperSize, orientation: this.orientation });\n  }\n\n  updateOrientation(orientation) {\n    this.orientation = orientation;\n    localStorage.setItem('orientation', orientation);\n    this.updatePreviewLayout();\n    this.emitter.emit('orientationChanged', { paperSize: this.paperSize, orientation });\n  }\n\n  togglePageNumbers(show) {\n    const labels = document.querySelectorAll('.page-label');\n    labels.forEach(label => {\n      if (show) {\n        label.classList.remove('hidden');\n        label.classList.add('centered'); // Force centered style when shown per user request\n      } else {\n        label.classList.add('hidden');\n        label.classList.remove('centered');\n      }\n    });\n  }\n\n\n  updatePreviewLayout() {\n    const sheets = document.querySelectorAll('.print-sheet');\n    if (!sheets.length) { return; }\n\n    // Get dimensions for the current selection\n    const dims = this.getPaperDimensions(this.paperSize, this.orientation);\n    // Calculate ratio (width / height)\n    const ratio = dims.width / dims.height;\n\n    sheets.forEach(sheet => {\n      // 1. Set Aspect Ratio\n      sheet.style.aspectRatio = `${ratio}`;\n\n      // 2. Fit to Screen Logic\n      // We want the sheet to fit within, say, 75vh to leave room for headers/controls\n      // and max-width 100% of container.\n      sheet.style.maxHeight = '75vh';\n      sheet.style.maxWidth = '100%'; // Ensure it fits in the container width\n      sheet.style.margin = '0 auto'; // Center it\n    });\n  }\n\n  getPaperDimensions(paperSize, orientation) {\n    const size = PAPER_SIZES[paperSize] || PAPER_SIZES.a4;\n\n    if (orientation === 'landscape') {\n      return { width: size.height, height: size.width };\n    }\n\n    return { width: size.width, height: size.height };\n  }\n\n  getPaperSizeLabel(paperSize) {\n    return PAPER_SIZES[paperSize]?.label || 'A4';\n  }\n\n  hasContent() {\n    return this.elements.zineSheetsContainer &&\n      this.elements.zineSheetsContainer.querySelector('.page-content-img:not(.hidden)') !== null;\n  }\n\n  on(event, handler) {\n    this.emitter.on(event, handler);\n  }\n}","export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","export default \"__VITE_ASSET__BJ2yq0m$__\"","import '../styles/index.css';\nimport { PDFProcessor } from './pdf-processor.js';\nimport { UIManager } from './zine-ui.js';\nimport { toast } from './toast.js';\nimport { formatFileSize } from './utils.js';\nimport { jsPDF } from 'jspdf';\nimport html2canvas from 'html2canvas';\n\n// Import assets\nimport referenceImageUrl from '../assets/reference-back-side.jpg';\n\nclass PDFZineMaker {\n  constructor() {\n    this.pdfProcessor = new PDFProcessor();\n    this.ui = new UIManager();\n    this.referenceImageUrl = referenceImageUrl;\n    this.allPageImages = new Array(16).fill(null);\n    this.pageFlips = {}; // Track individual page flips: { pageIndex: true/false }\n    this.gridSize = { rows: 2, cols: 4 }; // Default grid size\n    this.init();\n  }\n\n\n  /**\n   * Initialize the application\n   */\n  async init() {\n    try {\n      await this.pdfProcessor.initialize();\n      this.setupEventListeners();\n      this.ui.generateLayout(8); // Default to 8 pages\n      this.ui.setStatus('Upload a PDF file to get started', 'info');\n    } catch (error) {\n      console.error('Initialization error:', error);\n      this.ui.setStatus('Failed to initialize. Please refresh the page.', 'error');\n      toast.error('Initialization Error', 'Failed to load required libraries.');\n    }\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    // UI Events\n    this.ui.on('fileSelected', (file) => this.handleFileSelected(file));\n    this.ui.on('print', () => this.handlePrint());\n    this.ui.on('export', () => this.handleExport());\n    this.ui.on('paperSizeChanged', (data) => this.updatePaperSettings(data));\n    this.ui.on('orientationChanged', (data) => this.updatePaperSettings(data));\n    this.ui.on('pagesSwapped', (data) => this.handlePagesSwapped(data));\n    this.ui.on('pageFlipped', (pageIndex) => this.handlePageFlipped(pageIndex));\n    this.ui.on('gridSizeChanged', (data) => this.handleGridSizeChanged(data));\n  }\n\n  /**\n   * Handle individual page flip\n   */\n  handlePageFlipped(pageIndex) {\n    this.pageFlips[pageIndex] = !this.pageFlips[pageIndex];\n    this.ui.setPageFlip(pageIndex, this.pageFlips[pageIndex]);\n  }\n\n  /**\n   * Handle grid size change\n   */\n  handleGridSizeChanged({ rows, cols }) {\n    this.gridSize = { rows, cols };\n    const totalPages = rows * cols;\n\n    // Generate a custom grid layout\n    this.ui.generateCustomGrid(rows, cols, this.allPageImages.length);\n\n    // Re-apply existing page images\n    for (let i = 0; i < Math.min(totalPages, this.allPageImages.length); i++) {\n      if (this.allPageImages[i]) {\n        this.ui.updatePagePreview(i, this.allPageImages[i]);\n      }\n    }\n  }\n\n\n\n  handleFileSelected(file) {\n    this.selectedFile = file;\n    this.ui.setStatus(`File selected: ${file.name} (${formatFileSize(file.size)})`, 'success');\n    // Start processing immediately on selection for better UX\n    this.processPDF(file);\n  }\n\n  async processPDF(file) {\n    try {\n      toast.info('Reading PDF...', 'Please wait');\n      this.ui.showProgress(true, 'Reading PDF...', '0%');\n\n      const result = await this.pdfProcessor.loadPDF(file, (progress) => {\n        this.ui.updateProgress(progress);\n      });\n\n      const { numPages } = result;\n      this.selectedLayout = numPages; // Allow any number of pages\n      const maxPages = numPages;\n\n      let rows, cols;\n\n      if (numPages === 16) {\n        // Special case for 16-page zine (accordion fold on single sheet)\n        rows = 4;\n        cols = 4;\n        this.gridSize = { rows, cols };\n        this.ui.generateLayout(16, 'accordion-16');\n      } else {\n        // Determine grid size based on page count\n        // Try to find a square-ish grid that fits all pages\n        const sqrt = Math.ceil(Math.sqrt(numPages));\n        // Default to at least 2x4 for small docs, otherwise square-ish\n        rows = numPages <= 8 ? 2 : (sqrt > 2 ? sqrt : 2);\n        cols = numPages <= 8 ? 4 : Math.ceil(numPages / rows);\n\n        // Ensure we don't exceed max grid input (10x10)\n        rows = Math.min(rows, 10);\n        cols = Math.min(cols, 10);\n\n        this.gridSize = { rows, cols }; // Update internal state\n\n        this.allPageImages = new Array(Math.max(rows * cols, numPages)).fill(null);\n        this.ui.generateCustomGrid(rows, cols, this.allPageImages.length);\n      }\n\n      // Update grid inputs to match\n      if (this.ui.elements.gridRows) {\n        this.ui.elements.gridRows.value = rows;\n      }\n      if (this.ui.elements.gridCols) {\n        this.ui.elements.gridCols.value = cols;\n      }\n      if (this.ui.elements.gridTotal) {\n        this.ui.elements.gridTotal.textContent = `(${rows * cols} pages)`;\n      }\n\n      const description = `PDF arranged into a ${rows}×${cols} grid (${rows * cols} pages)`;\n      this.ui.setReady(true, description);\n\n\n\n      // Process pages\n      for (let i = 1; i <= maxPages; i++) {\n        const canvas = await this.pdfProcessor.renderPage(i);\n        const url = await this.pdfProcessor.canvasToBlob(canvas);\n\n        // Revoke old URL if it exists\n        if (this.allPageImages[i - 1]) {\n          this.pdfProcessor.revokeBlobUrl(this.allPageImages[i - 1]);\n        }\n\n        this.allPageImages[i - 1] = url;\n        this.ui.updatePagePreview(i - 1, url);\n\n        const percent = Math.round((i / maxPages) * 100);\n        this.ui.showProgress(true, `Processing Page ${i} of ${maxPages}`, `${percent}%`);\n        this.ui.updateProgress(percent);\n      }\n\n      // Fill blanks - using the same blank page logic\n      for (let i = maxPages + 1; i <= (this.selectedLayout); i++) {\n        await this.createBlankPage(i);\n      }\n\n      this.ui.showProgress(false);\n      this.ui.setStatus(`Successfully processed ${numPages} pages`, 'success');\n      toast.success('Done!', 'Your zine is ready to print.');\n\n    } catch (error) {\n      console.error('PDF Error:', error);\n      this.ui.showProgress(false);\n      toast.error('Error', 'Failed to process PDF.');\n    }\n  }\n\n  async createBlankPage(pageNum) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1000;\n    canvas.height = 1400;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    ctx.fillRect(0, 0, 1000, 1400);\n    ctx.fillStyle = '#f3f4f6';\n    ctx.font = 'bold 80px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('BLANK', 500, 700);\n\n    const url = await this.pdfProcessor.canvasToBlob(canvas);\n\n    // Revoke old URL if it exists\n    if (this.allPageImages[pageNum - 1]) {\n      this.pdfProcessor.revokeBlobUrl(this.allPageImages[pageNum - 1]);\n    }\n\n    this.allPageImages[pageNum - 1] = url;\n    this.ui.updatePagePreview(pageNum - 1, url);\n  }\n\n  handlePagesSwapped({ fromIndex, toIndex }) {\n    // Swap images in array\n    const temp = this.allPageImages[fromIndex];\n    this.allPageImages[fromIndex] = this.allPageImages[toIndex];\n    this.allPageImages[toIndex] = temp;\n\n    // Swap flip states\n    const tempFlip = this.pageFlips[fromIndex];\n    this.pageFlips[fromIndex] = this.pageFlips[toIndex];\n    this.pageFlips[toIndex] = tempFlip;\n\n    // Update previews\n    this.ui.updatePagePreview(fromIndex, this.allPageImages[fromIndex]);\n    this.ui.updatePagePreview(toIndex, this.allPageImages[toIndex]);\n\n    // Update flip UI\n    this.ui.setPageFlip(fromIndex, !!this.pageFlips[fromIndex]);\n    this.ui.setPageFlip(toIndex, !!this.pageFlips[toIndex]);\n\n\n    toast.info('Pages swapped');\n  }\n\n  updateZineView(zineNum) {\n    // Update the UI to show the correct 8 pages for the selected zine (1 or 2)\n    const startPageIndex = (zineNum - 1) * 8;\n    for (let i = 0; i < 8; i++) {\n      const globalPageIndex = startPageIndex + i;\n      const imageUrl = this.allPageImages[globalPageIndex];\n      this.ui.updatePagePreview(i, imageUrl); // Update the 8 visible cells\n    }\n  }\n\n  updatePaperSettings(settings) {\n    this.paperSize = settings.paperSize;\n    this.orientation = settings.orientation;\n  }\n\n  handlePrint() {\n    if (!this.ui.hasContent()) {\n      toast.warning('No Content', 'Upload a PDF to print!');\n      return;\n    }\n\n    // Audit check: Are all pages filled?\n    // We won't block it, but we could warn if it's empty.\n\n    this.createPrintLayout();\n  }\n\n  createPrintLayout() {\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) {\n      toast.error('Blocked', 'Please allow popups.');\n      return;\n    }\n\n\n    const zineSheets = [];\n\n    // Get HTML for all sheets\n    document.querySelectorAll('.zine-grid').forEach(grid => {\n      zineSheets.push(grid.innerHTML);\n    });\n\n    const dimensions = this.ui.getPaperDimensions(this.paperSize || 'a4', this.orientation || 'landscape');\n\n\n    // Dynamic grid CSS based on current settings\n    const { rows, cols } = this.gridSize;\n    const gridCss = `\n      grid-template-columns: repeat(${cols}, 1fr);\n      grid-template-rows: repeat(${rows}, 1fr);\n      grid-template-areas: none !important;\n      /* Generate grid areas if needed, but simple flow usually works for generic grids */\n    `;\n\n    // We rely on the DOM's inline styles for rotation now, \n    // so we don't need hardcoded rotation CSS.\n    // The cut lines are also specific to the old layout, so we'll omit them for generic grids\n    // or maybe add them later if we implement smart cut lines.\n    const cutLinesCss = '';\n\n\n    const cutLinesHtml = '';\n\n    const sheetsHtml = zineSheets.map((content) => `\n      <div class=\"sheet\">\n        <div class=\"zine-grid\">${content}</div>\n        ${cutLinesHtml}\n      </div>\n      <div class=\"sheet\"><div class=\"back-side\"></div></div>\n    `).join('');\n\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Print Zine</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ${dimensions.width}mm ${dimensions.height}mm; margin: 0; }\n          body { background: white; width: ${dimensions.width}mm; height: ${dimensions.height}mm; overflow: hidden; }\n          .sheet { width: 100%; height: 100%; page-break-after: always; display: block; overflow: hidden; position: relative; }\n          .zine-grid {\n            display: grid;\n            ${gridCss}\n            height: ${dimensions.height}mm;\n            width: ${dimensions.width}mm;\n            /* Ensure grid fills the page */\n            justify-content: stretch;\n            align-content: stretch;\n          }\n          .page-cell {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            overflow: hidden;\n            border: none;\n          }\n          /* Generic page areas fallback if needed */\n          \n          .page-content-img { \n            width: 100%; \n            height: 100%; \n            object-fit: contain; \n            /* Rely on DOM transform for rotation */\n          }\n          .page-label, .page-placeholder { display: none; }\n          \n          .back-side {\n            width: 100%; height: 100%;\n            background-image: url('${this.referenceImageUrl}');\n            background-size: contain;\n            background-position: center;\n            background-repeat: no-repeat;\n            transform: rotate(180deg);\n          }\n          \n          /* CRITICAL: Hide controls in print */\n          @media print {\n            .flip-btn, .page-label, .guidelines, .page-placeholder, .page-cell::before, .page-cell::after { \n                display: none !important; \n            }\n            .page-cell { border: none !important; }\n          }\n          \n          ${cutLinesCss}\n        </style>\n      </head>\n      <body>\n        ${sheetsHtml}\n      </body>\n      </html>\n    `;\n\n    printWindow.document.write(html);\n    printWindow.document.close();\n    printWindow.setTimeout(() => {\n      printWindow.print();\n      printWindow.close();\n    }, 500);\n  }\n\n\n  async handleExport() {\n    if (!this.ui.hasContent()) { return; }\n    try {\n      this.ui.elements.exportPdfBtn.disabled = true;\n      document.body.classList.add('is-exporting'); // Hide UI controls\n      toast.info('Generating PDF...');\n\n      const doc = new jsPDF({\n        orientation: this.orientation || 'landscape',\n        unit: 'mm',\n        format: this.paperSize || 'a4'\n      });\n\n      const dimensions = this.ui.getPaperDimensions(this.paperSize || 'a4', this.orientation || 'landscape');\n\n      const captureZine = async (sheetNum) => {\n        const grid = document.querySelector(`#zine-grid-sheet-${sheetNum}`);\n        if (!grid) { return; }\n\n        await new Promise(r => setTimeout(r, 100)); // Allow DOM to update\n\n        const canvas = await html2canvas(grid, {\n          scale: 3,\n          useCORS: true,\n          backgroundColor: '#ffffff',\n          logging: false\n        });\n\n        if (sheetNum > 1) { doc.addPage(); }\n        doc.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, 0, dimensions.width, dimensions.height);\n\n        // Add back side\n        doc.addPage();\n        const backCanvas = document.createElement('canvas');\n        backCanvas.width = canvas.width;\n        backCanvas.height = canvas.height;\n        const bctx = backCanvas.getContext('2d');\n        const refImg = new Image();\n        refImg.src = this.referenceImageUrl;\n        await new Promise(r => { refImg.onload = r; });\n\n        bctx.translate(backCanvas.width / 2, backCanvas.height / 2);\n        bctx.rotate(Math.PI);\n        bctx.drawImage(refImg, -backCanvas.width / 2, -backCanvas.height / 2, backCanvas.width, backCanvas.height);\n        doc.addImage(backCanvas.toDataURL('image/jpeg', 0.9), 'JPEG', 0, 0, dimensions.width, dimensions.height);\n      };\n\n      await captureZine(1);\n      // Only capture second sheet for dual-16 template (not accordion-16 which is single sheet)\n      if (this.currentTemplate !== 'accordion-16' && this.selectedLayout > 8) {\n        await captureZine(2);\n      }\n\n      doc.save(`zine-${Date.now()}.pdf`);\n      toast.success('Downloaded!', 'Your PDF is ready.');\n    } catch (e) {\n      console.error(e);\n      toast.error('Export Failed', 'Something went wrong.');\n    } finally {\n      this.ui.elements.exportPdfBtn.disabled = false;\n      document.body.classList.remove('is-exporting'); // Restore UI controls\n    }\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  new PDFZineMaker();\n});"],"names":["formatFileSize","bytes","value","isNaN","isFinite","units","size","unitIndex","length","toFixed","pdfWorker","URL","module","meta","url","href","PDFProcessor","constructor","this","pdf","isProcessing","initialize","pdfjsLib.GlobalWorkerOptions","workerSrc","validateFile","file","errors","push","valid","type","maxSize","loadPDF","onProgress","Error","validation","join","arrayBuffer","readFileAsArrayBuffer","loadingPromise","pdfjsLib.getDocument","data","verbosity","promise","timeoutPromise","Promise","_","reject","setTimeout","race","numPages","fileName","name","fileSize","error","console","handlePDFError","resolve","reader","FileReader","onload","result","onerror","onabort","readAsArrayBuffer","renderPage","pageNum","page","getPage","scale","viewport","getViewport","canvas","document","createElement","context","getContext","alpha","width","Math","floor","height","fillStyle","fillRect","renderContext","canvasContext","background","render","log","canvasToBlob","toBlob","blob","createObjectURL","revokeBlobUrl","startsWith","revokeObjectURL","canvasToDataURL","format","quality","dataUrl","toDataURL","warn","message","includes","cleanup","destroy","PAPER_SIZES","a4","label","a3","letter","legal","a5","ZINE_TEMPLATES","pages","grid","rows","cols","layout","upsideDown","gridAreas","upsideDownPages","cutLines","horizontal","afterRow","leftEdge","rightEdge","description","sheets","toast","container","init","getElementById","id","className","setAttribute","body","appendChild","show","title","duration","content","getIcon","innerHTML","querySelector","addEventListener","remove","parentNode","requestAnimationFrame","classList","add","rotation","random","style","transform","removeChild","icons","success","warning","info","UIManager","n","emitter","all","Map","on","t","e","i","get","set","off","splice","indexOf","emit","slice","map","elements","paperSize","orientation","cacheElements","renderPaperSizeOptions","loadSettings","updatePreviewLayout","setupEventListeners","previewArea","$","selector","uploadZone","actionButtons","previewDescription","zineSheetsContainer","printBtn","exportPdfBtn","pdfUpload","uploadStatus","progressContainer","progressFill","progressText","progressSubtext","paperSizeSelect","orientationSelect","pageNumbersCheckbox","toastContainer","zineTabs","zineTab1","zineTab2","gridRows","gridCols","gridTotal","unusedSection","unusedGrid","Object","entries","updatePaperSize","target","updateOrientation","togglePageNumbers","checked","triggerFileUpload","handleDragOver","handleDragLeave","handleFileDrop","files","handleGridChange","parseInt","textContent","handleKeyboard","setReady","ready","updateProgress","percent","setStatus","generateLayout","templateType","currentTemplate","template","generateAccordionLayout","generateMiniZineLayout","generateCustomGrid","totalPDFPages","totalSlots","actualPages","max","sheetWrapper","display","gridTemplateColumns","gridTemplateRows","gridTemplateAreas","cell","labelText","setupDragAndDrop","setupFlipButton","generateUnusedBucket","startIndex","totalPages","draggable","img","placeholder","forEach","item","insertAdjacentHTML","_template","numSheets","s","pageIdx","sheetLabel","guidelines","dataTransfer","setData","getAttribute","querySelectorAll","c","preventDefault","fromIndex","getData","toIndex","updatePagePreview","pageIndex","Array","from","unusedPlaceholder","src","children","flipBtn","stopPropagation","setPageFlip","isFlipped","trim","replace","setActiveTab","click","contains","relatedTarget","key","metaKey","ctrlKey","showProgress","text","subtext","savedPaperSize","localStorage","getItem","savedOrientation","setItem","dims","getPaperDimensions","ratio","sheet","aspectRatio","maxHeight","maxWidth","margin","getPaperSizeLabel","hasContent","event","handler","referenceImageUrl","PDFZineMaker","pdfProcessor","ui","allPageImages","fill","pageFlips","gridSize","handleFileSelected","handlePrint","handleExport","updatePaperSettings","handlePagesSwapped","handlePageFlipped","handleGridSizeChanged","min","selectedFile","processPDF","progress","selectedLayout","maxPages","sqrt","ceil","round","createBlankPage","ctx","font","textAlign","fillText","temp","tempFlip","updateZineView","zineNum","startPageIndex","globalPageIndex","imageUrl","settings","createPrintLayout","printWindow","window","open","zineSheets","dimensions","gridCss","sheetsHtml","html","write","close","print","disabled","doc","jsPDF","unit","captureZine","async","sheetNum","r","html2canvas","useCORS","backgroundColor","logging","addPage","addImage","backCanvas","bctx","refImg","Image","translate","rotate","PI","drawImage","save","Date","now"],"mappings":"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","x_google_ignoreList":[1,6]}