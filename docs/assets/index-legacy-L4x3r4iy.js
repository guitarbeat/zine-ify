System.register(["./pdfjs-legacy-B7EZslUV.js","./jspdf-legacy-DoPFqSOu.js","./html2canvas-legacy-DIGTxsNk.js"],function(e,t){"use strict";var a,i,r,n;return{setters:[e=>{a=e.G,i=e.g},e=>{r=e.E},e=>{n=e.default}],execute:function(){var e=document.createElement("style");function s(e){if("number"!=typeof(t=e)||isNaN(t)||!isFinite(t))return"0 B";var t;const a=["B","KB","MB","GB"];let i=e,r=0;for(;i>=1024&&r<a.length-1;)i/=1024,r++;return`${i.toFixed(1)} ${a[r]}`}e.textContent='@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-border-style:solid;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0}}}.pointer-events-none{pointer-events:none}.\\!visible{visibility:visible!important}.collapse{visibility:collapse}.invisible{visibility:hidden}.visible{visibility:visible}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.top-1\\/2{top:50%}.top-1\\/4{top:25%}.top-3\\/4{top:75%}.left-1\\/2{left:50%}.left-1\\/4{left:25%}.left-3\\/4{left:75%}.z-10{z-index:10}.z-20{z-index:20}.z-\\[100\\]{z-index:100}.z-\\[300\\]{z-index:300}.container{width:100%}.mx-auto{margin-inline:auto}.block{display:block}.contents{display:contents}.flex{display:flex}.flow-root{display:flow-root}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.inline-grid{display:inline-grid}.inline-table{display:inline-table}.list-item{display:list-item}.table{display:table}.table-caption{display:table-caption}.table-cell{display:table-cell}.table-column{display:table-column}.table-column-group{display:table-column-group}.table-footer-group{display:table-footer-group}.table-header-group{display:table-header-group}.table-row{display:table-row}.table-row-group{display:table-row-group}.aspect-\\[1\\/1\\.414\\]{aspect-ratio:1/1.414}.h-full{height:100%}.min-h-\\[100px\\]{min-height:100px}.min-h-\\[140px\\]{min-height:140px}.min-h-\\[400px\\]{min-height:400px}.min-h-screen{min-height:100vh}.w-full{width:100%}.flex-shrink{flex-shrink:1}.-rotate-1{rotate:-1deg}.-rotate-2{rotate:-2deg}.rotate-1{rotate:1deg}.transform{transform:var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-rotate-z,)var(--tw-skew-x,)var(--tw-skew-y,)}.transform\\!{transform:var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-rotate-z,)var(--tw-skew-x,)var(--tw-skew-y,)!important}.cursor-grab{cursor:grab}.cursor-pointer{cursor:pointer}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.items-start{align-items:flex-start}.justify-center{justify-content:center}.truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.overflow-hidden{overflow:hidden}.rounded-none{border-radius:0}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-4{border-style:var(--tw-border-style);border-width:4px}.border-t{border-top-style:var(--tw-border-style);border-top-width:1px}.border-t-2{border-top-style:var(--tw-border-style);border-top-width:2px}.border-t-4{border-top-style:var(--tw-border-style);border-top-width:4px}.border-b-2{border-bottom-style:var(--tw-border-style);border-bottom-width:2px}.border-b-4{border-bottom-style:var(--tw-border-style);border-bottom-width:4px}.border-l{border-left-style:var(--tw-border-style);border-left-width:1px}.border-dashed{--tw-border-style:dashed;border-style:dashed}.border-\\[\\#ffff00\\]{border-color:#ff0}.bg-\\[\\#ffff00\\]{background-color:#ff0}.object-contain{-o-object-fit:contain;object-fit:contain}.text-center{text-align:center}.text-\\[8px\\]{font-size:8px}.text-\\[10px\\]{font-size:10px}.text-\\[11px\\]{font-size:11px}.break-all{word-break:break-all}.capitalize{text-transform:capitalize}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.italic{font-style:italic}.line-through{text-decoration-line:line-through}.overline{text-decoration-line:overline}.underline{text-decoration-line:underline}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.opacity-30{opacity:.3}.opacity-50{opacity:.5}.shadow-\\[2px_2px_0_black\\]{--tw-shadow:2px 2px 0 var(--tw-shadow-color,black);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\\[4px_4px_0_black\\]{--tw-shadow:4px 4px 0 var(--tw-shadow-color,black);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\\[8px_8px_0_black\\]{--tw-shadow:8px 8px 0 var(--tw-shadow-color,black);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring{--tw-ring-shadow:var(--tw-ring-inset,)0 0 0 calc(1px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.drop-shadow-\\[4px_4px_0_rgba\\(255\\,0\\,255\\,1\\)\\]{--tw-drop-shadow-size:drop-shadow(4px 4px 0 var(--tw-drop-shadow-color,#f0f));--tw-drop-shadow:var(--tw-drop-shadow-size);filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.invert{--tw-invert:invert(100%);filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.filter\\!{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)!important}.backdrop-grayscale{--tw-backdrop-grayscale:grayscale(100%);backdrop-filter:var(--tw-backdrop-blur,)var(--tw-backdrop-brightness,)var(--tw-backdrop-contrast,)var(--tw-backdrop-grayscale,)var(--tw-backdrop-hue-rotate,)var(--tw-backdrop-invert,)var(--tw-backdrop-opacity,)var(--tw-backdrop-saturate,)var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,ease);transition-duration:var(--tw-duration,0s)}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,ease);transition-duration:var(--tw-duration,0s)}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,ease);transition-duration:var(--tw-duration,0s)}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,ease);transition-duration:var(--tw-duration,0s)}.duration-200{--tw-duration:.2s;transition-duration:.2s}.duration-500{--tw-duration:.5s;transition-duration:.5s}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}@media(hover:hover){.hover\\:translate-x-\\[1px\\]:hover{--tw-translate-x:1px;translate:var(--tw-translate-x)var(--tw-translate-y)}.hover\\:translate-y-\\[1px\\]:hover{--tw-translate-y:1px;translate:var(--tw-translate-x)var(--tw-translate-y)}.hover\\:bg-\\[\\#ff00ff\\]:hover{background-color:#f0f}.hover\\:shadow-none:hover{--tw-shadow:0 0 #0000;box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\\:ring-0:focus{--tw-ring-shadow:var(--tw-ring-inset,)0 0 0 calc(0px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.focus\\:ring-offset-0:focus{--tw-ring-offset-width:0px;--tw-ring-offset-shadow:var(--tw-ring-inset,)0 0 0 var(--tw-ring-offset-width)var(--tw-ring-offset-color)}.active\\:cursor-grabbing:active{cursor:grabbing}:root{--bg-neutral:#f0f0f0;--accent-dark:#000;--primary-vibrant:#f0f;--border-color:#000;--paper-bg:#fff}body{background-color:var(--bg-neutral);color:var(--accent-dark);background-image:url("data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\' opacity=\'0.05\'/%3E%3C/svg%3E");font-family:Courier Prime,monospace}.font-marker{font-family:Permanent Marker,cursive}.font-typewriter{font-family:Courier Prime,monospace}.upload-box{border:3px dashed var(--border-color);background-color:#fff;transition:all .1s;box-shadow:4px 4px #000}.upload-box:active,.upload-box.dragover{background-color:#ff0;transform:translate(2px,2px);box-shadow:2px 2px #000}select,input{box-shadow:2px 2px #000;border:2px solid #000!important;border-radius:0!important}select:focus,input:focus{box-shadow:4px 4px 0 0 var(--primary-vibrant);outline:none;transform:translate(-1px,-1px)}.print-sheet{background-color:var(--paper-bg);border:2px solid #000;flex-shrink:0;transition:all .2s;position:relative;box-shadow:4px 4px #000}@media print{.print-sheet{box-shadow:none;page-break-after:always;border:none;margin:0;width:100%!important;max-width:none!important;height:100%!important;max-height:none!important}.flip-btn,.page-label,.guidelines{display:none!important}.page-cell{border:none!important}}.zine-grid{width:100%;height:100%;display:grid}.page-cell{cursor:grab;background:#fff;border:1px solid #000;justify-content:center;align-items:center;display:flex;position:relative;overflow:hidden}.page-cell.dragging{opacity:.8;cursor:grabbing;filter:invert();z-index:50}.page-cell.drag-over{background-color:var(--primary-vibrant);z-index:40}.page-content-img{-o-object-fit:contain;object-fit:contain;mix-blend-mode:multiply;width:100%;height:100%}.page-label{color:#fff;z-index:20;background:#000;border-bottom:1px solid #000;border-right:1px solid #000;padding:2px 4px;font-family:Courier Prime,monospace;font-size:10px;font-weight:700;position:absolute;top:0;left:0}.page-cell[data-page="2"],.page-cell[data-page="3"],.page-cell[data-page="4"],.page-cell[data-page="5"],.zine-grid.accordion-16 .page-cell[data-page="1"],.zine-grid.accordion-16 .page-cell[data-page="2"],.zine-grid.accordion-16 .page-cell[data-page="3"],.zine-grid.accordion-16 .page-cell[data-page="4"],.zine-grid.accordion-16 .page-cell[data-page="9"],.zine-grid.accordion-16 .page-cell[data-page="10"],.zine-grid.accordion-16 .page-cell[data-page="11"],.zine-grid.accordion-16 .page-cell[data-page="12"]{transform:rotate(180deg)}.zine-grid.accordion-16 .page-cell[data-page="5"],.zine-grid.accordion-16 .page-cell[data-page="6"],.zine-grid.accordion-16 .page-cell[data-page="7"],.zine-grid.accordion-16 .page-cell[data-page="8"],.zine-grid.accordion-16 .page-cell[data-page="13"],.zine-grid.accordion-16 .page-cell[data-page="14"],.zine-grid.accordion-16 .page-cell[data-page="15"],.zine-grid.accordion-16 .page-cell[data-page="16"]{transform:rotate(0)}.action-button{text-transform:uppercase;font-weight:900;transition:all .1s cubic-bezier(.4,0,.2,1);box-shadow:4px 4px #000;border:3px solid #000!important;border-radius:0!important}.action-button:hover{box-shadow:6px 6px 0 0 var(--primary-vibrant);transform:translate(-2px,-2px)}.action-button:active{transform:translate(2px,2px);box-shadow:2px 2px #000}.page-label.centered{z-index:100;color:#000;background-color:#fff;border:3px solid #000;padding:8px 12px;font-size:24px;top:50%;left:50%;transform:translate(-50%,-50%)rotate(-5deg);box-shadow:4px 4px #000}.view-section{transition:opacity .3s,transform .3s}.view-section.hidden{opacity:0;display:none;transform:translateY(10px)}.progress-bar-container{background:#fff;border:2px solid #000;width:100%;height:12px;overflow:hidden}#progress-fill{background:var(--primary-vibrant);background-image:linear-gradient(45deg,rgba(0,0,0,.15) 25%,rgba(0,0,0,0) 25%,rgba(0,0,0,0) 50%,rgba(0,0,0,.15) 50%,rgba(0,0,0,.15) 75%,rgba(0,0,0,0) 75%,rgba(0,0,0,0));background-size:20px 20px;width:0%;height:100%}.settings-panel{border:3px solid #000;border-radius:0;box-shadow:4px 4px #000}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}\n/*$vite$:1*/',document.head.appendChild(e);const o=""+new URL("pdf.worker.min-LyOxJPrg.mjs",t.meta.url).href;class l{constructor(){this.pdf=null,this.isProcessing=!1}async initialize(){a.workerSrc=o}validateFile(e){const t=[];if(!e)return t.push("No file selected"),{valid:!1,errors:t};"application/pdf"!==e.type&&t.push("Please select a PDF file");const a=262144e3;return e.size>a&&t.push(`File too large (${s(e.size)}). Maximum size is ${s(a)}`),0===e.size&&t.push("File appears to be empty"),{valid:0===t.length,errors:t}}async loadPDF(e,t=null){if(this.isProcessing)throw new Error("PDF processing already in progress");this.isProcessing=!0;try{const a=this.validateFile(e);if(!a.valid)throw new Error(a.errors.join(". "));t?.("Reading PDF file...");const r=await this.readFileAsArrayBuffer(e);t?.("Processing PDF...");const n=i({data:r,verbosity:0}).promise,s=new Promise((e,t)=>setTimeout(()=>t(new Error("PDF loading timed out")),6e4));this.pdf=await Promise.race([n,s]);const o=this.pdf.numPages;if(0===o)throw new Error("PDF appears to be empty or corrupted");return{pdf:this.pdf,numPages:o,fileName:e.name,fileSize:e.size}}catch(a){throw console.error("PDF loading error:",a),this.handlePDFError(a)}finally{this.isProcessing=!1}}readFileAsArrayBuffer(e){return new Promise((t,a)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>a(new Error("Failed to read file")),i.onabort=()=>a(new Error("File reading was cancelled")),i.readAsArrayBuffer(e)})}async renderPage(e,t=null){if(!this.pdf)throw new Error("No PDF loaded");try{t?.(`Rendering page ${e}...`);const a=await this.pdf.getPage(e),i=1.5,r=a.getViewport({scale:i}),n=document.createElement("canvas"),s=n.getContext("2d",{alpha:!1});n.width=Math.floor(r.width),n.height=Math.floor(r.height),s.fillStyle="#ffffff",s.fillRect(0,0,n.width,n.height);const o={canvasContext:s,viewport:r,background:"white"};return await a.render(o).promise,console.log(`Rendered page ${e}, canvas size: ${n.width}x${n.height}`),n}catch(a){throw console.error(`Failed to render page ${e}:`,a),new Error(`Failed to render page ${e}`)}}async canvasToBlob(e){return new Promise(t=>{e.toBlob(e=>{const a=URL.createObjectURL(e);t(a)},"image/jpeg",.9)})}revokeBlobUrl(e){e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}canvasToDataURL(e,t="image/jpeg",a=.85){try{const i=e.toDataURL(t,a);return console.log(`Generated data URL, format: ${t}, size: ${i.length} chars`),i}catch(i){return console.warn(`Failed to generate ${t}, falling back to PNG:`,i),e.toDataURL("image/png",1)}}handlePDFError(e){const t=e.message||"Unknown error";return t.includes("timed out")?new Error("PDF loading timed out. The file may be corrupted or too large."):t.includes("corrupted")||t.includes("InvalidPDFException")?new Error("The PDF file appears to be corrupted or invalid."):t.includes("password")||t.includes("protected")?new Error("The PDF file is password-protected."):t.includes("not loaded")||t.includes("MissingPDFException")?new Error("PDF.js library failed to load. Please refresh the page."):new Error(`PDF processing failed: ${t}`)}cleanup(){this.pdf&&(this.pdf.destroy(),this.pdf=null),this.isProcessing=!1}}const d={a4:{label:"A4 (210 × 297 mm)",width:210,height:297},a3:{label:"A3 (297 × 420 mm)",width:297,height:420},letter:{label:"Letter (8.5 × 11 in)",width:215.9,height:279.4},legal:{label:"Legal (8.5 × 14 in)",width:215.9,height:355.6},a5:{label:"A5 (148 × 210 mm)",width:148,height:210}},p={"mini-8":{label:"8-Page Mini-Zine",pages:8,grid:{rows:2,cols:4},layout:[{page:5,upsideDown:!1},{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:1,upsideDown:!1}],gridAreas:'\n            "page5 page4 page3 page2"\n            "page6 page7 page8 page1"\n        ',upsideDownPages:[2,3,4,5],cutLines:{horizontal:{afterRow:1}}},"accordion-16":{label:"16-Page Accordion",pages:16,grid:{rows:4,cols:4},layout:[{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:1,upsideDown:!0},{page:5,upsideDown:!1},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:12,upsideDown:!0},{page:11,upsideDown:!0},{page:10,upsideDown:!0},{page:9,upsideDown:!0},{page:13,upsideDown:!1},{page:14,upsideDown:!1},{page:15,upsideDown:!1},{page:16,upsideDown:!1}],gridAreas:'\n            "page4 page3 page2 page1"\n            "page5 page6 page7 page8"\n            "page12 page11 page10 page9"\n            "page13 page14 page15 page16"\n        ',upsideDownPages:[1,2,3,4,9,10,11,12],cutLines:{leftEdge:{rows:[0,1,2]},rightEdge:{rows:[0,1,2]}},description:"1 sheet, 4×4 grid. Cut along edges then fold accordion-style."},"dual-16":{label:"16-Page Dual Sheets",pages:16,sheets:2,grid:{rows:2,cols:4},description:"2 sheets, each folded like an 8-page zine."}},c=new class{constructor(){this.container=null,this.init()}init(){this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",this.container.setAttribute("aria-live","polite"),document.body.appendChild(this.container))}show(e,t,a="",i=5e3){const r=document.createElement("div");r.className=`toast toast-${e}`,r.setAttribute("role","alert");const n=`\n      <div class="toast-icon">${this.getIcon(e)}</div>\n      <div class="toast-content">\n        <div class="toast-title">${t}</div>\n        ${a?`<div class="toast-message">${a}</div>`:""}\n      </div>\n      <button class="toast-close" aria-label="Close notification">&times;</button>\n    `;return r.innerHTML=n,this.container.appendChild(r),r.querySelector(".toast-close").addEventListener("click",()=>this.remove(r)),i>0&&setTimeout(()=>{r.parentNode&&this.remove(r)},i),requestAnimationFrame(()=>{r.classList.add("toast-visible")}),r}remove(e){e.classList.remove("toast-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getIcon(e){const t={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>\n        <polyline points="22,4 12,14.01 9,11.01"/>\n      </svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <line x1="15" y1="9" x2="9" y2="15"/>\n        <line x1="9" y1="9" x2="15" y2="15"/>\n      </svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>\n        <line x1="12" y1="9" x2="12" y2="13"/>\n        <line x1="12" y1="17" x2="12.01" y2="17"/>\n      </svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <path d="M12 16v-4"/>\n        <path d="M12 8h.01"/>\n      </svg>'};return t[e]||t.info}success(e,t,a){return this.show("success",e,t,a)}error(e,t,a){return this.show("error",e,t,a)}warning(e,t,a){return this.show("warning",e,t,a)}info(e,t,a){return this.show("info",e,t,a)}};class h{constructor(){var e;this.emitter={all:e=e||new Map,on:function(t,a){var i=e.get(t);i?i.push(a):e.set(t,[a])},off:function(t,a){var i=e.get(t);i&&(a?i.splice(i.indexOf(a)>>>0,1):e.set(t,[]))},emit:function(t,a){var i=e.get(t);i&&i.slice().map(function(e){e(a)}),(i=e.get("*"))&&i.slice().map(function(e){e(t,a)})}},this.elements={},this.paperSize="a4",this.orientation="landscape",this.init()}init(){this.cacheElements(),this.renderPaperSizeOptions(),this.loadSettings(),this.updatePreviewLayout(),this.setupEventListeners(),this.elements.previewArea&&this.elements.previewArea.classList.remove("opacity-50","pointer-events-none")}cacheElements(){const e=e=>document.querySelector(e);this.elements={uploadZone:e("#upload-zone"),previewArea:e("#preview-area"),actionButtons:e("#action-buttons"),previewDescription:e("#preview-description"),zineSheetsContainer:e("#zine-sheets-container"),printBtn:e("#printBtn"),exportPdfBtn:e("#exportPdfBtn"),pdfUpload:e("#pdf-upload"),uploadStatus:e("#upload-status"),progressContainer:e("#progress-container"),progressFill:e("#progress-fill"),progressText:e("#progress-text"),progressSubtext:e("#progress-subtext"),paperSizeSelect:e("#paper-size-select"),orientationSelect:e("#orientation-select"),pageNumbersCheckbox:e("#show-page-numbers"),toastContainer:e("#toast-container"),zineTabs:e("#zine-tabs"),zineTab1:e("#zine-tab-1"),zineTab2:e("#zine-tab-2"),gridRows:e("#grid-rows"),gridCols:e("#grid-cols"),gridTotal:e("#grid-total"),unusedSection:e("#unused-pages-section"),unusedGrid:e("#unused-grid")}}renderPaperSizeOptions(){this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.innerHTML=Object.entries(d).map(([e,t])=>`<option value="${e}">${t.label}</option>`).join(""))}setupEventListeners(){this.elements.paperSizeSelect?.addEventListener("change",e=>this.updatePaperSize(e.target.value)),this.elements.orientationSelect?.addEventListener("change",e=>this.updateOrientation(e.target.value)),this.elements.pageNumbersCheckbox?.addEventListener("change",e=>this.togglePageNumbers(e.target.checked)),this.elements.uploadZone?.addEventListener("click",()=>this.triggerFileUpload()),this.elements.uploadZone?.addEventListener("dragover",e=>this.handleDragOver(e)),this.elements.uploadZone?.addEventListener("dragleave",e=>this.handleDragLeave(e)),this.elements.uploadZone?.addEventListener("drop",e=>this.handleFileDrop(e)),this.elements.pdfUpload?.addEventListener("change",e=>{const t=e.target.files[0];t&&this.emitter.emit("fileSelected",t)});const e=()=>{const e=parseInt(this.elements.gridRows?.value)||2,t=parseInt(this.elements.gridCols?.value)||4;this.elements.gridTotal&&(this.elements.gridTotal.textContent=`(${e*t} pages)`),this.emitter.emit("gridSizeChanged",{rows:e,cols:t})};this.elements.gridRows?.addEventListener("input",e),this.elements.gridCols?.addEventListener("input",e),document.addEventListener("keydown",e=>this.handleKeyboard(e))}setReady(e,t=null){e?(this.elements.previewArea?.classList.remove("opacity-30","pointer-events-none"),this.elements.actionButtons?.classList.remove("hidden")):(this.elements.previewArea?.classList.add("opacity-30","pointer-events-none"),this.elements.actionButtons?.classList.add("hidden")),t&&this.elements.previewDescription&&(this.elements.previewDescription.textContent=t)}updateProgress(e){this.elements.progressFill&&(this.elements.progressFill.style.width=`${e}%`)}setStatus(e,t="info"){this.elements.uploadStatus&&(this.elements.uploadStatus.textContent=e,this.elements.uploadStatus.className="text-[11px] uppercase font-bold tracking-wider "+("error"===t?"text-red-500":"success"===t?"text-green-500":"text-gray-400"))}generateLayout(e=8,t=null){if(!this.elements.zineSheetsContainer)return;this.elements.zineSheetsContainer.innerHTML="",t||(t=e>8?"accordion-16":"mini-8"),this.currentTemplate=t;const a=p[t];a?("accordion-16"===t?this.generateAccordionLayout(a):this.generateMiniZineLayout(e,a),this.updatePreviewLayout(),this.elements.previewArea&&this.elements.previewArea.classList.remove("opacity-50","pointer-events-none")):console.error(`Unknown template: ${t}`)}generateCustomGrid(e,t,a=0){this.elements.zineSheetsContainer.innerHTML="";const i=e*t,r=Math.max(i,a),n=document.createElement("div");n.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",n.setAttribute("data-sheet",1),n.setAttribute("data-template",`custom-${e}x${t}`);const s=document.createElement("div");s.className="zine-grid",s.id="zine-grid-sheet-1",s.style.display="grid",s.style.gridTemplateColumns=`repeat(${t}, 1fr)`,s.style.gridTemplateRows=`repeat(${e}, 1fr)`,s.style.gridTemplateAreas="none";for(let o=0;o<i;o++){const e=o+1,t=document.createElement("div");t.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden transition-all duration-200",t.setAttribute("data-page-index",o),t.setAttribute("data-page",e),t.setAttribute("draggable","true");const a=1===e?"Cover":e===i?"Back":`Page ${e}`;t.innerHTML=`\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${a}</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ${e}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      `,this.setupDragAndDrop(t),this.setupFlipButton(t),s.appendChild(t)}n.appendChild(s),this.elements.zineSheetsContainer.appendChild(n),this.generateUnusedBucket(i,r),this.updatePreviewLayout()}generateUnusedBucket(e,t){const{unusedSection:a,unusedGrid:i}=this.elements;if(a&&i)if(i.innerHTML="",e>=t)a.classList.add("hidden");else{a.classList.remove("hidden");for(let a=e;a<t;a++){const e=document.createElement("div");e.className="page-cell bg-white aspect-[1/1.414] relative rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing hover:border-blue-500 transition-colors duration-200",e.setAttribute("data-page-index",a),e.draggable=!0;const t=document.createElement("img");t.className="page-content-img w-full h-full object-contain hidden pointer-events-none",t.draggable=!1;const r=document.createElement("div");r.className="absolute top-1 left-1 bg-gray-500 text-white text-[8px] px-1.5 py-0.5 rounded-sm font-bold z-10",r.textContent=`#${a+1}`;const n=document.createElement("div");n.className="text-[10px] uppercase font-bold text-gray-300 select-none",n.textContent="Unused",e.appendChild(r),e.appendChild(n),e.appendChild(t),this.setupDragAndDrop(e),i.appendChild(e)}}}generateAccordionLayout(e){const t=document.createElement("div");t.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",t.setAttribute("data-sheet",1),t.setAttribute("data-template","accordion-16");const a=document.createElement("div");a.className="zine-grid accordion-16",a.id="zine-grid-sheet-1",e.layout.forEach(e=>{const t=document.createElement("div");t.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",t.setAttribute("data-page-index",e.page-1),t.setAttribute("data-page",e.page),t.setAttribute("draggable","true");const i=1===e.page?"Cover":16===e.page?"Back":`Page ${e.page}`;t.innerHTML=`\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${i}</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ${e.page}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      `,this.setupDragAndDrop(t),this.setupFlipButton(t),a.appendChild(t)}),t.appendChild(a),t.insertAdjacentHTML("beforeend",'\n      <div class="absolute top-1/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-3/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n    '),this.elements.zineSheetsContainer.appendChild(t)}generateMiniZineLayout(e,t){const a=e>8?2:1;for(let i=1;i<=a;i++){const e=document.createElement("div");e.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",e.setAttribute("data-sheet",i);const t=document.createElement("div");t.className="zine-grid",t.id=`zine-grid-sheet-${i}`;for(let n=1;n<=8;n++){const e=8*(i-1)+n,r=document.createElement("div");r.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",r.setAttribute("data-page-index",e-1),r.setAttribute("data-page",n),r.setAttribute("draggable","true");const s=1===n?"Cover":8===n?"Back":`Page ${n}`,o=a>1?` <span class="opacity-50 text-[8px] ml-1">(Sheet ${i})</span>`:"";r.innerHTML=`\n          <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${s}${o}</span>\n          <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n              <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n          </button>\n          <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n          <img alt="Page ${e}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n        `,this.setupDragAndDrop(r),this.setupFlipButton(r),t.appendChild(r)}const r='\n        <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n      ';e.appendChild(t),e.insertAdjacentHTML("beforeend",r),this.elements.zineSheetsContainer.appendChild(e)}}setupDragAndDrop(e){e.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",e.getAttribute("data-page-index")),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),document.querySelectorAll(".page-cell").forEach(e=>e.classList.remove("drag-over"))}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("drag-over");const a=parseInt(t.dataTransfer.getData("text/plain")),i=parseInt(e.getAttribute("data-page-index"));a!==i&&this.emitter.emit("pagesSwapped",{fromIndex:a,toIndex:i})})}updatePagePreview(e,t){[...Array.from(this.elements.zineSheetsContainer.querySelectorAll(`.page-cell[data-page-index="${e}"]`)),...this.elements.unusedGrid?Array.from(this.elements.unusedGrid.querySelectorAll(`.page-cell[data-page-index="${e}"]`)):[]].forEach(e=>{const a=e.querySelector(".page-content-img"),i=e.querySelector(".page-placeholder"),r=e.querySelector(".text-gray-300");t?(a&&(a.src=t,a.classList.remove("hidden")),i&&i.classList.add("hidden"),r&&"Unused"===r.textContent&&r.classList.add("hidden")):(a&&(a.src="",a.classList.add("hidden")),i&&i.classList.remove("hidden"),r&&"Unused"===r.textContent&&r.classList.remove("hidden"))}),this.elements.unusedGrid&&this.elements.unusedGrid.children.length>0&&this.elements.unusedSection.classList.remove("hidden")}setupFlipButton(e){const t=e.querySelector(".flip-btn");t&&t.addEventListener("click",t=>{t.stopPropagation();const a=parseInt(e.getAttribute("data-page-index"));this.emitter.emit("pageFlipped",a)})}setPageFlip(e,t){const a=this.elements.zineSheetsContainer.querySelector(`[data-page-index="${e}"]`);if(a){const e=a.querySelector(".page-content-img");e&&(t?(e.style.transform=`${e.style.transform||""} rotate(180deg)`.trim(),e.classList.add("flipped")):(e.style.transform=e.style.transform.replace("rotate(180deg)","").trim(),e.classList.remove("flipped")))}}setActiveTab(){}triggerFileUpload(){this.elements.pdfUpload?.click()}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.add("dragover")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&!this.elements.uploadZone.contains(e.relatedTarget)&&this.elements.uploadZone.classList.remove("dragover")}handleFileDrop(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&"application/pdf"===t[0].type?this.emitter.emit("fileSelected",t[0]):c.error("Invalid File","Please drop a valid PDF file")}handleKeyboard(e){"p"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),this.emitter.emit("print"))}showProgress(e,t="Processing PDF...",a=""){e?this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressContainer.classList.add("flex")):this.elements.progressContainer&&(this.elements.progressContainer.classList.add("hidden"),this.elements.progressContainer.classList.remove("flex")),this.elements.progressText&&(this.elements.progressText.textContent=t),this.elements.progressSubtext&&(this.elements.progressSubtext.textContent=a)}loadSettings(){const e=localStorage.getItem("paperSize"),t=localStorage.getItem("orientation");e&&(this.paperSize=e,this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.value=e)),t&&(this.orientation=t,this.elements.orientationSelect&&(this.elements.orientationSelect.value=t))}updatePaperSize(e){this.paperSize=e,localStorage.setItem("paperSize",e),this.updatePreviewLayout(),this.emitter.emit("paperSizeChanged",{paperSize:e,orientation:this.orientation})}updateOrientation(e){this.orientation=e,localStorage.setItem("orientation",e),this.updatePreviewLayout(),this.emitter.emit("orientationChanged",{paperSize:this.paperSize,orientation:e})}togglePageNumbers(e){document.querySelectorAll(".page-label").forEach(t=>{e?(t.classList.remove("hidden"),t.classList.add("centered")):(t.classList.add("hidden"),t.classList.remove("centered"))})}updatePreviewLayout(){const e=document.querySelectorAll(".print-sheet");if(!e.length)return;const t=this.getPaperDimensions(this.paperSize,this.orientation),a=t.width/t.height;e.forEach(e=>{e.style.aspectRatio=`${a}`,e.style.maxHeight="75vh",e.style.maxWidth="100%",e.style.margin="0 auto"})}getPaperDimensions(e,t){const a=d[e]||d.a4;return"landscape"===t?{width:a.height,height:a.width}:{width:a.width,height:a.height}}getPaperSizeLabel(e){return d[e]?.label||"A4"}hasContent(){return this.elements.zineSheetsContainer&&null!==this.elements.zineSheetsContainer.querySelector(".page-content-img:not(.hidden)")}on(e,t){this.emitter.on(e,t)}}const g=""+new URL("reference-back-side-MWF-VJIo.jpg",t.meta.url).href;class u{constructor(){this.pdfProcessor=new l,this.ui=new h,this.referenceImageUrl=g,this.allPageImages=new Array(16).fill(null),this.pageFlips={},this.init()}async init(){try{await this.pdfProcessor.initialize(),this.setupEventListeners(),this.checkLibraries(),this.ui.generateLayout(8),this.ui.setStatus("Upload a PDF file to get started","info")}catch(e){console.error("Initialization error:",e),this.ui.setStatus("Failed to initialize. Please refresh the page.","error"),c.error("Initialization Error","Failed to load required libraries.")}}setupEventListeners(){this.ui.on("fileSelected",e=>this.handleFileSelected(e)),this.ui.on("processAndPreview",()=>this.handleProcessAndPreview()),this.ui.on("print",()=>this.handlePrint()),this.ui.on("export",()=>this.handleExport()),this.ui.on("paperSizeChanged",e=>this.updatePaperSettings(e)),this.ui.on("orientationChanged",e=>this.updatePaperSettings(e)),this.ui.on("pagesSwapped",e=>this.handlePagesSwapped(e)),this.ui.on("pageFlipped",e=>this.handlePageFlipped(e)),this.ui.on("gridSizeChanged",e=>this.handleGridSizeChanged(e)),this.ui.elements.printBtn?.addEventListener("click",()=>this.handlePrint()),this.ui.elements.exportPdfBtn?.addEventListener("click",()=>this.handleExport())}handlePageFlipped(e){this.pageFlips[e]=!this.pageFlips[e],this.ui.setPageFlip(e,this.pageFlips[e])}handleGridSizeChanged({rows:e,cols:t}){this.gridSize={rows:e,cols:t};const a=e*t;this.ui.generateCustomGrid(e,t,this.allPageImages.length);for(let i=0;i<Math.min(a,this.allPageImages.length);i++)this.allPageImages[i]&&this.ui.updatePagePreview(i,this.allPageImages[i])}setupInteractiveTicks(){}checkLibraries(){window.jspdf||console.warn("PDF library not yet loaded...")}handleFileSelected(e){this.selectedFile=e,this.ui.setStatus(`File selected: ${e.name} (${s(e.size)})`,"success"),this.processPDF(e)}async processPDF(e){try{c.info("Reading PDF...","Please wait"),this.ui.showProgress(!0,"Reading PDF...","0%");const t=await this.pdfProcessor.loadPDF(e,e=>{this.ui.updateProgress(e)}),{numPages:a}=t;this.selectedLayout=a;const i=a;let r,n;if(16===a)r=4,n=4,this.ui.generateLayout(16,"accordion-16");else{const e=Math.ceil(Math.sqrt(a));r=a<=8?2:e>2?e:2,n=a<=8?4:Math.ceil(a/r),r=Math.min(r,10),n=Math.min(n,10),this.allPageImages=new Array(Math.max(r*n,a)).fill(null),this.ui.generateCustomGrid(r,n,this.allPageImages.length)}this.ui.elements.gridRows&&(this.ui.elements.gridRows.value=r),this.ui.elements.gridCols&&(this.ui.elements.gridCols.value=n),this.ui.elements.gridTotal&&(this.ui.elements.gridTotal.textContent=`(${r*n} pages)`);const s=`PDF arranged into a ${r}×${n} grid (${r*n} pages)`;this.ui.setReady(!0,s);for(let e=1;e<=i;e++){const t=await this.pdfProcessor.renderPage(e),a=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=a,this.ui.updatePagePreview(e-1,a);const r=Math.round(e/i*100);this.ui.showProgress(!0,`Processing Page ${e} of ${i}`,`${r}%`),this.ui.updateProgress(r)}for(let e=i+1;e<=this.selectedLayout;e++)await this.createBlankPage(e);this.ui.showProgress(!1),this.ui.setStatus(`Successfully processed ${a} pages`,"success"),c.success("Done!","Your zine is ready to print.")}catch(t){console.error("PDF Error:",t),this.ui.showProgress(!1),c.error("Error","Failed to process PDF.")}}async createBlankPage(e){const t=document.createElement("canvas");t.width=1e3,t.height=1400;const a=t.getContext("2d");a.fillStyle="#ffffff",a.fillRect(0,0,1e3,1400),a.fillStyle="#f3f4f6",a.font="bold 80px sans-serif",a.textAlign="center",a.fillText("BLANK",500,700);const i=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=i,this.ui.updatePagePreview(e-1,i)}handlePagesSwapped({fromIndex:e,toIndex:t}){const a=this.allPageImages[e];this.allPageImages[e]=this.allPageImages[t],this.allPageImages[t]=a;const i=this.pageFlips[e];this.pageFlips[e]=this.pageFlips[t],this.pageFlips[t]=i,this.ui.updatePagePreview(e,this.allPageImages[e]),this.ui.updatePagePreview(t,this.allPageImages[t]),this.ui.setPageFlip(e,!!this.pageFlips[e]),this.ui.setPageFlip(t,!!this.pageFlips[t]),c.info("Pages swapped")}updateZineView(e){const t=8*(e-1);for(let a=0;a<8;a++){const e=t+a,i=this.allPageImages[e];this.ui.updatePagePreview(a,i)}}updatePaperSettings(e){this.paperSize=e.paperSize,this.orientation=e.orientation}handlePrint(){this.ui.hasContent()&&this.createPrintLayout()}createPrintLayout(){const e=window.open("","_blank");if(!e)return void c.error("Blocked","Please allow popups.");const t=[];document.querySelectorAll(".zine-grid").forEach(e=>{t.push(e.innerHTML)});const a=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),{rows:i,cols:r}=this.gridSize,n=`\n      grid-template-columns: repeat(${r}, 1fr);\n      grid-template-rows: repeat(${i}, 1fr);\n      grid-template-areas: none !important;\n      /* Generate grid areas if needed, but simple flow usually works for generic grids */\n    `,s=t.map(e=>`\n      <div class="sheet">\n        <div class="zine-grid">${e}</div>\n        \n      </div>\n      <div class="sheet"><div class="back-side"></div></div>\n    `).join(""),o=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Print Zine</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ${a.width}mm ${a.height}mm; margin: 0; }\n          body { background: white; width: ${a.width}mm; height: ${a.height}mm; overflow: hidden; }\n          .sheet { width: 100%; height: 100%; page-break-after: always; display: block; overflow: hidden; position: relative; }\n          .zine-grid {\n            display: grid;\n            ${n}\n            height: ${a.height}mm;\n            width: ${a.width}mm;\n            /* Ensure grid fills the page */\n            justify-content: stretch;\n            align-content: stretch;\n          }\n          .page-cell {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            overflow: hidden;\n            border: 0.1mm dashed #eee;\n          }\n          /* Generic page areas fallback if needed */\n          \n          .page-content-img { \n            width: 100%; \n            height: 100%; \n            object-fit: contain; \n            /* Rely on DOM transform for rotation */\n          }\n          .page-label, .page-placeholder { display: none; }\n          \n          .back-side {\n            width: 100%; height: 100%;\n            background-image: url('${this.referenceImageUrl}');\n            background-size: contain;\n            background-position: center;\n            background-repeat: no-repeat;\n            background-repeat: no-repeat;\n            transform: rotate(180deg);\n          }\n          \n          /* CRITICAL: Hide controls in print */\n          @media print {\n            .flip-btn, .page-label, .guidelines, .page-placeholder, .page-cell::before, .page-cell::after { \n                display: none !important; \n            }\n            .page-cell { border: none !important; }\n          }\n          \n          \n        </style>\n      </head>\n      <body>\n        ${s}\n      </body>\n      </html>\n    `;e.document.write(o),e.document.close(),e.setTimeout(()=>{e.print(),e.close()},500)}async handleExport(){if(this.ui.hasContent())try{this.ui.elements.exportPdfBtn.disabled=!0,c.info("Generating PDF...");const e=new r({orientation:this.orientation||"landscape",unit:"mm",format:this.paperSize||"a4"}),t=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),a=async a=>{const i=document.querySelector(`#zine-grid-sheet-${a}`);if(!i)return;await new Promise(e=>setTimeout(e,100));const r=await n(i,{scale:3,useCORS:!0,backgroundColor:"#ffffff"});a>1&&e.addPage(),e.addImage(r.toDataURL("image/jpeg",.95),"JPEG",0,0,t.width,t.height),e.addPage();const s=document.createElement("canvas");s.width=r.width,s.height=r.height;const o=s.getContext("2d"),l=new Image;l.src=this.referenceImageUrl,await new Promise(e=>{l.onload=e}),o.translate(s.width/2,s.height/2),o.rotate(Math.PI),o.drawImage(l,-s.width/2,-s.height/2,s.width,s.height),e.addImage(s.toDataURL("image/jpeg",.9),"JPEG",0,0,t.width,t.height)};await a(1),"accordion-16"!==this.currentTemplate&&this.selectedLayout>8&&await a(2),e.save(`zine-${Date.now()}.pdf`),c.success("Downloaded!")}catch(e){console.error(e),c.error("Export Failed")}finally{this.ui.elements.exportPdfBtn.disabled=!1}}}document.addEventListener("DOMContentLoaded",()=>{new u})}}});
//# sourceMappingURL=index-legacy-L4x3r4iy.js.map
