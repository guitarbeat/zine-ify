System.register(["./pdfjs-legacy-B7EZslUV.js","./jspdf-legacy-DoPFqSOu.js","./html2canvas-legacy-DIGTxsNk.js"],function(e,t){"use strict";var i,s,n,a;return{setters:[e=>{i=e.G,s=e.g},e=>{n=e.E},e=>{a=e.default}],execute:function(){function e(e){if("number"!=typeof(t=e)||isNaN(t)||!isFinite(t))return"0 B";var t;const i=["B","KB","MB","GB"];let s=e,n=0;for(;s>=1024&&n<i.length-1;)s/=1024,n++;return`${s.toFixed(1)} ${i[n]}`}const r=""+new URL("pdf.worker.min-LyOxJPrg.mjs",t.meta.url).href;class o{constructor(){this.pdf=null,this.isProcessing=!1}async initialize(){i.workerSrc=r}validateFile(t){const i=[];if(!t)return i.push("No file selected"),{valid:!1,errors:i};"application/pdf"!==t.type&&i.push("Please select a PDF file");const s=262144e3;return t.size>s&&i.push(`File too large (${e(t.size)}). Maximum size is ${e(s)}`),0===t.size&&i.push("File appears to be empty"),{valid:0===i.length,errors:i}}async loadPDF(e,t=null){if(this.isProcessing)throw new Error("PDF processing already in progress");this.isProcessing=!0;try{const i=this.validateFile(e);if(!i.valid)throw new Error(i.errors.join(". "));t?.("Reading PDF file...");const n=await this.readFileAsArrayBuffer(e);t?.("Processing PDF...");const a=s({data:n,verbosity:0}).promise,r=new Promise((e,t)=>setTimeout(()=>t(new Error("PDF loading timed out")),6e4));this.pdf=await Promise.race([a,r]);const o=this.pdf.numPages;if(0===o)throw new Error("PDF appears to be empty or corrupted");return{pdf:this.pdf,numPages:o,fileName:e.name,fileSize:e.size}}catch(i){throw console.error("PDF loading error:",i),this.handlePDFError(i)}finally{this.isProcessing=!1}}readFileAsArrayBuffer(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>i(new Error("Failed to read file")),s.onabort=()=>i(new Error("File reading was cancelled")),s.readAsArrayBuffer(e)})}async renderPage(e,t=null){if(!this.pdf)throw new Error("No PDF loaded");try{t?.(`Rendering page ${e}...`);const i=await this.pdf.getPage(e),s=1.5,n=i.getViewport({scale:s}),a=document.createElement("canvas"),r=a.getContext("2d",{alpha:!1});a.width=Math.floor(n.width),a.height=Math.floor(n.height),r.fillStyle="#ffffff",r.fillRect(0,0,a.width,a.height);const o={canvasContext:r,viewport:n,background:"white"};return await i.render(o).promise,console.log(`Rendered page ${e}, canvas size: ${a.width}x${a.height}`),a}catch(i){throw console.error(`Failed to render page ${e}:`,i),new Error(`Failed to render page ${e}`)}}async canvasToBlob(e){return new Promise(t=>{e.toBlob(e=>{const i=URL.createObjectURL(e);t(i)},"image/jpeg",.9)})}revokeBlobUrl(e){e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}canvasToDataURL(e,t="image/jpeg",i=.85){try{const s=e.toDataURL(t,i);return console.log(`Generated data URL, format: ${t}, size: ${s.length} chars`),s}catch(s){return console.warn(`Failed to generate ${t}, falling back to PNG:`,s),e.toDataURL("image/png",1)}}handlePDFError(e){const t=e.message||"Unknown error";return t.includes("timed out")?new Error("PDF loading timed out. The file may be corrupted or too large."):t.includes("corrupted")||t.includes("InvalidPDFException")?new Error("The PDF file appears to be corrupted or invalid."):t.includes("password")||t.includes("protected")?new Error("The PDF file is password-protected."):t.includes("not loaded")||t.includes("MissingPDFException")?new Error("PDF.js library failed to load. Please refresh the page."):new Error(`PDF processing failed: ${t}`)}cleanup(){this.pdf&&(this.pdf.destroy(),this.pdf=null),this.isProcessing=!1}}const l={a4:{label:"A4 (210 × 297 mm)",width:210,height:297},a3:{label:"A3 (297 × 420 mm)",width:297,height:420},letter:{label:"Letter (8.5 × 11 in)",width:215.9,height:279.4},legal:{label:"Legal (8.5 × 14 in)",width:215.9,height:355.6},a5:{label:"A5 (148 × 210 mm)",width:148,height:210}},d={"mini-8":{label:"8-Page Mini-Zine",pages:8,grid:{rows:2,cols:4},layout:[{page:5,upsideDown:!1},{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:1,upsideDown:!1}],gridAreas:'\n            "page5 page4 page3 page2"\n            "page6 page7 page8 page1"\n        ',upsideDownPages:[2,3,4,5],cutLines:{horizontal:{afterRow:1}}},"accordion-16":{label:"16-Page Accordion",pages:16,grid:{rows:4,cols:4},layout:[{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:1,upsideDown:!0},{page:5,upsideDown:!1},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:12,upsideDown:!0},{page:11,upsideDown:!0},{page:10,upsideDown:!0},{page:9,upsideDown:!0},{page:13,upsideDown:!1},{page:14,upsideDown:!1},{page:15,upsideDown:!1},{page:16,upsideDown:!1}],gridAreas:'\n            "page4 page3 page2 page1"\n            "page5 page6 page7 page8"\n            "page12 page11 page10 page9"\n            "page13 page14 page15 page16"\n        ',upsideDownPages:[1,2,3,4,9,10,11,12],cutLines:{leftEdge:{rows:[0,1,2]},rightEdge:{rows:[0,1,2]}},description:"1 sheet, 4×4 grid. Cut along edges then fold accordion-style."},"dual-16":{label:"16-Page Dual Sheets",pages:16,sheets:2,grid:{rows:2,cols:4},description:"2 sheets, each folded like an 8-page zine."}},p=new class{constructor(){this.container=null,this.init()}init(){this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",this.container.setAttribute("aria-live","polite"),document.body.appendChild(this.container))}show(e,t,i="",s=5e3){const n=document.createElement("div");n.className=`toast toast-${e}`,n.setAttribute("role","alert");const a=`\n      <div class="toast-icon">${this.getIcon(e)}</div>\n      <div class="toast-content">\n        <div class="toast-title">${t}</div>\n        ${i?`<div class="toast-message">${i}</div>`:""}\n      </div>\n      <button class="toast-close" aria-label="Close notification">&times;</button>\n    `;return n.innerHTML=a,this.container.appendChild(n),n.querySelector(".toast-close").addEventListener("click",()=>this.remove(n)),s>0&&setTimeout(()=>{n.parentNode&&this.remove(n)},s),requestAnimationFrame(()=>{n.classList.add("toast-visible")}),n}remove(e){e.classList.remove("toast-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getIcon(e){const t={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>\n        <polyline points="22,4 12,14.01 9,11.01"/>\n      </svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <line x1="15" y1="9" x2="9" y2="15"/>\n        <line x1="9" y1="9" x2="15" y2="15"/>\n      </svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>\n        <line x1="12" y1="9" x2="12" y2="13"/>\n        <line x1="12" y1="17" x2="12.01" y2="17"/>\n      </svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <path d="M12 16v-4"/>\n        <path d="M12 8h.01"/>\n      </svg>'};return t[e]||t.info}success(e,t,i){return this.show("success",e,t,i)}error(e,t,i){return this.show("error",e,t,i)}warning(e,t,i){return this.show("warning",e,t,i)}info(e,t,i){return this.show("info",e,t,i)}};class c{constructor(){var e;this.emitter={all:e=e||new Map,on:function(t,i){var s=e.get(t);s?s.push(i):e.set(t,[i])},off:function(t,i){var s=e.get(t);s&&(i?s.splice(s.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var s=e.get(t);s&&s.slice().map(function(e){e(i)}),(s=e.get("*"))&&s.slice().map(function(e){e(t,i)})}},this.elements={},this.paperSize="a4",this.orientation="landscape",this.init()}init(){this.cacheElements(),this.renderPaperSizeOptions(),this.loadSettings(),this.updatePreviewLayout(),this.setupEventListeners()}cacheElements(){const e=e=>document.querySelector(e);this.elements={uploadZone:e("#upload-zone"),previewArea:e("#preview-area"),actionButtons:e("#action-buttons"),previewDescription:e("#preview-description"),zineSheetsContainer:e("#zine-sheets-container"),printBtn:e("#printBtn"),exportPdfBtn:e("#exportPdfBtn"),pdfUpload:e("#pdf-upload"),uploadStatus:e("#upload-status"),progressContainer:e("#progress-container"),progressFill:e("#progress-fill"),progressText:e("#progress-text"),progressSubtext:e("#progress-subtext"),paperSizeSelect:e("#paper-size-select"),orientationSelect:e("#orientation-select"),pageNumbersCheckbox:e("#show-page-numbers"),toastContainer:e("#toast-container"),zineTabs:e("#zine-tabs"),zineTab1:e("#zine-tab-1"),zineTab2:e("#zine-tab-2"),gridRows:e("#grid-rows"),gridCols:e("#grid-cols"),gridTotal:e("#grid-total"),unusedSection:e("#unused-pages-section"),unusedGrid:e("#unused-grid")}}renderPaperSizeOptions(){this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.innerHTML=Object.entries(l).map(([e,t])=>`<option value="${e}">${t.label}</option>`).join(""))}setupEventListeners(){this.elements.paperSizeSelect?.addEventListener("change",e=>this.updatePaperSize(e.target.value)),this.elements.orientationSelect?.addEventListener("change",e=>this.updateOrientation(e.target.value)),this.elements.pageNumbersCheckbox?.addEventListener("change",e=>this.togglePageNumbers(e.target.checked)),this.elements.uploadZone?.addEventListener("click",()=>this.triggerFileUpload()),this.elements.uploadZone?.addEventListener("dragover",e=>this.handleDragOver(e)),this.elements.uploadZone?.addEventListener("dragleave",e=>this.handleDragLeave(e)),this.elements.uploadZone?.addEventListener("drop",e=>this.handleFileDrop(e)),this.elements.pdfUpload?.addEventListener("change",e=>{const t=e.target.files[0];t&&this.emitter.emit("fileSelected",t)});const e=()=>{const e=parseInt(this.elements.gridRows?.value)||2,t=parseInt(this.elements.gridCols?.value)||4;this.elements.gridTotal&&(this.elements.gridTotal.textContent=`(${e*t} pages)`),this.emitter.emit("gridSizeChanged",{rows:e,cols:t})};this.elements.gridRows?.addEventListener("input",e),this.elements.gridCols?.addEventListener("input",e),document.addEventListener("keydown",e=>this.handleKeyboard(e))}setReady(e,t=null){e?(this.elements.previewArea?.classList.remove("opacity-30","pointer-events-none"),this.elements.actionButtons?.classList.remove("hidden")):(this.elements.previewArea?.classList.add("opacity-30","pointer-events-none"),this.elements.actionButtons?.classList.add("hidden")),t&&this.elements.previewDescription&&(this.elements.previewDescription.textContent=t)}updateProgress(e){this.elements.progressFill&&(this.elements.progressFill.style.width=`${e}%`)}setStatus(e,t="info"){this.elements.uploadStatus&&(this.elements.uploadStatus.textContent=e,this.elements.uploadStatus.className="text-[11px] uppercase font-bold tracking-wider "+("error"===t?"text-red-500":"success"===t?"text-green-500":"text-gray-400"))}generateLayout(e=8,t=null){if(!this.elements.zineSheetsContainer)return;this.elements.zineSheetsContainer.innerHTML="",t||(t=e>8?"accordion-16":"mini-8"),this.currentTemplate=t;const i=d[t];i?("accordion-16"===t?this.generateAccordionLayout(i):this.generateMiniZineLayout(e,i),this.updatePreviewLayout()):console.error(`Unknown template: ${t}`)}generateCustomGrid(e,t,i=0){this.elements.zineSheetsContainer.innerHTML="";const s=e*t,n=Math.max(s,i),a=document.createElement("div");a.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",a.setAttribute("data-sheet",1),a.setAttribute("data-template",`custom-${e}x${t}`);const r=document.createElement("div");r.className="zine-grid",r.id="zine-grid-sheet-1",r.style.display="grid",r.style.gridTemplateColumns=`repeat(${t}, 1fr)`,r.style.gridTemplateRows=`repeat(${e}, 1fr)`,r.style.gridTemplateAreas="none";for(let o=0;o<s;o++){const e=o+1,t=document.createElement("div");t.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden transition-all duration-200",t.setAttribute("data-page-index",o),t.setAttribute("data-page",e),t.setAttribute("draggable","true");const i=1===e?"Cover":e===s?"Back":`Page ${e}`;t.innerHTML=`\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${i}</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ${e}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      `,this.setupDragAndDrop(t),this.setupFlipButton(t),r.appendChild(t)}a.appendChild(r),this.elements.zineSheetsContainer.appendChild(a),this.generateUnusedBucket(s,n),this.updatePreviewLayout()}generateUnusedBucket(e,t){const{unusedSection:i,unusedGrid:s}=this.elements;if(i&&s)if(s.innerHTML="",e>=t)i.classList.add("hidden");else{i.classList.remove("hidden");for(let i=e;i<t;i++){const e=document.createElement("div");e.className="page-cell bg-white aspect-[1/1.414] relative rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing hover:border-blue-500 transition-colors duration-200",e.setAttribute("data-page-index",i),e.draggable=!0;const t=document.createElement("img");t.className="page-content-img w-full h-full object-contain hidden pointer-events-none",t.draggable=!1;const n=document.createElement("div");n.className="absolute top-1 left-1 bg-gray-500 text-white text-[8px] px-1.5 py-0.5 rounded-sm font-bold z-10",n.textContent=`#${i+1}`;const a=document.createElement("div");a.className="text-[10px] uppercase font-bold text-gray-300 select-none",a.textContent="Unused",e.appendChild(n),e.appendChild(a),e.appendChild(t),this.setupDragAndDrop(e),s.appendChild(e)}}}generateAccordionLayout(e){const t=document.createElement("div");t.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",t.setAttribute("data-sheet",1),t.setAttribute("data-template","accordion-16");const i=document.createElement("div");i.className="zine-grid accordion-16",i.id="zine-grid-sheet-1",e.layout.forEach(e=>{const t=document.createElement("div");t.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",t.setAttribute("data-page-index",e.page-1),t.setAttribute("data-page",e.page),t.setAttribute("draggable","true");const s=1===e.page?"Cover":16===e.page?"Back":`Page ${e.page}`;t.innerHTML=`\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${s}</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ${e.page}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      `,this.setupDragAndDrop(t),this.setupFlipButton(t),i.appendChild(t)}),t.appendChild(i),t.insertAdjacentHTML("beforeend",'\n      <div class="absolute top-1/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-3/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n    '),this.elements.zineSheetsContainer.appendChild(t)}generateMiniZineLayout(e,t){const i=e>8?2:1;for(let s=1;s<=i;s++){const e=document.createElement("div");e.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",e.setAttribute("data-sheet",s);const t=document.createElement("div");t.className="zine-grid",t.id=`zine-grid-sheet-${s}`;for(let a=1;a<=8;a++){const e=8*(s-1)+a,n=document.createElement("div");n.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",n.setAttribute("data-page-index",e-1),n.setAttribute("data-page",a),n.setAttribute("draggable","true");const r=1===a?"Cover":8===a?"Back":`Page ${a}`,o=i>1?` <span class="opacity-50 text-[8px] ml-1">(Sheet ${s})</span>`:"";n.innerHTML=`\n          <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">${r}${o}</span>\n          <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n              <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n          </button>\n          <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n          <img alt="Page ${e}" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n        `,this.setupDragAndDrop(n),this.setupFlipButton(n),t.appendChild(n)}const n='\n        <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n      ';e.appendChild(t),e.insertAdjacentHTML("beforeend",n),this.elements.zineSheetsContainer.appendChild(e)}}setupDragAndDrop(e){e.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",e.getAttribute("data-page-index")),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),document.querySelectorAll(".page-cell").forEach(e=>e.classList.remove("drag-over"))}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("drag-over");const i=parseInt(t.dataTransfer.getData("text/plain")),s=parseInt(e.getAttribute("data-page-index"));i!==s&&this.emitter.emit("pagesSwapped",{fromIndex:i,toIndex:s})})}updatePagePreview(e,t){let i=this.elements.zineSheetsContainer.querySelector(`[data-page-index="${e}"]`);if(!i&&this.elements.unusedGrid&&(i=this.elements.unusedGrid.querySelector(`[data-page-index="${e}"]`)),i){const e=i.querySelector(".page-content-img"),s=i.querySelector(".page-placeholder");e&&s&&(t?(e.src=t,e.classList.remove("hidden"),s.classList.add("hidden")):(e.src="",e.classList.add("hidden"),s.classList.remove("hidden")))}}setupFlipButton(e){const t=e.querySelector(".flip-btn");t&&t.addEventListener("click",t=>{t.stopPropagation();const i=parseInt(e.getAttribute("data-page-index"));this.emitter.emit("pageFlipped",i)})}setPageFlip(e,t){const i=this.elements.zineSheetsContainer.querySelector(`[data-page-index="${e}"]`);if(i){const e=i.querySelector(".page-content-img");e&&(t?(e.style.transform=`${e.style.transform||""} rotate(180deg)`.trim(),e.classList.add("flipped")):(e.style.transform=e.style.transform.replace("rotate(180deg)","").trim(),e.classList.remove("flipped")))}}setActiveTab(){}triggerFileUpload(){this.elements.pdfUpload?.click()}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.add("dragover")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&!this.elements.uploadZone.contains(e.relatedTarget)&&this.elements.uploadZone.classList.remove("dragover")}handleFileDrop(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&"application/pdf"===t[0].type?this.emitter.emit("fileSelected",t[0]):p.error("Invalid File","Please drop a valid PDF file")}handleKeyboard(e){"p"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),this.emitter.emit("print"))}showProgress(e,t="Processing PDF...",i=""){e?this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressContainer.classList.add("flex")):this.elements.progressContainer&&(this.elements.progressContainer.classList.add("hidden"),this.elements.progressContainer.classList.remove("flex")),this.elements.progressText&&(this.elements.progressText.textContent=t),this.elements.progressSubtext&&(this.elements.progressSubtext.textContent=i)}loadSettings(){const e=localStorage.getItem("paperSize"),t=localStorage.getItem("orientation");e&&(this.paperSize=e,this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.value=e)),t&&(this.orientation=t,this.elements.orientationSelect&&(this.elements.orientationSelect.value=t))}updatePaperSize(e){this.paperSize=e,localStorage.setItem("paperSize",e),this.updatePreviewLayout(),this.emitter.emit("paperSizeChanged",{paperSize:e,orientation:this.orientation})}updateOrientation(e){this.orientation=e,localStorage.setItem("orientation",e),this.updatePreviewLayout(),this.emitter.emit("orientationChanged",{paperSize:this.paperSize,orientation:e})}togglePageNumbers(e){document.querySelectorAll(".page-label").forEach(t=>{e?(t.classList.remove("hidden"),t.classList.add("centered")):(t.classList.add("hidden"),t.classList.remove("centered"))})}updatePreviewLayout(){const e=document.querySelectorAll(".print-sheet");if(!e.length)return;const t=this.getPaperDimensions(this.paperSize,this.orientation),i=t.width/t.height;e.forEach(e=>{e.style.aspectRatio=`${i}`,e.style.maxHeight="75vh",e.style.maxWidth="100%",e.style.margin="0 auto"})}getPaperDimensions(e,t){const i=l[e]||l.a4;return"landscape"===t?{width:i.height,height:i.width}:{width:i.width,height:i.height}}getPaperSizeLabel(e){return l[e]?.label||"A4"}hasContent(){return this.elements.zineSheetsContainer&&null!==this.elements.zineSheetsContainer.querySelector(".page-content-img:not(.hidden)")}on(e,t){this.emitter.on(e,t)}}const h=""+new URL("reference-back-side-MWF-VJIo.jpg",t.meta.url).href;class g{constructor(){this.pdfProcessor=new o,this.ui=new c,this.referenceImageUrl=h,this.allPageImages=new Array(16).fill(null),this.pageFlips={},this.init()}async init(){try{await this.pdfProcessor.initialize(),this.setupEventListeners(),this.checkLibraries(),this.ui.generateLayout(8),this.ui.setStatus("Upload a PDF file to get started","info")}catch(e){console.error("Initialization error:",e),this.ui.setStatus("Failed to initialize. Please refresh the page.","error"),p.error("Initialization Error","Failed to load required libraries.")}}setupEventListeners(){this.ui.on("fileSelected",e=>this.handleFileSelected(e)),this.ui.on("processAndPreview",()=>this.handleProcessAndPreview()),this.ui.on("print",()=>this.handlePrint()),this.ui.on("export",()=>this.handleExport()),this.ui.on("paperSizeChanged",e=>this.updatePaperSettings(e)),this.ui.on("orientationChanged",e=>this.updatePaperSettings(e)),this.ui.on("pagesSwapped",e=>this.handlePagesSwapped(e)),this.ui.on("pageFlipped",e=>this.handlePageFlipped(e)),this.ui.on("gridSizeChanged",e=>this.handleGridSizeChanged(e)),this.ui.elements.printBtn?.addEventListener("click",()=>this.handlePrint()),this.ui.elements.exportPdfBtn?.addEventListener("click",()=>this.handleExport())}handlePageFlipped(e){this.pageFlips[e]=!this.pageFlips[e],this.ui.setPageFlip(e,this.pageFlips[e])}handleGridSizeChanged({rows:e,cols:t}){this.gridSize={rows:e,cols:t};const i=e*t;this.ui.generateCustomGrid(e,t,this.allPageImages.length);for(let s=0;s<Math.min(i,this.allPageImages.length);s++)this.allPageImages[s]&&this.ui.updatePagePreview(s,this.allPageImages[s])}setupInteractiveTicks(){}checkLibraries(){window.jspdf||console.warn("PDF library not yet loaded...")}handleFileSelected(t){this.selectedFile=t,this.ui.setStatus(`File selected: ${t.name} (${e(t.size)})`,"success"),this.processPDF(t)}async processPDF(e){try{p.info("Reading PDF...","Please wait"),this.ui.showProgress(!0,"Reading PDF...","0%");const t=await this.pdfProcessor.loadPDF(e,e=>{this.ui.updateProgress(e)}),{numPages:i}=t;this.selectedLayout=i;const s=i;let n,a;if(16===i)n=4,a=4,this.ui.generateLayout(16,"accordion-16");else{const e=Math.ceil(Math.sqrt(i));n=i<=8?2:e>2?e:2,a=i<=8?4:Math.ceil(i/n),n=Math.min(n,10),a=Math.min(a,10),this.allPageImages=new Array(Math.max(n*a,i)).fill(null),this.ui.generateCustomGrid(n,a,this.allPageImages.length)}this.ui.elements.gridRows&&(this.ui.elements.gridRows.value=n),this.ui.elements.gridCols&&(this.ui.elements.gridCols.value=a),this.ui.elements.gridTotal&&(this.ui.elements.gridTotal.textContent=`(${n*a} pages)`);const r=`PDF arranged into a ${n}×${a} grid (${n*a} pages)`;this.ui.setReady(!0,r);for(let e=1;e<=s;e++){const t=await this.pdfProcessor.renderPage(e),i=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=i,this.ui.updatePagePreview(e-1,i);const n=Math.round(e/s*100);this.ui.showProgress(!0,`Processing Page ${e} of ${s}`,`${n}%`),this.ui.updateProgress(n)}for(let e=s+1;e<=this.selectedLayout;e++)await this.createBlankPage(e);this.ui.showProgress(!1),this.ui.setStatus(`Successfully processed ${i} pages`,"success"),p.success("Done!","Your zine is ready to print.")}catch(t){console.error("PDF Error:",t),this.ui.showProgress(!1),p.error("Error","Failed to process PDF.")}}async createBlankPage(e){const t=document.createElement("canvas");t.width=1e3,t.height=1400;const i=t.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1e3,1400),i.fillStyle="#f3f4f6",i.font="bold 80px sans-serif",i.textAlign="center",i.fillText("BLANK",500,700);const s=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=s,this.ui.updatePagePreview(e-1,s)}handlePagesSwapped({fromIndex:e,toIndex:t}){const i=this.allPageImages[e];this.allPageImages[e]=this.allPageImages[t],this.allPageImages[t]=i;const s=this.pageFlips[e];this.pageFlips[e]=this.pageFlips[t],this.pageFlips[t]=s,this.ui.updatePagePreview(e,this.allPageImages[e]),this.ui.updatePagePreview(t,this.allPageImages[t]),this.ui.setPageFlip(e,!!this.pageFlips[e]),this.ui.setPageFlip(t,!!this.pageFlips[t]),p.info("Pages swapped")}updateZineView(e){const t=8*(e-1);for(let i=0;i<8;i++){const e=t+i,s=this.allPageImages[e];this.ui.updatePagePreview(i,s)}}updatePaperSettings(e){this.paperSize=e.paperSize,this.orientation=e.orientation}handlePrint(){this.ui.hasContent()&&this.createPrintLayout()}createPrintLayout(){const e=window.open("","_blank");if(!e)return void p.error("Blocked","Please allow popups.");const t=[];document.querySelectorAll(".zine-grid").forEach(e=>{t.push(e.innerHTML)});const i=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),{rows:s,cols:n}=this.gridSize,a=`\n      grid-template-columns: repeat(${n}, 1fr);\n      grid-template-rows: repeat(${s}, 1fr);\n      grid-template-areas: none !important;\n      /* Generate grid areas if needed, but simple flow usually works for generic grids */\n    `,r=t.map(e=>`\n      <div class="sheet">\n        <div class="zine-grid">${e}</div>\n        \n      </div>\n      <div class="sheet"><div class="back-side"></div></div>\n    `).join(""),o=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Print Zine</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ${i.width}mm ${i.height}mm; margin: 0; }\n          body { background: white; width: ${i.width}mm; height: ${i.height}mm; overflow: hidden; }\n          .sheet { width: 100%; height: 100%; page-break-after: always; display: block; overflow: hidden; position: relative; }\n          .zine-grid {\n            display: grid;\n            ${a}\n            height: ${i.height}mm;\n            width: ${i.width}mm;\n            /* Ensure grid fills the page */\n            justify-content: stretch;\n            align-content: stretch;\n          }\n          .page-cell {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            overflow: hidden;\n            border: 0.1mm dashed #eee;\n          }\n          /* Generic page areas fallback if needed */\n          \n          .page-content-img { \n            width: 100%; \n            height: 100%; \n            object-fit: contain; \n            /* Rely on DOM transform for rotation */\n          }\n          .page-label, .page-placeholder { display: none; }\n          \n          .back-side {\n            width: 100%; height: 100%;\n            background-image: url('${this.referenceImageUrl}');\n            background-size: contain;\n            background-position: center;\n            background-repeat: no-repeat;\n            transform: rotate(180deg);\n          }\n\n          \n          \n        </style>\n      </head>\n      <body>\n        ${r}\n      </body>\n      </html>\n    `;e.document.write(o),e.document.close(),e.setTimeout(()=>{e.print(),e.close()},500)}async handleExport(){if(this.ui.hasContent())try{this.ui.elements.exportPdfBtn.disabled=!0,p.info("Generating PDF...");const e=new n({orientation:this.orientation||"landscape",unit:"mm",format:this.paperSize||"a4"}),t=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),i=async i=>{const s=document.querySelector(`#zine-grid-sheet-${i}`);if(!s)return;await new Promise(e=>setTimeout(e,100));const n=await a(s,{scale:3,useCORS:!0,backgroundColor:"#ffffff"});i>1&&e.addPage(),e.addImage(n.toDataURL("image/jpeg",.95),"JPEG",0,0,t.width,t.height),e.addPage();const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d"),l=new Image;l.src=this.referenceImageUrl,await new Promise(e=>{l.onload=e}),o.translate(r.width/2,r.height/2),o.rotate(Math.PI),o.drawImage(l,-r.width/2,-r.height/2,r.width,r.height),e.addImage(r.toDataURL("image/jpeg",.9),"JPEG",0,0,t.width,t.height)};await i(1),"accordion-16"!==this.currentTemplate&&this.selectedLayout>8&&await i(2),e.save(`zine-${Date.now()}.pdf`),p.success("Downloaded!")}catch(e){console.error(e),p.error("Export Failed")}finally{this.ui.elements.exportPdfBtn.disabled=!1}}}document.addEventListener("DOMContentLoaded",()=>{new g})}}});
//# sourceMappingURL=index-legacy-DsX2t_67.js.map
