import{G as b,g as P}from"./pdfjs-D6wmnEBf.js";import{E as y}from"./jspdf-BPleGa-m.js";import x from"./html2canvas-DcoBDRbt.js";function A(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function L(c){return typeof c=="number"&&!isNaN(c)&&isFinite(c)}function f(c){if(!L(c))return"0 B";const e=["B","KB","MB","GB"];let t=c,i=0;for(;t>=1024&&i<e.length-1;)t/=1024,i++;return"".concat(t.toFixed(1)," ").concat(e[i])}const S=""+new URL("pdf.worker.min-LyOxJPrg.mjs",import.meta.url).href;class D{constructor(){this.pdf=null,this.isProcessing=!1}async initialize(){b.workerSrc=S}validateFile(e){const t=[];if(!e)return t.push("No file selected"),{valid:!1,errors:t};e.type!=="application/pdf"&&t.push("Please select a PDF file");const i=250*1024*1024;return e.size>i&&t.push("File too large (".concat(f(e.size),"). Maximum size is ").concat(f(i))),e.size===0&&t.push("File appears to be empty"),{valid:t.length===0,errors:t}}async loadPDF(e,t=null){if(this.isProcessing)throw new Error("PDF processing already in progress");this.isProcessing=!0;try{const i=this.validateFile(e);if(!i.valid)throw new Error(i.errors.join(". "));t==null||t("Reading PDF file...");const s=await this.readFileAsArrayBuffer(e);t==null||t("Processing PDF...");const a=P({data:s,verbosity:0}).promise,r=new Promise((n,d)=>setTimeout(()=>d(new Error("PDF loading timed out")),6e4));this.pdf=await Promise.race([a,r]);const o=this.pdf.numPages;if(o===0)throw new Error("PDF appears to be empty or corrupted");return{pdf:this.pdf,numPages:o,fileName:e.name,fileSize:e.size}}catch(i){throw console.error("PDF loading error:",i),this.handlePDFError(i)}finally{this.isProcessing=!1}}readFileAsArrayBuffer(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>i(new Error("Failed to read file")),s.onabort=()=>i(new Error("File reading was cancelled")),s.readAsArrayBuffer(e)})}async renderPage(e,t=null){if(!this.pdf)throw new Error("No PDF loaded");try{t==null||t("Rendering page ".concat(e,"..."));const i=await this.pdf.getPage(e),a=i.getViewport({scale:1.5}),r=document.createElement("canvas"),o=r.getContext("2d",{alpha:!1});r.width=Math.floor(a.width),r.height=Math.floor(a.height),o.fillStyle="#ffffff",o.fillRect(0,0,r.width,r.height);const n={canvasContext:o,viewport:a,background:"white"};return await i.render(n).promise,console.log("Rendered page ".concat(e,", canvas size: ").concat(r.width,"x").concat(r.height)),r}catch(i){throw console.error("Failed to render page ".concat(e,":"),i),new Error("Failed to render page ".concat(e))}}async canvasToBlob(e){return new Promise(t=>{e.toBlob(i=>{const s=URL.createObjectURL(i);t(s)},"image/jpeg",.9)})}revokeBlobUrl(e){e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}canvasToDataURL(e,t="image/jpeg",i=.85){try{const s=e.toDataURL(t,i);return console.log("Generated data URL, format: ".concat(t,", size: ").concat(s.length," chars")),s}catch(s){return console.warn("Failed to generate ".concat(t,", falling back to PNG:"),s),e.toDataURL("image/png",1)}}handlePDFError(e){const t=e.message||"Unknown error";return t.includes("timed out")?new Error("PDF loading timed out. The file may be corrupted or too large."):t.includes("corrupted")||t.includes("InvalidPDFException")?new Error("The PDF file appears to be corrupted or invalid."):t.includes("password")||t.includes("protected")?new Error("The PDF file is password-protected."):t.includes("not loaded")||t.includes("MissingPDFException")?new Error("PDF.js library failed to load. Please refresh the page."):new Error("PDF processing failed: ".concat(t))}cleanup(){this.pdf&&(this.pdf.destroy(),this.pdf=null),this.isProcessing=!1}}function z(c){return{all:c=c||new Map,on:function(e,t){var i=c.get(e);i?i.push(t):c.set(e,[t])},off:function(e,t){var i=c.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):c.set(e,[]))},emit:function(e,t){var i=c.get(e);i&&i.slice().map(function(s){s(t)}),(i=c.get("*"))&&i.slice().map(function(s){s(e,t)})}}}const m={a4:{label:"A4 (210 × 297 mm)",width:210,height:297},a3:{label:"A3 (297 × 420 mm)",width:297,height:420},letter:{label:"Letter (8.5 × 11 in)",width:215.9,height:279.4},legal:{label:"Legal (8.5 × 14 in)",width:215.9,height:355.6},a5:{label:"A5 (148 × 210 mm)",width:148,height:210}},F={"mini-8":{label:"8-Page Mini-Zine",pages:8,grid:{rows:2,cols:4},layout:[{page:5,upsideDown:!1},{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:1,upsideDown:!1}],gridAreas:'\n            "page5 page4 page3 page2"\n            "page6 page7 page8 page1"\n        ',upsideDownPages:[2,3,4,5],cutLines:{horizontal:{afterRow:1}}},"accordion-16":{label:"16-Page Accordion",pages:16,grid:{rows:4,cols:4},layout:[{page:4,upsideDown:!0},{page:3,upsideDown:!0},{page:2,upsideDown:!0},{page:1,upsideDown:!0},{page:5,upsideDown:!1},{page:6,upsideDown:!1},{page:7,upsideDown:!1},{page:8,upsideDown:!1},{page:12,upsideDown:!0},{page:11,upsideDown:!0},{page:10,upsideDown:!0},{page:9,upsideDown:!0},{page:13,upsideDown:!1},{page:14,upsideDown:!1},{page:15,upsideDown:!1},{page:16,upsideDown:!1}],gridAreas:'\n            "page4 page3 page2 page1"\n            "page5 page6 page7 page8"\n            "page12 page11 page10 page9"\n            "page13 page14 page15 page16"\n        ',upsideDownPages:[1,2,3,4,9,10,11,12],cutLines:{leftEdge:{rows:[0,1,2]},rightEdge:{rows:[0,1,2]}},description:"1 sheet, 4×4 grid. Cut along edges then fold accordion-style."},"dual-16":{label:"16-Page Dual Sheets",pages:16,sheets:2,grid:{rows:2,cols:4},description:"2 sheets, each folded like an 8-page zine."}};class E{constructor(){this.container=null,this.init()}init(){this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",this.container.setAttribute("aria-live","polite"),document.body.appendChild(this.container))}show(e,t,i="",s=5e3){const a=document.createElement("div");a.className="toast toast-".concat(e),a.setAttribute("role","alert");const r=this.getIcon(e),o='\n      <div class="toast-icon">'.concat(r,'</div>\n      <div class="toast-content">\n        <div class="toast-title">').concat(t,"</div>\n        ").concat(i?'<div class="toast-message">'.concat(i,"</div>"):"",'\n      </div>\n      <button class="toast-close" aria-label="Close notification">&times;</button>\n    ');return a.innerHTML=o,this.container.appendChild(a),a.querySelector(".toast-close").addEventListener("click",()=>this.remove(a)),s>0&&setTimeout(()=>{a.parentNode&&this.remove(a)},s),requestAnimationFrame(()=>{a.classList.add("toast-visible")}),a}remove(e){e.classList.remove("toast-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getIcon(e){const t={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>\n        <polyline points="22,4 12,14.01 9,11.01"/>\n      </svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <line x1="15" y1="9" x2="9" y2="15"/>\n        <line x1="9" y1="9" x2="15" y2="15"/>\n      </svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>\n        <line x1="12" y1="9" x2="12" y2="13"/>\n        <line x1="12" y1="17" x2="12.01" y2="17"/>\n      </svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <circle cx="12" cy="12" r="10"/>\n        <path d="M12 16v-4"/>\n        <path d="M12 8h.01"/>\n      </svg>'};return t[e]||t.info}success(e,t,i){return this.show("success",e,t,i)}error(e,t,i){return this.show("error",e,t,i)}warning(e,t,i){return this.show("warning",e,t,i)}info(e,t,i){return this.show("info",e,t,i)}}const g=new E;class C{constructor(){this.emitter=z(),this.elements={},this.paperSize="a4",this.orientation="landscape",this.init()}init(){this.cacheElements(),this.renderPaperSizeOptions(),this.loadSettings(),this.updatePreviewLayout(),this.setupEventListeners()}cacheElements(){const e=t=>document.querySelector(t);this.elements={uploadZone:e("#upload-zone"),previewArea:e("#preview-area"),actionButtons:e("#action-buttons"),previewDescription:e("#preview-description"),zineSheetsContainer:e("#zine-sheets-container"),printBtn:e("#printBtn"),exportPdfBtn:e("#exportPdfBtn"),pdfUpload:e("#pdf-upload"),uploadStatus:e("#upload-status"),progressContainer:e("#progress-container"),progressFill:e("#progress-fill"),progressText:e("#progress-text"),progressSubtext:e("#progress-subtext"),paperSizeSelect:e("#paper-size-select"),orientationSelect:e("#orientation-select"),pageNumbersCheckbox:e("#show-page-numbers"),toastContainer:e("#toast-container"),zineTabs:e("#zine-tabs"),zineTab1:e("#zine-tab-1"),zineTab2:e("#zine-tab-2"),gridRows:e("#grid-rows"),gridCols:e("#grid-cols"),gridTotal:e("#grid-total"),unusedSection:e("#unused-pages-section"),unusedGrid:e("#unused-grid")}}renderPaperSizeOptions(){this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.innerHTML=Object.entries(m).map(([e,t])=>'<option value="'.concat(e,'">').concat(t.label,"</option>")).join(""))}setupEventListeners(){var t,i,s,a,r,o,n,d,l,h;(t=this.elements.paperSizeSelect)==null||t.addEventListener("change",p=>this.updatePaperSize(p.target.value)),(i=this.elements.orientationSelect)==null||i.addEventListener("change",p=>this.updateOrientation(p.target.value)),(s=this.elements.pageNumbersCheckbox)==null||s.addEventListener("change",p=>this.togglePageNumbers(p.target.checked)),(a=this.elements.uploadZone)==null||a.addEventListener("click",()=>this.triggerFileUpload()),(r=this.elements.uploadZone)==null||r.addEventListener("dragover",p=>this.handleDragOver(p)),(o=this.elements.uploadZone)==null||o.addEventListener("dragleave",p=>this.handleDragLeave(p)),(n=this.elements.uploadZone)==null||n.addEventListener("drop",p=>this.handleFileDrop(p)),(d=this.elements.pdfUpload)==null||d.addEventListener("change",p=>{const u=p.target.files[0];u&&this.emitter.emit("fileSelected",u)});const e=()=>{var w,v;const p=parseInt((w=this.elements.gridRows)==null?void 0:w.value)||2,u=parseInt((v=this.elements.gridCols)==null?void 0:v.value)||4;this.elements.gridTotal&&(this.elements.gridTotal.textContent="(".concat(p*u," pages)")),this.emitter.emit("gridSizeChanged",{rows:p,cols:u})};(l=this.elements.gridRows)==null||l.addEventListener("input",e),(h=this.elements.gridCols)==null||h.addEventListener("input",e),document.addEventListener("keydown",p=>this.handleKeyboard(p))}setReady(e,t=null){var i,s,a,r;e?((i=this.elements.previewArea)==null||i.classList.remove("opacity-30","pointer-events-none"),(s=this.elements.actionButtons)==null||s.classList.remove("hidden")):((a=this.elements.previewArea)==null||a.classList.add("opacity-30","pointer-events-none"),(r=this.elements.actionButtons)==null||r.classList.add("hidden")),t&&this.elements.previewDescription&&(this.elements.previewDescription.textContent=t)}updateProgress(e){this.elements.progressFill&&(this.elements.progressFill.style.width="".concat(e,"%"))}setStatus(e,t="info"){this.elements.uploadStatus&&(this.elements.uploadStatus.textContent=e,this.elements.uploadStatus.className="text-[11px] uppercase font-bold tracking-wider ".concat(t==="error"?"text-red-500":t==="success"?"text-green-500":"text-gray-400"))}generateLayout(e=8,t=null){if(!this.elements.zineSheetsContainer)return;this.elements.zineSheetsContainer.innerHTML="",t||(e>8?t="accordion-16":t="mini-8"),this.currentTemplate=t;const i=F[t];if(!i){console.error("Unknown template: ".concat(t));return}t==="accordion-16"?this.generateAccordionLayout(i):this.generateMiniZineLayout(e,i),this.updatePreviewLayout()}generateCustomGrid(e,t,i=0){this.elements.zineSheetsContainer.innerHTML="";const s=e*t,a=Math.max(s,i),r=document.createElement("div");r.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",r.setAttribute("data-sheet",1),r.setAttribute("data-template","custom-".concat(e,"x").concat(t));const o=document.createElement("div");o.className="zine-grid",o.id="zine-grid-sheet-1",o.style.display="grid",o.style.gridTemplateColumns="repeat(".concat(t,", 1fr)"),o.style.gridTemplateRows="repeat(".concat(e,", 1fr)"),o.style.gridTemplateAreas="none";for(let n=0;n<s;n++){const d=n+1,l=document.createElement("div");l.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden transition-all duration-200",l.setAttribute("data-page-index",n),l.setAttribute("data-page",d),l.setAttribute("draggable","true");const h=d===1?"Cover":d===s?"Back":"Page ".concat(d);l.innerHTML='\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(h,'</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ').concat(d,'" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      '),this.setupDragAndDrop(l),this.setupFlipButton(l),o.appendChild(l)}r.appendChild(o),this.elements.zineSheetsContainer.appendChild(r),this.generateUnusedBucket(s,a),this.updatePreviewLayout()}generateUnusedBucket(e,t){const{unusedSection:i,unusedGrid:s}=this.elements;if(!(!i||!s)){if(s.innerHTML="",e>=t){i.classList.add("hidden");return}i.classList.remove("hidden");for(let a=e;a<t;a++){const r=document.createElement("div");r.className="page-cell bg-white aspect-[1/1.414] relative rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing hover:border-blue-500 transition-colors duration-200",r.setAttribute("data-page-index",a),r.draggable=!0;const o=document.createElement("img");o.className="page-content-img w-full h-full object-contain hidden pointer-events-none",o.draggable=!1;const n=document.createElement("div");n.className="absolute top-1 left-1 bg-gray-500 text-white text-[8px] px-1.5 py-0.5 rounded-sm font-bold z-10",n.textContent="#".concat(a+1);const d=document.createElement("div");d.className="text-[10px] uppercase font-bold text-gray-300 select-none",d.textContent="Unused",r.appendChild(n),r.appendChild(d),r.appendChild(o),this.setupDragAndDrop(r),s.appendChild(r)}}}generateAccordionLayout(e){const t=document.createElement("div");t.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",t.setAttribute("data-sheet",1),t.setAttribute("data-template","accordion-16");const i=document.createElement("div");i.className="zine-grid accordion-16",i.id="zine-grid-sheet-1",e.layout.forEach(a=>{const r=document.createElement("div");r.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",r.setAttribute("data-page-index",a.page-1),r.setAttribute("data-page",a.page),r.setAttribute("draggable","true");const o=a.page===1?"Cover":a.page===16?"Back":"Page ".concat(a.page);r.innerHTML='\n        <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(o,'</span>\n        <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n            <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n        </button>\n        <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n        <img alt="Page ').concat(a.page,'" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n      '),this.setupDragAndDrop(r),this.setupFlipButton(r),i.appendChild(r)}),t.appendChild(i),t.insertAdjacentHTML("beforeend",'\n      <div class="absolute top-1/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-3/4 left-0 w-full border-t border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/30 pointer-events-none"></div>\n      <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/30 pointer-events-none"></div>\n    '),this.elements.zineSheetsContainer.appendChild(t)}generateMiniZineLayout(e,t){const i=e>8?2:1;for(let s=1;s<=i;s++){const a=document.createElement("div");a.className="print-sheet w-full p-0 relative overflow-hidden rounded-sm",a.setAttribute("data-sheet",s);const r=document.createElement("div");r.className="zine-grid",r.id="zine-grid-sheet-".concat(s);for(let n=1;n<=8;n++){const d=(s-1)*8+n,l=document.createElement("div");l.className="page-cell h-full w-full bg-white relative flex items-center justify-center overflow-hidden",l.setAttribute("data-page-index",d-1),l.setAttribute("data-page",n),l.setAttribute("draggable","true");const h=n===1?"Cover":n===8?"Back":"Page ".concat(n),p=i>1?' <span class="opacity-50 text-[8px] ml-1">(Sheet '.concat(s,")</span>"):"";l.innerHTML='\n          <span class="page-label centered absolute top-2 left-2 px-2 py-1 bg-black text-white text-[10px] font-black rounded uppercase z-10 shadow-[2px_2px_0_black]">'.concat(h).concat(p,'</span>\n          <button class="flip-btn absolute top-2 right-2 w-8 h-8 bg-white hover:bg-yellow-300 border-2 border-black flex items-center justify-center text-sm z-10 shadow-[2px_2px_0_black] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-none transition-all" title="Flip page">\n              <span class="material-symbols-outlined text-lg font-bold">rotate_right</span>\n          </button>\n          <div class="page-placeholder text-gray-200 text-xs font-black uppercase tracking-widest">Empty</div>\n          <img alt="Page ').concat(d,'" class="page-content-img w-full h-full object-contain hidden" draggable="false" />\n        '),this.setupDragAndDrop(l),this.setupFlipButton(l),r.appendChild(l)}const o='\n        <div class="absolute top-1/2 left-0 w-full border-t border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-1/2 h-full border-l border-blue-400/20 pointer-events-none"></div>\n        <div class="absolute top-0 left-3/4 h-full border-l border-blue-400/20 pointer-events-none"></div>\n      ';a.appendChild(r),a.insertAdjacentHTML("beforeend",o),this.elements.zineSheetsContainer.appendChild(a)}}setupDragAndDrop(e){e.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",e.getAttribute("data-page-index")),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),document.querySelectorAll(".page-cell").forEach(t=>t.classList.remove("drag-over"))}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("drag-over");const i=parseInt(t.dataTransfer.getData("text/plain")),s=parseInt(e.getAttribute("data-page-index"));i!==s&&this.emitter.emit("pagesSwapped",{fromIndex:i,toIndex:s})})}updatePagePreview(e,t){let i=this.elements.zineSheetsContainer.querySelector('[data-page-index="'.concat(e,'"]'));if(!i&&this.elements.unusedGrid&&(i=this.elements.unusedGrid.querySelector('[data-page-index="'.concat(e,'"]'))),i){const s=i.querySelector(".page-content-img"),a=i.querySelector(".page-placeholder");s&&a&&(t?(s.src=t,s.classList.remove("hidden"),a.classList.add("hidden")):(s.src="",s.classList.add("hidden"),a.classList.remove("hidden")))}}setupFlipButton(e){const t=e.querySelector(".flip-btn");t&&t.addEventListener("click",i=>{i.stopPropagation();const s=parseInt(e.getAttribute("data-page-index"));this.emitter.emit("pageFlipped",s)})}setPageFlip(e,t){const i=this.elements.zineSheetsContainer.querySelector('[data-page-index="'.concat(e,'"]'));if(i){const s=i.querySelector(".page-content-img");s&&(t?(s.style.transform="".concat(s.style.transform||""," rotate(180deg)").trim(),s.classList.add("flipped")):(s.style.transform=s.style.transform.replace("rotate(180deg)","").trim(),s.classList.remove("flipped")))}}setActiveTab(){}triggerFileUpload(){var e;(e=this.elements.pdfUpload)==null||e.click()}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.add("dragover")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&!this.elements.uploadZone.contains(e.relatedTarget)&&this.elements.uploadZone.classList.remove("dragover")}handleFileDrop(e){e.preventDefault(),e.stopPropagation(),this.elements.uploadZone&&this.elements.uploadZone.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&t[0].type==="application/pdf"?this.emitter.emit("fileSelected",t[0]):g.error("Invalid File","Please drop a valid PDF file")}handleKeyboard(e){e.key==="p"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),this.emitter.emit("print"))}showProgress(e,t="Processing PDF...",i=""){e?this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressContainer.classList.add("flex")):this.elements.progressContainer&&(this.elements.progressContainer.classList.add("hidden"),this.elements.progressContainer.classList.remove("flex")),this.elements.progressText&&(this.elements.progressText.textContent=t),this.elements.progressSubtext&&(this.elements.progressSubtext.textContent=i)}loadSettings(){const e=localStorage.getItem("paperSize"),t=localStorage.getItem("orientation");e&&(this.paperSize=e,this.elements.paperSizeSelect&&(this.elements.paperSizeSelect.value=e)),t&&(this.orientation=t,this.elements.orientationSelect&&(this.elements.orientationSelect.value=t))}updatePaperSize(e){this.paperSize=e,localStorage.setItem("paperSize",e),this.updatePreviewLayout(),this.emitter.emit("paperSizeChanged",{paperSize:e,orientation:this.orientation})}updateOrientation(e){this.orientation=e,localStorage.setItem("orientation",e),this.updatePreviewLayout(),this.emitter.emit("orientationChanged",{paperSize:this.paperSize,orientation:e})}togglePageNumbers(e){document.querySelectorAll(".page-label").forEach(i=>{e?(i.classList.remove("hidden"),i.classList.add("centered")):(i.classList.add("hidden"),i.classList.remove("centered"))})}updatePreviewLayout(){const e=document.querySelectorAll(".print-sheet");if(!e.length)return;const t=this.getPaperDimensions(this.paperSize,this.orientation),i=t.width/t.height;e.forEach(s=>{s.style.aspectRatio="".concat(i),s.style.maxHeight="75vh",s.style.maxWidth="100%",s.style.margin="0 auto"})}getPaperDimensions(e,t){const i=m[e]||m.a4;return t==="landscape"?{width:i.height,height:i.width}:{width:i.width,height:i.height}}getPaperSizeLabel(e){var t;return((t=m[e])==null?void 0:t.label)||"A4"}hasContent(){return this.elements.zineSheetsContainer&&this.elements.zineSheetsContainer.querySelector(".page-content-img:not(.hidden)")!==null}on(e,t){this.emitter.on(e,t)}}const k=""+new URL("reference-back-side-MWF-VJIo.jpg",import.meta.url).href;class ${constructor(){this.pdfProcessor=new D,this.ui=new C,this.referenceImageUrl=k,this.allPageImages=new Array(16).fill(null),this.pageFlips={},this.init()}async init(){try{await this.pdfProcessor.initialize(),this.setupEventListeners(),this.checkLibraries(),this.ui.generateLayout(8),this.ui.setStatus("Upload a PDF file to get started","info")}catch(e){console.error("Initialization error:",e),this.ui.setStatus("Failed to initialize. Please refresh the page.","error"),g.error("Initialization Error","Failed to load required libraries.")}}setupEventListeners(){var e,t;this.ui.on("fileSelected",i=>this.handleFileSelected(i)),this.ui.on("processAndPreview",()=>this.handleProcessAndPreview()),this.ui.on("print",()=>this.handlePrint()),this.ui.on("export",()=>this.handleExport()),this.ui.on("paperSizeChanged",i=>this.updatePaperSettings(i)),this.ui.on("orientationChanged",i=>this.updatePaperSettings(i)),this.ui.on("pagesSwapped",i=>this.handlePagesSwapped(i)),this.ui.on("pageFlipped",i=>this.handlePageFlipped(i)),this.ui.on("gridSizeChanged",i=>this.handleGridSizeChanged(i)),(e=this.ui.elements.printBtn)==null||e.addEventListener("click",()=>this.handlePrint()),(t=this.ui.elements.exportPdfBtn)==null||t.addEventListener("click",()=>this.handleExport())}handlePageFlipped(e){this.pageFlips[e]=!this.pageFlips[e],this.ui.setPageFlip(e,this.pageFlips[e])}handleGridSizeChanged({rows:e,cols:t}){this.gridSize={rows:e,cols:t};const i=e*t;this.ui.generateCustomGrid(e,t,this.allPageImages.length);for(let s=0;s<Math.min(i,this.allPageImages.length);s++)this.allPageImages[s]&&this.ui.updatePagePreview(s,this.allPageImages[s])}setupInteractiveTicks(){}checkLibraries(){window.jspdf||console.warn("PDF library not yet loaded...")}handleFileSelected(e){this.selectedFile=e,this.ui.setStatus("File selected: ".concat(e.name," (").concat(f(e.size),")"),"success"),this.processPDF(e)}async processPDF(e){try{g.info("Reading PDF...","Please wait"),this.ui.showProgress(!0,"Reading PDF...","0%");const t=await this.pdfProcessor.loadPDF(e,n=>{this.ui.updateProgress(n)}),{numPages:i}=t;this.selectedLayout=i;const s=i;let a,r;if(i===16)a=4,r=4,this.ui.generateLayout(16,"accordion-16");else{const n=Math.ceil(Math.sqrt(i));a=i<=8?2:n>2?n:2,r=i<=8?4:Math.ceil(i/a),a=Math.min(a,10),r=Math.min(r,10),this.allPageImages=new Array(Math.max(a*r,i)).fill(null),this.ui.generateCustomGrid(a,r,this.allPageImages.length)}this.ui.elements.gridRows&&(this.ui.elements.gridRows.value=a),this.ui.elements.gridCols&&(this.ui.elements.gridCols.value=r),this.ui.elements.gridTotal&&(this.ui.elements.gridTotal.textContent="(".concat(a*r," pages)"));const o="PDF arranged into a ".concat(a,"×").concat(r," grid (").concat(a*r," pages)");this.ui.setReady(!0,o);for(let n=1;n<=s;n++){const d=await this.pdfProcessor.renderPage(n),l=await this.pdfProcessor.canvasToBlob(d);this.allPageImages[n-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[n-1]),this.allPageImages[n-1]=l,this.ui.updatePagePreview(n-1,l);const h=Math.round(n/s*100);this.ui.showProgress(!0,"Processing Page ".concat(n," of ").concat(s),"".concat(h,"%")),this.ui.updateProgress(h)}for(let n=s+1;n<=this.selectedLayout;n++)await this.createBlankPage(n);this.ui.showProgress(!1),this.ui.setStatus("Successfully processed ".concat(i," pages"),"success"),g.success("Done!","Your zine is ready to print.")}catch(t){console.error("PDF Error:",t),this.ui.showProgress(!1),g.error("Error","Failed to process PDF.")}}async createBlankPage(e){const t=document.createElement("canvas");t.width=1e3,t.height=1400;const i=t.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1e3,1400),i.fillStyle="#f3f4f6",i.font="bold 80px sans-serif",i.textAlign="center",i.fillText("BLANK",500,700);const s=await this.pdfProcessor.canvasToBlob(t);this.allPageImages[e-1]&&this.pdfProcessor.revokeBlobUrl(this.allPageImages[e-1]),this.allPageImages[e-1]=s,this.ui.updatePagePreview(e-1,s)}handlePagesSwapped({fromIndex:e,toIndex:t}){const i=this.allPageImages[e];this.allPageImages[e]=this.allPageImages[t],this.allPageImages[t]=i;const s=this.pageFlips[e];this.pageFlips[e]=this.pageFlips[t],this.pageFlips[t]=s,this.ui.updatePagePreview(e,this.allPageImages[e]),this.ui.updatePagePreview(t,this.allPageImages[t]),this.ui.setPageFlip(e,!!this.pageFlips[e]),this.ui.setPageFlip(t,!!this.pageFlips[t]),g.info("Pages swapped")}updateZineView(e){const t=(e-1)*8;for(let i=0;i<8;i++){const s=t+i,a=this.allPageImages[s];this.ui.updatePagePreview(i,a)}}updatePaperSettings(e){this.paperSize=e.paperSize,this.orientation=e.orientation}handlePrint(){this.ui.hasContent()&&this.createPrintLayout()}createPrintLayout(){const e=window.open("","_blank");if(!e){g.error("Blocked","Please allow popups.");return}const t=[];document.querySelectorAll(".zine-grid").forEach(h=>{t.push(h.innerHTML)});const i=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),{rows:s,cols:a}=this.gridSize,r="\n      grid-template-columns: repeat(".concat(a,", 1fr);\n      grid-template-rows: repeat(").concat(s,", 1fr);\n      grid-template-areas: none !important;\n      /* Generate grid areas if needed, but simple flow usually works for generic grids */\n    "),o="",n="",d=t.map(h=>'\n      <div class="sheet">\n        <div class="zine-grid">'.concat(h,"</div>\n        ").concat(n,'\n      </div>\n      <div class="sheet"><div class="back-side"></div></div>\n    ')).join(""),l="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Print Zine</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          @page { size: ".concat(i.width,"mm ").concat(i.height,"mm; margin: 0; }\n          body { background: white; width: ").concat(i.width,"mm; height: ").concat(i.height,"mm; overflow: hidden; }\n          .sheet { width: 100%; height: 100%; page-break-after: always; display: block; overflow: hidden; position: relative; }\n          .zine-grid {\n            display: grid;\n            ").concat(r,"\n            height: ").concat(i.height,"mm;\n            width: ").concat(i.width,"mm;\n            /* Ensure grid fills the page */\n            justify-content: stretch;\n            align-content: stretch;\n          }\n          .page-cell {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            overflow: hidden;\n            border: 0.1mm dashed #eee;\n          }\n          /* Generic page areas fallback if needed */\n          \n          .page-content-img { \n            width: 100%; \n            height: 100%; \n            object-fit: contain; \n            /* Rely on DOM transform for rotation */\n          }\n          .page-label, .page-placeholder { display: none; }\n          \n          .back-side {\n            width: 100%; height: 100%;\n            background-image: url('").concat(this.referenceImageUrl,"');\n            background-size: contain;\n            background-position: center;\n            background-repeat: no-repeat;\n            transform: rotate(180deg);\n          }\n\n          \n          ").concat(o,"\n        </style>\n      </head>\n      <body>\n        ").concat(d,"\n      </body>\n      </html>\n    ");e.document.write(l),e.document.close(),e.setTimeout(()=>{e.print(),e.close()},500)}async handleExport(){if(this.ui.hasContent())try{this.ui.elements.exportPdfBtn.disabled=!0,g.info("Generating PDF...");const e=new y({orientation:this.orientation||"landscape",unit:"mm",format:this.paperSize||"a4"}),t=this.ui.getPaperDimensions(this.paperSize||"a4",this.orientation||"landscape"),i=async s=>{const a=document.querySelector("#zine-grid-sheet-".concat(s));if(!a)return;await new Promise(l=>setTimeout(l,100));const r=await x(a,{scale:3,useCORS:!0,backgroundColor:"#ffffff"});s>1&&e.addPage(),e.addImage(r.toDataURL("image/jpeg",.95),"JPEG",0,0,t.width,t.height),e.addPage();const o=document.createElement("canvas");o.width=r.width,o.height=r.height;const n=o.getContext("2d"),d=new Image;d.src=this.referenceImageUrl,await new Promise(l=>{d.onload=l}),n.translate(o.width/2,o.height/2),n.rotate(Math.PI),n.drawImage(d,-o.width/2,-o.height/2,o.width,o.height),e.addImage(o.toDataURL("image/jpeg",.9),"JPEG",0,0,t.width,t.height)};await i(1),this.currentTemplate!=="accordion-16"&&this.selectedLayout>8&&await i(2),e.save("zine-".concat(Date.now(),".pdf")),g.success("Downloaded!")}catch(e){console.error(e),g.error("Export Failed")}finally{this.ui.elements.exportPdfBtn.disabled=!1}}}document.addEventListener("DOMContentLoaded",()=>{new $});export{A as __vite_legacy_guard};
//# sourceMappingURL=index-B69YuB5O.js.map
