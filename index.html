<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description" content="Convert PDFs into printable 8-page or 16-page zine layouts with ease" />
    <title>Zine-ify PDF Upload</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <style type="text/tailwindcss">
        :root {
            --bg-neutral: #F4F4F2;
            --accent-dark: #1A1A1A;
            --primary-vibrant: #2D5BFF;
            --border-color: #D1D1D1;
            --page-border: #1A1A1A;
            --paper-bg: #FFFFFF;
        }
        body {
            background-color: var(--bg-neutral);
            font-family: 'Inter', sans-serif;
            color: var(--accent-dark);
        }
        .upload-box {
            border: 2px dashed var(--border-color);
            transition: all 0.2s ease;
        }
        .upload-box:active, .upload-box.dragover {
            border-color: var(--accent-dark);
            background-color: rgba(0,0,0,0.02);
            transform: scale(0.99);
        }
        .toggle-container {
            background: #FFFFFF;
            border: 1.5px solid var(--accent-dark);
        }
        #layout-16:checked ~ .toggle-container .label-16 {
            background-color: var(--accent-dark);
            color: white;
        }
        #layout-8:checked ~ .toggle-container .label-8 {
            background-color: var(--accent-dark);
            color: white;
        }

        /* Preview specific styles */
        .print-sheet {
            background-color: var(--paper-bg);
            aspect-ratio: 1 / 1.414;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border: 1px solid #D1D5DB;
            position: relative;
            flex-shrink: 0;
        }
        .zine-grid {
            display: grid;
            grid-template-areas:
                "page5 page4 page3 page2"
                "page6 page7 page8 page1";
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            height: 100%;
            width: 100%;
        }
        .page-cell {
            border: 0.5px dashed #CCCCCC;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: grab;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .page-cell.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 50;
        }
        .page-cell.drag-over {
            border: 2px solid var(--primary-vibrant);
            z-index: 40;
        }
        .page-content-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .page-label {
            position: absolute;
            background: var(--accent-dark);
            color: white;
            font-weight: 800;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 2px;
            z-index: 20;
            top: 4px;
            left: 4px;
        }
        .page-cell[data-page="1"] { grid-area: page1; }
        .page-cell[data-page="2"] { grid-area: page2; }
        .page-cell[data-page="3"] { grid-area: page3; }
        .page-cell[data-page="4"] { grid-area: page4; }
        .page-cell[data-page="5"] { grid-area: page5; }
        .page-cell[data-page="6"] { grid-area: page6; }
        .page-cell[data-page="7"] { grid-area: page7; }
        .page-cell[data-page="8"] { grid-area: page8; }
        .page-cell[data-page="9"] { grid-area: page9; }
        .page-cell[data-page="10"] { grid-area: page10; }
        .page-cell[data-page="11"] { grid-area: page11; }
        .page-cell[data-page="12"] { grid-area: page12; }
        .page-cell[data-page="13"] { grid-area: page13; }
        .page-cell[data-page="14"] { grid-area: page14; }
        .page-cell[data-page="15"] { grid-area: page15; }
        .page-cell[data-page="16"] { grid-area: page16; }

        .page-cell[data-page="2"], .page-cell[data-page="3"], 
        .page-cell[data-page="4"], .page-cell[data-page="5"] {
            transform: rotate(180deg);
        }
        
        /* Accordion-16 specific upside-down pages */
        .zine-grid.accordion-16 .page-cell[data-page="1"],
        .zine-grid.accordion-16 .page-cell[data-page="2"],
        .zine-grid.accordion-16 .page-cell[data-page="3"],
        .zine-grid.accordion-16 .page-cell[data-page="4"],
        .zine-grid.accordion-16 .page-cell[data-page="9"],
        .zine-grid.accordion-16 .page-cell[data-page="10"],
        .zine-grid.accordion-16 .page-cell[data-page="11"],
        .zine-grid.accordion-16 .page-cell[data-page="12"] {
            transform: rotate(180deg);
        }
        /* Override default rotations for accordion template */
        .zine-grid.accordion-16 .page-cell[data-page="5"],
        .zine-grid.accordion-16 .page-cell[data-page="6"],
        .zine-grid.accordion-16 .page-cell[data-page="7"],
        .zine-grid.accordion-16 .page-cell[data-page="8"],
        .zine-grid.accordion-16 .page-cell[data-page="13"],
        .zine-grid.accordion-16 .page-cell[data-page="14"],
        .zine-grid.accordion-16 .page-cell[data-page="15"],
        .zine-grid.accordion-16 .page-cell[data-page="16"] {
            transform: rotate(0deg);
        }

        /* Accordion grid 4x4 layout */
        .zine-grid.accordion-16 {
            grid-template-areas:
                "page4 page3 page2 page1"
                "page5 page6 page7 page8"
                "page12 page11 page10 page9"
                "page13 page14 page15 page16";
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }

        /* Cut line indicators */
        .cut-line {
            position: absolute;
            background: transparent;
            z-index: 30;
            pointer-events: none;
        }
        .cut-line::before {
            content: '✂️';
            position: absolute;
            font-size: 16px;
        }
        .cut-line-left {
            left: 0;
            width: 3px;
            border-left: 3px dashed #ef4444;
        }
        .cut-line-left::before {
            left: 6px;
            top: -2px;
        }
        .cut-line-right {
            right: 0;
            width: 3px;
            border-right: 3px dashed #ef4444;
        }
        .cut-line-right::before {
            right: 6px;
            top: -2px;
            transform: scaleX(-1);
        }

        .tab-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .action-button {
            transition: transform 0.1s ease;
        }
        .action-button:active {
            transform: scale(0.96);
        }

        /* Layout toggle selected state */
        .layout-toggle.selected {
            background-color: var(--accent-dark);
            color: white;
            border-color: var(--accent-dark);
        }


        /* View transitions */
        .view-section {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .view-section.hidden {
            display: none;
            opacity: 0;
            transform: translateY(10px);
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 4px;
            background: #E5E7EB;
            border-radius: 2px;
            overflow: hidden;
        }
        #progress-fill {
            height: 100%;
            background: var(--primary-vibrant);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "neutral-bg": "#F4F4F2",
                        "primary-vibrant": "#2D5BFF",
                    }
                },
            },
        }
    </script>
</head>

<body class="antialiased min-h-screen py-10 px-6">
    <div class="max-w-4xl mx-auto space-y-12">
        <header class="text-center">
            <h1 class="text-4xl font-extrabold tracking-tighter uppercase mb-2">Zine-ify</h1>
            <p class="text-gray-500 font-medium">Automatic PDF to Printable Mini-Zine</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-[350px_1fr] gap-12 items-start">
            <!-- Left Column: Controls & Upload -->
            <div class="space-y-8 sticky top-10">
                <div id="upload-zone"
                    class="upload-box bg-white rounded-3xl p-10 flex flex-col items-center justify-center text-center cursor-pointer shadow-sm">
                    <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mb-4">
                        <span class="material-symbols-outlined text-4xl text-gray-400">cloud_upload</span>
                    </div>
                    <h2 class="text-lg font-bold mb-1">Select PDF</h2>
                    <p id="upload-status" class="text-[11px] text-gray-400 uppercase font-bold tracking-wider">Supports
                        up to 16 pages</p>
                    <input type="file" id="pdf-upload" class="hidden" accept="application/pdf">
                </div>

                <div id="settings-group" class="bg-white rounded-3xl p-8 shadow-sm space-y-6">
                    <h3 class="text-sm font-extrabold uppercase tracking-widest border-b pb-4">Settings</h3>

                    <div>
                        <label class="text-[10px] font-bold uppercase text-gray-400 mb-2 block tracking-widest">Paper
                            Size</label>
                        <select id="paper-size-select"
                            class="w-full bg-gray-50 border-none rounded-xl font-bold text-sm p-4 focus:ring-2 focus:ring-black">
                            <!-- Populated by JS -->
                        </select>
                    </div>

                    <div>
                        <label
                            class="text-[10px] font-bold uppercase text-gray-400 mb-2 block tracking-widest">Orientation</label>
                        <select id="orientation-select"
                            class="w-full bg-gray-50 border-none rounded-xl font-bold text-sm p-4 focus:ring-2 focus:ring-black">
                            <option value="landscape">Landscape</option>
                            <option value="portrait">Portrait</option>
                        </select>
                    </div>

                    <div class="pt-4 border-t space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-[10px] font-bold uppercase text-gray-400 tracking-widest">Page
                                Scale</label>
                            <span id="scale-value" class="text-xs font-black">100%</span>
                        </div>
                        <input type="range" id="scale-slider" min="50" max="200" value="100"
                            class="w-full h-2 bg-gray-100 rounded-lg appearance-none cursor-pointer accent-black">

                        <div class="flex justify-between items-center">
                            <label class="text-[10px] font-bold uppercase text-gray-400 tracking-widest">Page
                                Margins</label>
                            <span id="margin-value" class="text-xs font-black">0px</span>
                        </div>
                        <input type="range" id="margin-slider" min="0" max="100" value="0"
                            class="w-full h-2 bg-gray-100 rounded-lg appearance-none cursor-pointer accent-black">
                    </div>

                    <!-- Grid Size Inputs -->
                    <div class="pt-4 border-t">
                        <label class="text-[10px] font-bold uppercase text-gray-400 mb-2 block tracking-widest">Grid
                            Size</label>
                        <div class="flex gap-2 items-center">
                            <input type="number" id="grid-rows" min="1" max="10" value="2"
                                class="w-16 bg-gray-50 border-none rounded-xl font-bold text-sm p-3 text-center focus:ring-2 focus:ring-black">
                            <span class="text-gray-400 font-bold">×</span>
                            <input type="number" id="grid-cols" min="1" max="10" value="4"
                                class="w-16 bg-gray-50 border-none rounded-xl font-bold text-sm p-3 text-center focus:ring-2 focus:ring-black">
                            <span id="grid-total" class="text-xs text-gray-400 ml-2">(8 pages)</span>
                        </div>
                    </div>

                </div>


                <div id="action-buttons" class="space-y-4 hidden">
                    <button id="exportPdfBtn"
                        class="action-button w-full bg-black text-white py-4 rounded-2xl flex items-center justify-center gap-3 font-extrabold uppercase text-sm tracking-widest shadow-xl">
                        <span class="material-symbols-outlined text-xl">file_download</span>
                        Download PDF
                    </button>
                    <button id="printBtn"
                        class="action-button w-full bg-white border-4 border-black text-black py-4 rounded-2xl flex items-center justify-center gap-3 font-extrabold uppercase text-sm tracking-widest shadow-md">
                        <span class="material-symbols-outlined text-xl">print</span>
                        Print Directly
                    </button>
                </div>
            </div>

            <!-- Right Column: Preview Area -->
            <div id="preview-area"
                class="opacity-30 pointer-events-none transition-opacity duration-500 min-h-[600px] flex flex-col items-center">
                <div class="w-full text-center md:text-left mb-8">
                    <h2 class="text-2xl font-extrabold mb-2 uppercase">Zine Preview</h2>
                    <p class="text-gray-500 text-sm leading-relaxed max-w-md" id="preview-description">
                        Upload a PDF to see your zine layout here.
                    </p>
                </div>

                <!-- Unified Zine View -->
                <div id="zine-sheets-container" class="w-full space-y-12">
                    <!-- Sheets will be injected here (Sheet 1, then Sheet 2 if 16 pages) -->
                </div>

                <div id="zine-container-legacy" class="hidden">
                    <!-- Kept for compatibility with existing JS selectors if needed, will be removed after refactor -->
                </div>

            </div>
        </main>
    </div>

    <!-- Progress View Overlay -->
    <div id="progress-container"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex flex-col items-center justify-center p-6 hidden">
        <div class="bg-white p-10 rounded-3xl w-full max-w-xs text-center shadow-2xl">
            <h3 id="progress-text" class="text-lg font-extrabold mb-4 uppercase tracking-tighter">Processing...</h3>
            <div class="progress-bar-container mb-2">
                <div id="progress-fill"></div>
            </div>
            <p id="progress-subtext" class="text-[10px] text-gray-400 font-extrabold uppercase tracking-widest">
                Converting pages</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-[300] space-y-2"></div>

    <!-- Load the application as ES module -->
    <script type="module" src="/src/js/main.js"></script>

</body>

</html>